{"ast":null,"code":"import _objectSpread from\"/root/shose/app-shose/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useRef,useCallback}from'react';import{motion,AnimatePresence}from'framer-motion';import{useNavigate}from'react-router-dom';import axios from'axios';import{Document,Packer,Paragraph,Table,TableCell,TableRow,TextRun,WidthType}from'docx';import{saveAs}from'file-saver';import{io}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Orders=()=>{const[orders,setOrders]=useState([]);const[vendorSearch,setVendorSearch]=useState('');const[phoneSearch,setPhoneSearch]=useState('');const[orderNumberSearch,setOrderNumberSearch]=useState('');const[startDate,setStartDate]=useState('');const[endDate,setEndDate]=useState('');const[statusFilters,setStatusFilters]=useState({rejected:false,shipped:false,delivered:false});const[showUnreadOnly,setShowUnreadOnly]=useState(false);const[selectedMedia,setSelectedMedia]=useState(null);const[error,setError]=useState(null);const[editOrder,setEditOrder]=useState(null);const[editForm,setEditForm]=useState({quantity:1,address:''});const[selectedOrderForMessages,setSelectedOrderForMessages]=useState(null);const[newMessage,setNewMessage]=useState('');const[newImage,setNewImage]=useState(null);const[newImagePreview,setNewImagePreview]=useState(null);const[page,setPage]=useState(1);const[total,setTotal]=useState(0);const[loading,setLoading]=useState(true);const limit=20;const navigate=useNavigate();// Refs\nconst socketRef=useRef(null);const currentOrderIdRef=useRef(null);const messagesContainerRef=useRef(null);const messagesEndRef=useRef(null);// Image preview effect\nuseEffect(()=>{if(newImage){const reader=new FileReader();reader.onloadend=()=>{setNewImagePreview(reader.result);};reader.readAsDataURL(newImage);}else{setNewImagePreview(null);}},[newImage]);// Scroll to bottom ONLY when sending a message\nconst scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};// Socket authentication & connection management\nuseEffect(()=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول');navigate('/login');return;}try{const payload=JSON.parse(atob(token.split('.')[1]));socketRef.current=io(process.env.REACT_APP_API_URL,{autoConnect:false});const socket=socketRef.current;socket.connect();socket.emit('authenticate',{userId:payload.id,role:payload.role});socket.on('connect',()=>{console.log('Socket connected successfully');if(currentOrderIdRef.current){socket.emit('joinOrder',currentOrderIdRef.current);}});socket.on('error',err=>{console.error('Socket.IO error:',err);setError(\"\\u062E\\u0637\\u0623 \\u0641\\u064A \\u0627\\u0644\\u0627\\u062A\\u0635\\u0627\\u0644: \".concat(err.message||'غير معروف'));});socket.on('orderJoined',_ref=>{let{orderId}=_ref;console.log(\"Successfully joined order room: \".concat(orderId));});socket.on('disconnect',()=>{console.log('Socket disconnected');});return()=>{if(socket.connected){socket.disconnect();}};}catch(e){console.error('Token decode error:',e);setError('خطأ في التوثيق، يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}},[navigate]);// Fetch orders\nconst fetchOrders=useCallback(()=>{setLoading(true);const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لجلب الطلبات');navigate('/login');return;}let url=\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders\");const params=new URLSearchParams();if(vendorSearch)params.append('vendorName',vendorSearch);if(phoneSearch)params.append('phone',phoneSearch);if(orderNumberSearch)params.append('orderNumber',orderNumberSearch);if(startDate)params.append('startDate',startDate);if(endDate)params.append('endDate',endDate);if(statusFilters.rejected)params.append('status','rejected');if(statusFilters.shipped)params.append('status','shipped');if(statusFilters.delivered)params.append('status','delivered');params.append('page',page);params.append('limit',limit);if(params.toString())url+=\"?\".concat(params.toString());axios.get(url,{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{console.log('Fetched orders:',res.data);setOrders(res.data.orders||[]);setTotal(res.data.total||0);setError(null);}).catch(err=>{var _err$response,_err$response$data,_err$response2;console.error('Fetch orders error:',err);const errorMessage=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'خطأ في جلب الطلبات: '+err.message;setError(errorMessage);if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}}).finally(()=>{setLoading(false);});},[vendorSearch,phoneSearch,orderNumberSearch,startDate,endDate,statusFilters,page,navigate]);useEffect(()=>{fetchOrders();},[fetchOrders]);// Messages modal socket handling (NO AUTO SCROLL)\nuseEffect(()=>{if(!selectedOrderForMessages||!socketRef.current){if(currentOrderIdRef.current&&socketRef.current){socketRef.current.emit('leaveOrder',currentOrderIdRef.current);currentOrderIdRef.current=null;}return;}const orderId=selectedOrderForMessages._id;currentOrderIdRef.current=orderId;socketRef.current.emit('joinOrder',orderId);const token=localStorage.getItem('token');// Mark as read\naxios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(orderId,\"/markRead\"),{},{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(prevOrders=>prevOrders.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount:0}):o));setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:res.data.order.messages||[],unreadCount:0}));// NO SCROLL HERE\n}).catch(err=>{console.error('Mark read error:',err);// setError('خطأ في تحديث حالة القراءة');\n});const handleNewMessage=message=>{if(message.orderId!==orderId)return;setSelectedOrderForMessages(prev=>{var _prev$messages;const exists=(_prev$messages=prev.messages)===null||_prev$messages===void 0?void 0:_prev$messages.some(m=>m._id===message._id);if(exists)return prev;return _objectSpread(_objectSpread({},prev),{},{messages:[...(prev.messages||[]),message]});});if(message.from!==getUserRole()){setOrders(prevOrders=>prevOrders.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount:(o.unreadCount||0)+1}):o));}// NO SCROLL ON RECEIVING MESSAGE\n};const handleMessagesUpdated=data=>{if(data.orderId!==orderId)return;setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:data.messages||[],unreadCount:data.messages.filter(msg=>!msg.isRead&&msg.from!==getUserRole()).length}));// NO SCROLL\n};const handleUnreadUpdate=_ref2=>{let{orderId:updatedId,unreadCount}=_ref2;setOrders(prev=>prev.map(o=>o._id===updatedId?_objectSpread(_objectSpread({},o),{},{unreadCount}):o));if(updatedId===orderId){setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{unreadCount}));}};const socket=socketRef.current;socket.on('newMessage',handleNewMessage);socket.on('messagesUpdated',handleMessagesUpdated);socket.on('unreadUpdate',handleUnreadUpdate);// NO INITIAL SCROLL\nreturn()=>{socket.off('newMessage',handleNewMessage);socket.off('messagesUpdated',handleMessagesUpdated);socket.off('unreadUpdate',handleUnreadUpdate);socket.emit('leaveOrder',orderId);currentOrderIdRef.current=null;};},[selectedOrderForMessages]);// Delete order\nconst handleDeleteOrder=id=>{if(!window.confirm('هل تريد حذف هذا الطلب؟'))return;const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لتتمكن من حذف الطلبات');navigate('/login');return;}axios.delete(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(id),{headers:{Authorization:\"Bearer \".concat(token)}}).then(()=>{setOrders(prev=>prev.filter(o=>o._id!==id));setError(null);alert('تم حذف الطلب بنجاح');}).catch(err=>{var _err$response3,_err$response3$data,_err$response4;const errorMessage=((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'خطأ في الحذف: '+err.message;setError(errorMessage);if(((_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});};// Update status\nconst handleUpdateStatus=(id,status)=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لتتمكن من تحديث حالة الطلب');navigate('/login');return;}axios.put(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(id,\"/status\"),{status},{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(prev=>prev.map(o=>o._id===id?res.data.order:o));setError(null);alert('تم تحديث حالة الطلب بنجاح');}).catch(err=>{var _err$response5,_err$response5$data,_err$response6;const errorMessage=((_err$response5=err.response)===null||_err$response5===void 0?void 0:(_err$response5$data=_err$response5.data)===null||_err$response5$data===void 0?void 0:_err$response5$data.message)||'خطأ في التحديث: '+err.message;setError(errorMessage);if(((_err$response6=err.response)===null||_err$response6===void 0?void 0:_err$response6.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});};// Edit order\nconst handleEditOrder=order=>{setEditOrder(order);setEditForm({quantity:order.quantity||1,address:order.address||''});};const handleEditSubmit=()=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لتتمكن من تعديل الطلب');navigate('/login');return;}axios.put(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(editOrder._id),editForm,{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(prev=>prev.map(o=>o._id===editOrder._id?res.data.order:o));setEditOrder(null);setEditForm({quantity:1,address:''});setError(null);alert('تم تعديل الطلب بنجاح');}).catch(err=>{var _err$response7,_err$response7$data,_err$response8;const errorMessage=((_err$response7=err.response)===null||_err$response7===void 0?void 0:(_err$response7$data=_err$response7.data)===null||_err$response7$data===void 0?void 0:_err$response7$data.message)||'خطأ في تعديل الطلب: '+err.message;setError(errorMessage);if(((_err$response8=err.response)===null||_err$response8===void 0?void 0:_err$response8.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});};// Media handlers\nconst openMedia=media=>{if(media){setSelectedMedia({url:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(media),type:'image'});}};const closeMedia=()=>setSelectedMedia(null);// Group orders\nconst groupOrders=useCallback((ordersList,role)=>{if(role==='customer')return ordersList;const grouped={};ordersList.forEach(order=>{const key=\"\".concat(order.product._id,\"-\").concat(order.user._id,\"-\").concat(order.address);if(!grouped[key]){grouped[key]=_objectSpread(_objectSpread({},order),{},{quantity:0,orderIds:[],selectedImages:new Set(),messages:[],unreadCount:0});}grouped[key].quantity+=order.quantity;grouped[key].orderIds.push(order._id);grouped[key].messages=grouped[key].messages.concat(order.messages||[]);if(order.selectedImage){grouped[key].selectedImages.add(order.selectedImage);}if(order.messages){const unread=order.messages.filter(msg=>!msg.isRead&&msg.from!==role).length;grouped[key].unreadCount+=unread;}});for(let key in grouped){grouped[key].messages.sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));}return Object.values(grouped).map(group=>_objectSpread(_objectSpread({},group),{},{selectedImage:Array.from(group.selectedImages)[0]||'placeholder-image.jpg',isGrouped:group.orderIds.length>1,totalOrders:group.orderIds.length,unreadCount:group.unreadCount}));},[]);// Export to Word\nconst exportToWord=async()=>{try{const token=localStorage.getItem('token');let url=\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders\");const params=new URLSearchParams();if(vendorSearch)params.append('vendorName',vendorSearch);if(phoneSearch)params.append('phone',phoneSearch);if(orderNumberSearch)params.append('orderNumber',orderNumberSearch);if(startDate)params.append('startDate',startDate);if(endDate)params.append('endDate',endDate);if(statusFilters.rejected)params.append('status','rejected');if(statusFilters.shipped)params.append('status','shipped');if(statusFilters.delivered)params.append('status','delivered');if(params.toString())url+=\"?\".concat(params.toString());const res=await axios.get(url,{headers:{Authorization:\"Bearer \".concat(token)}});const allOrders=res.data.orders||res.data;const grouped=groupOrders(allOrders,getUserRole());const doc=new Document({sections:[{children:[new Paragraph({children:[new TextRun({text:'قائمة الطلبات',size:32,bold:true,rtl:true})],alignment:'right',spacing:{after:200}}),new Table({rows:[new TableRow({children:[new TableCell({children:[new Paragraph({text:'رقم الطلب',rtl:true,bold:true})],width:{size:10,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'الصورة',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'العميل',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'رقم الهاتف',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'العنوان',rtl:true,bold:true})],width:{size:15,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'المنتج',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'التاجر',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'تاريخ الطلب',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'الحالة',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'الكمية',rtl:true,bold:true})],width:{size:13,type:WidthType.PERCENTAGE}})]}),...grouped.map(order=>{var _order$user,_order$user2,_order$product,_order$product2,_order$product2$vendo;return new TableRow({children:[new TableCell({children:[new Paragraph({text:(order.orderNumber||'-').toString(),rtl:true})]}),new TableCell({children:[new Paragraph({text:order.selectedImage||'placeholder-image.jpg',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$user=order.user)===null||_order$user===void 0?void 0:_order$user.name)||'زائر',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$user2=order.user)===null||_order$user2===void 0?void 0:_order$user2.phone)||'-',rtl:true})]}),new TableCell({children:[new Paragraph({text:order.address||'-',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$product=order.product)===null||_order$product===void 0?void 0:_order$product.name)||'غير معروف',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$product2=order.product)===null||_order$product2===void 0?void 0:(_order$product2$vendo=_order$product2.vendor)===null||_order$product2$vendo===void 0?void 0:_order$product2$vendo.name)||'غير معروف',rtl:true})]}),new TableCell({children:[new Paragraph({text:new Date(order.createdAt).toLocaleDateString('ar-EG')||'-',rtl:true})]}),new TableCell({children:[new Paragraph({text:{pending:'تحت المراجعة',shipped:'جاري الشحن',delivered:'تم التسليم',rejected:'مرفوض'}[order.status]||'غير معروف',rtl:true})]}),new TableCell({children:[new Paragraph({text:order.isGrouped?\"\".concat(order.quantity,\" (\\u0645\\u062C\\u0645\\u0639)\"):order.quantity.toString(),rtl:true})]})]});})],width:{size:100,type:WidthType.PERCENTAGE}})]}]});const blob=await Packer.toBlob(doc);saveAs(blob,'orders.docx');setError(null);}catch(error){console.error('Export to Word error:',error);setError('خطأ في تصدير الـ Word: '+error.message);}};// Send message handler (ONLY HERE WE SCROLL)\nconst handleSendMessage=async e=>{e.preventDefault();e.stopPropagation();const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول');navigate('/login');return;}if(!newMessage.trim()&&!newImage){setError('يجب إدخال رسالة أو رفع صورة');return;}const formData=new FormData();if(newMessage.trim())formData.append('text',newMessage.trim());if(newImage)formData.append('image',newImage);try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(selectedOrderForMessages._id,\"/message\"),formData,{headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'multipart/form-data'}});setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:res.data.order.messages||[]}));setNewMessage('');setNewImage(null);setNewImagePreview(null);setError(null);// ONLY SCROLL WHEN SENDING MESSAGE\nsetTimeout(()=>{scrollToBottom();},100);}catch(err){var _err$response9,_err$response9$data;const errorMessage=((_err$response9=err.response)===null||_err$response9===void 0?void 0:(_err$response9$data=_err$response9.data)===null||_err$response9$data===void 0?void 0:_err$response9$data.message)||'خطأ في إرسال الرسالة';setError(errorMessage);}};// Messages modal open/close\nconst openMessages=order=>{setSelectedOrderForMessages(order);};const closeMessages=()=>{setSelectedOrderForMessages(null);setNewMessage('');setNewImage(null);setNewImagePreview(null);};// User role getter\nconst getUserRole=()=>{const token=localStorage.getItem('token');if(token){try{const payload=JSON.parse(atob(token.split('.')[1]));return payload.role||'user';}catch(e){console.error('Error decoding token:',e);setError('خطأ في فك تشفير التوكن، يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');return'user';}}return'user';};const userRole=getUserRole();// Display orders\nconst rawDisplayOrders=showUnreadOnly?orders.filter(o=>(o.unreadCount||0)>0):orders;const displayOrders=groupOrders(rawDisplayOrders,userRole);// Animation variants\nconst tableVariants={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:0.4,staggerChildren:0.05}}};const rowVariants={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:{duration:0.3}}};const buttonVariants={hover:{scale:1.05,boxShadow:'0 8px 16px rgba(255,0,0,0.3)'},tap:{scale:0.95}};const modalVariants={hidden:{opacity:0,scale:0.85},visible:{opacity:1,scale:1,transition:{duration:0.25}},exit:{opacity:0,scale:0.85,transition:{duration:0.2}}};return/*#__PURE__*/_jsxs(motion.div,{className:\"min-h-screen flex flex-col items-center bg-[#18191a] p-4 sm:p-6 text-white overflow-x-hidden\",initial:{opacity:0},animate:{opacity:1},transition:{duration:0.5},children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl sm:text-4xl md:text-5xl font-bold mb-8 text-center bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700 drop-shadow-lg\",children:\"\\u0642\\u0627\\u0626\\u0645\\u0629 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),error&&/*#__PURE__*/_jsxs(motion.div,{className:\"w-full max-w-4xl bg-red-900/90 text-white p-4 rounded-2xl mb-6 text-center font-medium shadow-2xl\",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:0.3},children:[error,/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),className:\"ml-4 text-xl font-bold\",children:\"\\xD7\"})]}),userRole!=='customer'&&/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-7xl mb-8 bg-[#242526] p-6 rounded-2xl shadow-2xl border border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-6\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0628\\u062D\\u062B \\u0628\\u0627\\u0633\\u0645 \\u0627\\u0644\\u062A\\u0627\\u062C\\u0631\",value:vendorSearch,onChange:e=>setVendorSearch(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0628\\u062D\\u062B \\u0628\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0647\\u0627\\u062A\\u0641\",value:phoneSearch,onChange:e=>setPhoneSearch(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0628\\u062D\\u062B \\u0628\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0637\\u0644\\u0628\",value:orderNumberSearch,onChange:e=>setOrderNumberSearch(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:startDate,onChange:e=>setStartDate(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:endDate,onChange:e=>setEndDate(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-4 mb-6\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-300 font-medium\",children:\"\\u0641\\u0644\\u062A\\u0631 \\u0627\\u0644\\u062D\\u0627\\u0644\\u0629:\"}),['rejected','shipped','delivered'].map(status=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2 space-x-reverse cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:statusFilters[status],onChange:e=>setStatusFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[status]:e.target.checked})),className:\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:status==='rejected'?'مرفوض':status==='shipped'?'جاري الشحن':'تم التسليم'})]},status)),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2 space-x-reverse cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:showUnreadOnly,onChange:e=>setShowUnreadOnly(e.target.checked),className:\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"\\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A \\u0627\\u0644\\u062A\\u064A \\u0628\\u0647\\u0627 \\u0631\\u0633\\u0627\\u0626\\u0644 \\u063A\\u064A\\u0631 \\u0645\\u0642\\u0631\\u0648\\u0621\\u0629 \\u0641\\u0642\\u0637\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4\",children:[/*#__PURE__*/_jsx(motion.button,{onClick:fetchOrders,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0628\\u062D\\u062B\"}),/*#__PURE__*/_jsx(motion.button,{onClick:exportToWord,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062A\\u0635\\u062F\\u064A\\u0631 \\u0625\\u0644\\u0649 Word\"})]})]}),/*#__PURE__*/_jsxs(AnimatePresence,{mode:\"wait\",children:[loading&&/*#__PURE__*/_jsx(motion.p,{className:\"text-2xl text-gray-400 py-12\",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"},\"loading\"),!loading&&displayOrders.length===0&&/*#__PURE__*/_jsx(motion.p,{className:\"text-2xl text-gray-400 py-12\",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0637\\u0644\\u0628\\u0627\\u062A \\u062D\\u0627\\u0644\\u064A\\u0627\\u064B.\"},\"no-orders\"),!loading&&displayOrders.length>0&&/*#__PURE__*/_jsx(motion.div,{className:\"w-full max-w-7xl overflow-x-auto bg-[#242526] rounded-2xl shadow-2xl border border-gray-700\",variants:tableVariants,initial:\"hidden\",animate:\"visible\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-700\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-[#3a3b3c]\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0635\\u0648\\u0631\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0639\\u0645\\u064A\\u0644\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0647\\u0627\\u062A\\u0641\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u062A\\u0627\\u062C\\u0631\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u062D\\u0627\\u0644\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0643\\u0645\\u064A\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644 \\u063A\\u064A\\u0631 \\u0627\\u0644\\u0645\\u0642\\u0631\\u0648\\u0621\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0625\\u062C\\u0631\\u0627\\u0621\\u0627\\u062A\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-[#242526] divide-y divide-gray-700\",children:displayOrders.map((order,idx)=>{var _order$user3,_order$user4,_order$product3,_order$product4,_order$product4$vendo;return/*#__PURE__*/_jsxs(motion.tr,{className:\"hover:bg-[#3a3b3c] transition duration-200\",variants:rowVariants,children:[/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right text-sm\",children:order.orderNumber||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-center\",children:/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(order.selectedImage),alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0627\\u0644\\u0637\\u0644\\u0628\",className:\"w-20 h-20 object-cover rounded-xl mx-auto cursor-pointer shadow-md hover:shadow-xl transition\",onClick:()=>openMedia(order.selectedImage),onError:e=>{e.target.onerror=null;e.target.src=\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/placeholder-image.jpg\");}})}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right font-medium\",children:((_order$user3=order.user)===null||_order$user3===void 0?void 0:_order$user3.name)||'زائر'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:((_order$user4=order.user)===null||_order$user4===void 0?void 0:_order$user4.phone)||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right text-ellipsis overflow-hidden max-w-xs\",children:order.address||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:((_order$product3=order.product)===null||_order$product3===void 0?void 0:_order$product3.name)||'غير معروف'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:((_order$product4=order.product)===null||_order$product4===void 0?void 0:(_order$product4$vendo=_order$product4.vendor)===null||_order$product4$vendo===void 0?void 0:_order$product4$vendo.name)||'غير معروف'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:new Date(order.createdAt).toLocaleDateString('ar-EG')}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-4 py-2 rounded-full text-xs font-bold \".concat(order.status==='pending'?'bg-yellow-600/30 text-yellow-300 border border-yellow-600':order.status==='shipped'?'bg-blue-600/30 text-blue-300 border border-blue-600':order.status==='delivered'?'bg-green-600/30 text-green-300 border border-green-600':'bg-red-600/30 text-red-300 border border-red-600'),children:{pending:'تحت المراجعة',shipped:'جاري الشحن',delivered:'تم التسليم',rejected:'مرفوض'}[order.status]||'غير معروف'})}),/*#__PURE__*/_jsxs(\"td\",{className:\"py-4 px-6 text-right font-bold text-yellow-400\",children:[order.quantity,\" \",order.isGrouped&&\"(\\u0645\\u062C\\u0645\\u0639 \\u0645\\u0646 \".concat(order.totalOrders,\" \\u0637\\u0644\\u0628)\")]}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-center\",children:/*#__PURE__*/_jsx(motion.button,{onClick:()=>openMessages(order),className:\"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-lg text-lg \".concat(order.unreadCount>0?'bg-gradient-to-r from-red-600 to-red-800 animate-pulse':'bg-gradient-to-r from-gray-600 to-gray-800'),variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:order.unreadCount>0?order.unreadCount:0})}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-end gap-3 flex-wrap\",children:[userRole==='admin'&&!order.isGrouped&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(motion.button,{className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",onClick:()=>handleEditOrder(order),children:\"\\u062A\\u0639\\u062F\\u064A\\u0644\"}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>handleDeleteOrder(order._id),className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062D\\u0630\\u0641\"})]}),userRole==='vendor'&&!order.isGrouped&&/*#__PURE__*/_jsxs(motion.select,{value:order.status,onChange:e=>handleUpdateStatus(order._id,e.target.value),className:\"p-3 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm\",variants:buttonVariants,whileHover:\"hover\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"pending\",children:\"\\u062A\\u062D\\u062A \\u0627\\u0644\\u0645\\u0631\\u0627\\u062C\\u0639\\u0629\"}),/*#__PURE__*/_jsx(\"option\",{value:\"shipped\",children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u0634\\u062D\\u0646\"}),/*#__PURE__*/_jsx(\"option\",{value:\"delivered\",children:\"\\u062A\\u0645 \\u0627\\u0644\\u062A\\u0633\\u0644\\u064A\\u0645\"}),/*#__PURE__*/_jsx(\"option\",{value:\"rejected\",children:\"\\u0645\\u0631\\u0641\\u0648\\u0636\"})]}),userRole==='customer'&&order.status==='pending'&&!order.isGrouped&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(motion.button,{className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",onClick:()=>handleEditOrder(order),children:\"\\u062A\\u0639\\u062F\\u064A\\u0644\"}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>handleDeleteOrder(order._id),className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062D\\u0630\\u0641\"})]})]})})]},order.isGrouped?\"group-\".concat(idx):order._id);})})]})},\"table-container\")]}),!loading&&total>limit&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center gap-6 mt-8\",children:[/*#__PURE__*/_jsx(motion.button,{onClick:()=>setPage(prev=>Math.max(1,prev-1)),disabled:page===1,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\",variants:buttonVariants,whileHover:page!==1?\"hover\":{},whileTap:page!==1?\"tap\":{},children:\"\\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xl text-gray-300\",children:[\"\\u0635\\u0641\\u062D\\u0629 \",page,\" \\u0645\\u0646 \",Math.ceil(total/limit)]}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>setPage(prev=>prev+1),disabled:page*limit>=total,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\",variants:buttonVariants,whileHover:page*limit<total?\"hover\":{},whileTap:page*limit<total?\"tap\":{},children:\"\\u0627\\u0644\\u062A\\u0627\\u0644\\u064A\"})]}),/*#__PURE__*/_jsx(AnimatePresence,{children:editOrder&&!editOrder.isGrouped&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",onClick:()=>setEditOrder(null),children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-[#242526] p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold mb-8 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\",children:\"\\u062A\\u0639\\u062F\\u064A\\u0644 \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"\\u0627\\u0644\\u0643\\u0645\\u064A\\u0629\",value:editForm.quantity,onChange:e=>setEditForm(_objectSpread(_objectSpread({},editForm),{},{quantity:parseInt(e.target.value)||1})),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\",min:\"1\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\",value:editForm.address,onChange:e=>setEditForm(_objectSpread(_objectSpread({},editForm),{},{address:e.target.value})),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4 mt-8\",children:[/*#__PURE__*/_jsx(motion.button,{onClick:handleEditSubmit,className:\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-green-600 to-green-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062D\\u0641\\u0638 \\u0627\\u0644\\u062A\\u0639\\u062F\\u064A\\u0644\\u0627\\u062A\"}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>setEditOrder(null),className:\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedOrderForMessages&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",onClick:closeMessages,children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\",children:[\"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644 \\u0644\\u0644\\u0637\\u0644\\u0628 #\",selectedOrderForMessages.orderNumber]}),/*#__PURE__*/_jsxs(\"div\",{ref:messagesContainerRef,className:\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\",children:[selectedOrderForMessages.messages&&selectedOrderForMessages.messages.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:selectedOrderForMessages.messages.map((msg,index)=>{var _selectedOrderForMess,_selectedOrderForMess2,_selectedOrderForMess3;const isMyMessage=msg.from===userRole;const senderName=msg.from==='vendor'?(_selectedOrderForMess=selectedOrderForMessages.product)===null||_selectedOrderForMess===void 0?void 0:(_selectedOrderForMess2=_selectedOrderForMess.vendor)===null||_selectedOrderForMess2===void 0?void 0:_selectedOrderForMess2.name:((_selectedOrderForMess3=selectedOrderForMessages.user)===null||_selectedOrderForMess3===void 0?void 0:_selectedOrderForMess3.name)||'غير معروف';return/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(isMyMessage?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md \".concat(isMyMessage?'bg-gradient-to-r from-red-600 to-red-800 text-white':'bg-gray-700 text-white'),children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold text-sm opacity-90\",children:[msg.from==='vendor'?'التاجر':'العميل',\": \",senderName]}),msg.text&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-lg\",children:msg.text}),msg.image&&/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(msg.image),alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\",className:\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\",onClick:e=>{e.stopPropagation();openMedia(msg.image);},onError:e=>{e.target.onerror=null;e.target.src=\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/placeholder-image.jpg\");}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-3 text-xs opacity-70\",children:[/*#__PURE__*/_jsx(\"p\",{children:new Date(msg.timestamp).toLocaleString('ar-EG')}),isMyMessage&&/*#__PURE__*/_jsx(\"span\",{children:msg.isRead?'✓✓':msg.isDelivered?'✓':'✓'})]})]})},msg._id||index);})}):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-400 text-lg\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0631\\u0633\\u0627\\u0626\\u0644 \\u0628\\u0639\\u062F.\"}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),(userRole==='vendor'||userRole==='customer')&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"\\u0627\\u0643\\u062A\\u0628 \\u0631\\u0633\\u0627\\u0644\\u062A\\u0643 \\u0647\\u0646\\u0627...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\",rows:\"4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:e=>setNewImage(e.target.files[0]||null),className:\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\"}),newImagePreview&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:newImagePreview,alt:\"\\u0645\\u0639\\u0627\\u064A\\u0646\\u0629\",className:\"w-24 h-24 object-cover rounded-xl shadow-lg\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setNewImage(null);setNewImagePreview(null);},className:\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\",children:\"\\xD7\"})]})]}),/*#__PURE__*/_jsx(motion.button,{type:\"submit\",className:\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\"})]}),/*#__PURE__*/_jsx(motion.button,{onClick:closeMessages,className:\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u063A\\u0644\\u0627\\u0642\"})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedMedia&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",onClick:closeMedia,children:/*#__PURE__*/_jsxs(motion.div,{className:\"relative max-w-4xl max-h-full\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"img\",{src:selectedMedia.url,className:\"max-w-full max-h-full rounded-2xl shadow-2xl\",alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0645\\u0643\\u0628\\u0631\\u0629\",onError:e=>{e.target.onerror=null;e.target.src=\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/placeholder-image.jpg\");}}),/*#__PURE__*/_jsx(motion.button,{onClick:closeMedia,className:\"absolute top-4 right-4 text-white text-5xl bg-black/70 rounded-full w-14 h-14 flex items-center justify-center shadow-xl hover:bg-black/90 transition\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\xD7\"})]})})})]});};export default Orders;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","motion","AnimatePresence","useNavigate","axios","Document","Packer","Paragraph","Table","TableCell","TableRow","TextRun","WidthType","saveAs","io","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Orders","orders","setOrders","vendorSearch","setVendorSearch","phoneSearch","setPhoneSearch","orderNumberSearch","setOrderNumberSearch","startDate","setStartDate","endDate","setEndDate","statusFilters","setStatusFilters","rejected","shipped","delivered","showUnreadOnly","setShowUnreadOnly","selectedMedia","setSelectedMedia","error","setError","editOrder","setEditOrder","editForm","setEditForm","quantity","address","selectedOrderForMessages","setSelectedOrderForMessages","newMessage","setNewMessage","newImage","setNewImage","newImagePreview","setNewImagePreview","page","setPage","total","setTotal","loading","setLoading","limit","navigate","socketRef","currentOrderIdRef","messagesContainerRef","messagesEndRef","reader","FileReader","onloadend","result","readAsDataURL","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","token","localStorage","getItem","payload","JSON","parse","atob","split","process","env","REACT_APP_API_URL","autoConnect","socket","connect","emit","userId","id","role","on","console","log","err","concat","message","_ref","orderId","connected","disconnect","e","removeItem","fetchOrders","url","params","URLSearchParams","append","toString","get","headers","Authorization","then","res","data","catch","_err$response","_err$response$data","_err$response2","errorMessage","response","status","finally","_id","post","prevOrders","map","o","_objectSpread","unreadCount","prev","messages","order","handleNewMessage","_prev$messages","exists","some","m","from","getUserRole","handleMessagesUpdated","filter","msg","isRead","length","handleUnreadUpdate","_ref2","updatedId","off","handleDeleteOrder","window","confirm","delete","alert","_err$response3","_err$response3$data","_err$response4","handleUpdateStatus","put","_err$response5","_err$response5$data","_err$response6","handleEditOrder","handleEditSubmit","_err$response7","_err$response7$data","_err$response8","openMedia","media","type","closeMedia","groupOrders","ordersList","grouped","forEach","key","product","user","orderIds","selectedImages","Set","push","selectedImage","add","unread","sort","a","b","Date","timestamp","Object","values","group","Array","isGrouped","totalOrders","exportToWord","allOrders","doc","sections","children","text","size","bold","rtl","alignment","spacing","after","rows","width","PERCENTAGE","_order$user","_order$user2","_order$product","_order$product2","_order$product2$vendo","orderNumber","name","phone","vendor","createdAt","toLocaleDateString","pending","blob","toBlob","handleSendMessage","preventDefault","stopPropagation","trim","formData","FormData","setTimeout","_err$response9","_err$response9$data","openMessages","closeMessages","userRole","rawDisplayOrders","displayOrders","tableVariants","hidden","opacity","y","visible","transition","duration","staggerChildren","rowVariants","x","buttonVariants","hover","scale","boxShadow","tap","modalVariants","exit","div","className","initial","animate","onClick","placeholder","value","onChange","target","checked","button","variants","whileHover","whileTap","mode","p","idx","_order$user3","_order$user4","_order$product3","_order$product4","_order$product4$vendo","tr","src","alt","onError","onerror","select","Math","max","disabled","ceil","parseInt","min","ref","index","_selectedOrderForMess","_selectedOrderForMess2","_selectedOrderForMess3","isMyMessage","senderName","image","toLocaleString","isDelivered","onSubmit","accept","files"],"sources":["/root/shose/app-shose/frontend/src/pages/Orders.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { Document, Packer, Paragraph, Table, TableCell, TableRow, TextRun, WidthType } from 'docx';\nimport { saveAs } from 'file-saver';\nimport { io } from 'socket.io-client';\n\nconst Orders = () => {\n  const [orders, setOrders] = useState([]);\n  const [vendorSearch, setVendorSearch] = useState('');\n  const [phoneSearch, setPhoneSearch] = useState('');\n  const [orderNumberSearch, setOrderNumberSearch] = useState('');\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n  const [statusFilters, setStatusFilters] = useState({ rejected: false, shipped: false, delivered: false });\n  const [showUnreadOnly, setShowUnreadOnly] = useState(false);\n  const [selectedMedia, setSelectedMedia] = useState(null);\n  const [error, setError] = useState(null);\n  const [editOrder, setEditOrder] = useState(null);\n  const [editForm, setEditForm] = useState({ quantity: 1, address: '' });\n  const [selectedOrderForMessages, setSelectedOrderForMessages] = useState(null);\n  const [newMessage, setNewMessage] = useState('');\n  const [newImage, setNewImage] = useState(null);\n  const [newImagePreview, setNewImagePreview] = useState(null);\n  const [page, setPage] = useState(1);\n  const [total, setTotal] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const limit = 20;\n  const navigate = useNavigate();\n\n  // Refs\n  const socketRef = useRef(null);\n  const currentOrderIdRef = useRef(null);\n  const messagesContainerRef = useRef(null);\n  const messagesEndRef = useRef(null);\n\n  // Image preview effect\n  useEffect(() => {\n    if (newImage) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setNewImagePreview(reader.result);\n      };\n      reader.readAsDataURL(newImage);\n    } else {\n      setNewImagePreview(null);\n    }\n  }, [newImage]);\n\n  // Scroll to bottom ONLY when sending a message\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  // Socket authentication & connection management\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول');\n      navigate('/login');\n      return;\n    }\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      socketRef.current = io(process.env.REACT_APP_API_URL, { autoConnect: false });\n      const socket = socketRef.current;\n      socket.connect();\n      socket.emit('authenticate', { userId: payload.id, role: payload.role });\n      socket.on('connect', () => {\n        console.log('Socket connected successfully');\n        if (currentOrderIdRef.current) {\n          socket.emit('joinOrder', currentOrderIdRef.current);\n        }\n      });\n      socket.on('error', (err) => {\n        console.error('Socket.IO error:', err);\n        setError(`خطأ في الاتصال: ${err.message || 'غير معروف'}`);\n      });\n      socket.on('orderJoined', ({ orderId }) => {\n        console.log(`Successfully joined order room: ${orderId}`);\n      });\n      socket.on('disconnect', () => {\n        console.log('Socket disconnected');\n      });\n      return () => {\n        if (socket.connected) {\n          socket.disconnect();\n        }\n      };\n    } catch (e) {\n      console.error('Token decode error:', e);\n      setError('خطأ في التوثيق، يرجى تسجيل الدخول مرة أخرى');\n      localStorage.removeItem('token');\n      localStorage.removeItem('role');\n      localStorage.removeItem('userId');\n      navigate('/login');\n    }\n  }, [navigate]);\n\n  // Fetch orders\n  const fetchOrders = useCallback(() => {\n    setLoading(true);\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لجلب الطلبات');\n      navigate('/login');\n      return;\n    }\n    let url = `${process.env.REACT_APP_API_URL}/api/orders`;\n    const params = new URLSearchParams();\n    if (vendorSearch) params.append('vendorName', vendorSearch);\n    if (phoneSearch) params.append('phone', phoneSearch);\n    if (orderNumberSearch) params.append('orderNumber', orderNumberSearch);\n    if (startDate) params.append('startDate', startDate);\n    if (endDate) params.append('endDate', endDate);\n    if (statusFilters.rejected) params.append('status', 'rejected');\n    if (statusFilters.shipped) params.append('status', 'shipped');\n    if (statusFilters.delivered) params.append('status', 'delivered');\n    params.append('page', page);\n    params.append('limit', limit);\n    if (params.toString()) url += `?${params.toString()}`;\n    axios\n      .get(url, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(res => {\n        console.log('Fetched orders:', res.data);\n        setOrders(res.data.orders || []);\n        setTotal(res.data.total || 0);\n        setError(null);\n      })\n      .catch(err => {\n        console.error('Fetch orders error:', err);\n        const errorMessage = err.response?.data?.message || 'خطأ في جلب الطلبات: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      })\n      .finally(() => {\n        setLoading(false);\n      });\n  }, [vendorSearch, phoneSearch, orderNumberSearch, startDate, endDate, statusFilters, page, navigate]);\n\n  useEffect(() => {\n    fetchOrders();\n  }, [fetchOrders]);\n\n  // Messages modal socket handling (NO AUTO SCROLL)\n  useEffect(() => {\n    if (!selectedOrderForMessages || !socketRef.current) {\n      if (currentOrderIdRef.current && socketRef.current) {\n        socketRef.current.emit('leaveOrder', currentOrderIdRef.current);\n        currentOrderIdRef.current = null;\n      }\n      return;\n    }\n    const orderId = selectedOrderForMessages._id;\n    currentOrderIdRef.current = orderId;\n    socketRef.current.emit('joinOrder', orderId);\n    const token = localStorage.getItem('token');\n\n    // Mark as read\n    axios\n      .post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${orderId}/markRead`,\n        {},\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      )\n      .then(res => {\n        setOrders(prevOrders =>\n          prevOrders.map(o => (o._id === orderId ? { ...o, unreadCount: 0 } : o))\n        );\n        setSelectedOrderForMessages(prev => ({\n          ...prev,\n          messages: res.data.order.messages || [],\n          unreadCount: 0,\n        }));\n        // NO SCROLL HERE\n      })\n      .catch(err => {\n        console.error('Mark read error:', err);\n\t     // setError('خطأ في تحديث حالة القراءة');\n      });\n\n    const handleNewMessage = (message) => {\n      if (message.orderId !== orderId) return;\n      setSelectedOrderForMessages(prev => {\n        const exists = prev.messages?.some(m => m._id === message._id);\n        if (exists) return prev;\n        return {\n          ...prev,\n          messages: [...(prev.messages || []), message],\n        };\n      });\n      if (message.from !== getUserRole()) {\n        setOrders(prevOrders =>\n          prevOrders.map(o =>\n            o._id === orderId\n              ? { ...o, unreadCount: (o.unreadCount || 0) + 1 }\n              : o\n          )\n        );\n      }\n      // NO SCROLL ON RECEIVING MESSAGE\n    };\n\n    const handleMessagesUpdated = (data) => {\n      if (data.orderId !== orderId) return;\n      setSelectedOrderForMessages(prev => ({\n        ...prev,\n        messages: data.messages || [],\n        unreadCount: data.messages.filter(msg => !msg.isRead && msg.from !== getUserRole()).length,\n      }));\n      // NO SCROLL\n    };\n\n    const handleUnreadUpdate = ({ orderId: updatedId, unreadCount }) => {\n      setOrders(prev =>\n        prev.map(o => (o._id === updatedId ? { ...o, unreadCount } : o))\n      );\n      if (updatedId === orderId) {\n        setSelectedOrderForMessages(prev => ({ ...prev, unreadCount }));\n      }\n    };\n\n    const socket = socketRef.current;\n    socket.on('newMessage', handleNewMessage);\n    socket.on('messagesUpdated', handleMessagesUpdated);\n    socket.on('unreadUpdate', handleUnreadUpdate);\n\n    // NO INITIAL SCROLL\n\n    return () => {\n      socket.off('newMessage', handleNewMessage);\n      socket.off('messagesUpdated', handleMessagesUpdated);\n      socket.off('unreadUpdate', handleUnreadUpdate);\n      socket.emit('leaveOrder', orderId);\n      currentOrderIdRef.current = null;\n    };\n  }, [selectedOrderForMessages]);\n\n  // Delete order\n  const handleDeleteOrder = (id) => {\n    if (!window.confirm('هل تريد حذف هذا الطلب؟')) return;\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لتتمكن من حذف الطلبات');\n      navigate('/login');\n      return;\n    }\n    axios\n      .delete(`${process.env.REACT_APP_API_URL}/api/orders/${id}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(() => {\n        setOrders(prev => prev.filter(o => o._id !== id));\n        setError(null);\n        alert('تم حذف الطلب بنجاح');\n      })\n      .catch(err => {\n        const errorMessage = err.response?.data?.message || 'خطأ في الحذف: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n  };\n\n  // Update status\n  const handleUpdateStatus = (id, status) => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لتتمكن من تحديث حالة الطلب');\n      navigate('/login');\n      return;\n    }\n    axios\n      .put(\n        `${process.env.REACT_APP_API_URL}/api/orders/${id}/status`,\n        { status },\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      )\n      .then(res => {\n        setOrders(prev => prev.map(o => (o._id === id ? res.data.order : o)));\n        setError(null);\n        alert('تم تحديث حالة الطلب بنجاح');\n      })\n      .catch(err => {\n        const errorMessage = err.response?.data?.message || 'خطأ في التحديث: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n  };\n\n  // Edit order\n  const handleEditOrder = (order) => {\n    setEditOrder(order);\n    setEditForm({ quantity: order.quantity || 1, address: order.address || '' });\n  };\n\n  const handleEditSubmit = () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لتتمكن من تعديل الطلب');\n      navigate('/login');\n      return;\n    }\n    axios\n      .put(\n        `${process.env.REACT_APP_API_URL}/api/orders/${editOrder._id}`,\n        editForm,\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      )\n      .then(res => {\n        setOrders(prev => prev.map(o => (o._id === editOrder._id ? res.data.order : o)));\n        setEditOrder(null);\n        setEditForm({ quantity: 1, address: '' });\n        setError(null);\n        alert('تم تعديل الطلب بنجاح');\n      })\n      .catch(err => {\n        const errorMessage = err.response?.data?.message || 'خطأ في تعديل الطلب: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n  };\n\n  // Media handlers\n  const openMedia = (media) => {\n    if (media) {\n      setSelectedMedia({ url: `${process.env.REACT_APP_API_URL}/Uploads/${media}`, type: 'image' });\n    }\n  };\n  const closeMedia = () => setSelectedMedia(null);\n\n  // Group orders\n  const groupOrders = useCallback((ordersList, role) => {\n    if (role === 'customer') return ordersList;\n    const grouped = {};\n    ordersList.forEach(order => {\n      const key = `${order.product._id}-${order.user._id}-${order.address}`;\n      if (!grouped[key]) {\n        grouped[key] = {\n          ...order,\n          quantity: 0,\n          orderIds: [],\n          selectedImages: new Set(),\n          messages: [],\n          unreadCount: 0,\n        };\n      }\n      grouped[key].quantity += order.quantity;\n      grouped[key].orderIds.push(order._id);\n      grouped[key].messages = grouped[key].messages.concat(order.messages || []);\n      if (order.selectedImage) {\n        grouped[key].selectedImages.add(order.selectedImage);\n      }\n      if (order.messages) {\n        const unread = order.messages.filter(msg => !msg.isRead && msg.from !== role).length;\n        grouped[key].unreadCount += unread;\n      }\n    });\n    for (let key in grouped) {\n      grouped[key].messages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));\n    }\n    return Object.values(grouped).map(group => ({\n      ...group,\n      selectedImage: Array.from(group.selectedImages)[0] || 'placeholder-image.jpg',\n      isGrouped: group.orderIds.length > 1,\n      totalOrders: group.orderIds.length,\n      unreadCount: group.unreadCount,\n    }));\n  }, []);\n\n  // Export to Word\n  const exportToWord = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      let url = `${process.env.REACT_APP_API_URL}/api/orders`;\n      const params = new URLSearchParams();\n      if (vendorSearch) params.append('vendorName', vendorSearch);\n      if (phoneSearch) params.append('phone', phoneSearch);\n      if (orderNumberSearch) params.append('orderNumber', orderNumberSearch);\n      if (startDate) params.append('startDate', startDate);\n      if (endDate) params.append('endDate', endDate);\n      if (statusFilters.rejected) params.append('status', 'rejected');\n      if (statusFilters.shipped) params.append('status', 'shipped');\n      if (statusFilters.delivered) params.append('status', 'delivered');\n      if (params.toString()) url += `?${params.toString()}`;\n      const res = await axios.get(url, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      const allOrders = res.data.orders || res.data;\n      const grouped = groupOrders(allOrders, getUserRole());\n      const doc = new Document({\n        sections: [\n          {\n            children: [\n              new Paragraph({\n                children: [\n                  new TextRun({ text: 'قائمة الطلبات', size: 32, bold: true, rtl: true }),\n                ],\n                alignment: 'right',\n                spacing: { after: 200 },\n              }),\n              new Table({\n                rows: [\n                  new TableRow({\n                    children: [\n                      new TableCell({\n                        children: [new Paragraph({ text: 'رقم الطلب', rtl: true, bold: true })],\n                        width: { size: 10, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'الصورة', rtl: true, bold: true })],\n                        width: { size: 12, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'العميل', rtl: true, bold: true })],\n                        width: { size: 12, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'رقم الهاتف', rtl: true, bold: true })],\n                        width: { size: 12, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'العنوان', rtl: true, bold: true })],\n                        width: { size: 15, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'المنتج', rtl: true, bold: true })],\n                        width: { size: 12, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'التاجر', rtl: true, bold: true })],\n                        width: { size: 12, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'تاريخ الطلب', rtl: true, bold: true })],\n                        width: { size: 12, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'الحالة', rtl: true, bold: true })],\n                        width: { size: 12, type: WidthType.PERCENTAGE },\n                      }),\n                      new TableCell({\n                        children: [new Paragraph({ text: 'الكمية', rtl: true, bold: true })],\n                        width: { size: 13, type: WidthType.PERCENTAGE },\n                      }),\n                    ],\n                  }),\n                  ...grouped.map(order =>\n                    new TableRow({\n                      children: [\n                        new TableCell({\n                          children: [\n                            new Paragraph({ text: (order.orderNumber || '-').toString(), rtl: true }),\n                          ],\n                        }),\n                        new TableCell({\n                          children: [\n                            new Paragraph({\n                              text: order.selectedImage || 'placeholder-image.jpg',\n                              rtl: true,\n                            }),\n                          ],\n                        }),\n                        new TableCell({\n                          children: [new Paragraph({ text: order.user?.name || 'زائر', rtl: true })],\n                        }),\n                        new TableCell({\n                          children: [new Paragraph({ text: order.user?.phone || '-', rtl: true })],\n                        }),\n                        new TableCell({\n                          children: [new Paragraph({ text: order.address || '-', rtl: true })],\n                        }),\n                        new TableCell({\n                          children: [\n                            new Paragraph({ text: order.product?.name || 'غير معروف', rtl: true }),\n                          ],\n                        }),\n                        new TableCell({\n                          children: [\n                            new Paragraph({\n                              text: order.product?.vendor?.name || 'غير معروف',\n                              rtl: true,\n                            }),\n                          ],\n                        }),\n                        new TableCell({\n                          children: [\n                            new Paragraph({\n                              text: new Date(order.createdAt).toLocaleDateString('ar-EG') || '-',\n                              rtl: true,\n                            }),\n                          ],\n                        }),\n                        new TableCell({\n                          children: [\n                            new Paragraph({\n                              text:\n                                {\n                                  pending: 'تحت المراجعة',\n                                  shipped: 'جاري الشحن',\n                                  delivered: 'تم التسليم',\n                                  rejected: 'مرفوض',\n                                }[order.status] || 'غير معروف',\n                              rtl: true,\n                            }),\n                          ],\n                        }),\n                        new TableCell({\n                          children: [\n                            new Paragraph({\n                              text: order.isGrouped ? `${order.quantity} (مجمع)` : order.quantity.toString(),\n                              rtl: true,\n                            }),\n                          ],\n                        }),\n                      ],\n                    })\n                  ),\n                ],\n                width: { size: 100, type: WidthType.PERCENTAGE },\n              }),\n            ],\n          },\n        ],\n      });\n      const blob = await Packer.toBlob(doc);\n      saveAs(blob, 'orders.docx');\n      setError(null);\n    } catch (error) {\n      console.error('Export to Word error:', error);\n      setError('خطأ في تصدير الـ Word: ' + error.message);\n    }\n  };\n\n  // Send message handler (ONLY HERE WE SCROLL)\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول');\n      navigate('/login');\n      return;\n    }\n    if (!newMessage.trim() && !newImage) {\n      setError('يجب إدخال رسالة أو رفع صورة');\n      return;\n    }\n    const formData = new FormData();\n    if (newMessage.trim()) formData.append('text', newMessage.trim());\n    if (newImage) formData.append('image', newImage);\n    try {\n      const res = await axios.post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${selectedOrderForMessages._id}/message`,\n        formData,\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data',\n          },\n        }\n      );\n      setSelectedOrderForMessages(prev => ({\n        ...prev,\n        messages: res.data.order.messages || [],\n      }));\n      setNewMessage('');\n      setNewImage(null);\n      setNewImagePreview(null);\n      setError(null);\n\n      // ONLY SCROLL WHEN SENDING MESSAGE\n      setTimeout(() => {\n        scrollToBottom();\n      }, 100);\n    } catch (err) {\n      const errorMessage = err.response?.data?.message || 'خطأ في إرسال الرسالة';\n      setError(errorMessage);\n    }\n  };\n\n  // Messages modal open/close\n  const openMessages = (order) => {\n    setSelectedOrderForMessages(order);\n  };\n  const closeMessages = () => {\n    setSelectedOrderForMessages(null);\n    setNewMessage('');\n    setNewImage(null);\n    setNewImagePreview(null);\n  };\n\n  // User role getter\n  const getUserRole = () => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        return payload.role || 'user';\n      } catch (e) {\n        console.error('Error decoding token:', e);\n        setError('خطأ في فك تشفير التوكن، يرجى تسجيل الدخول مرة أخرى');\n        localStorage.removeItem('token');\n        localStorage.removeItem('role');\n        localStorage.removeItem('userId');\n        navigate('/login');\n        return 'user';\n      }\n    }\n    return 'user';\n  };\n  const userRole = getUserRole();\n\n  // Display orders\n  const rawDisplayOrders = showUnreadOnly ? orders.filter(o => (o.unreadCount || 0) > 0) : orders;\n  const displayOrders = groupOrders(rawDisplayOrders, userRole);\n\n  // Animation variants\n  const tableVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: { duration: 0.4, staggerChildren: 0.05 },\n    },\n  };\n  const rowVariants = {\n    hidden: { opacity: 0, x: -20 },\n    visible: { opacity: 1, x: 0, transition: { duration: 0.3 } },\n  };\n  const buttonVariants = {\n    hover: { scale: 1.05, boxShadow: '0 8px 16px rgba(255,0,0,0.3)' },\n    tap: { scale: 0.95 },\n  };\n  const modalVariants = {\n    hidden: { opacity: 0, scale: 0.85 },\n    visible: { opacity: 1, scale: 1, transition: { duration: 0.25 } },\n    exit: { opacity: 0, scale: 0.85, transition: { duration: 0.2 } },\n  };\n\n  return (\n    <motion.div\n      className=\"min-h-screen flex flex-col items-center bg-[#18191a] p-4 sm:p-6 text-white overflow-x-hidden\"\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ duration: 0.5 }}\n    >\n      {/* Header */}\n      <h1 className=\"text-3xl sm:text-4xl md:text-5xl font-bold mb-8 text-center bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700 drop-shadow-lg\">\n        قائمة الطلبات\n      </h1>\n\n      {/* Error Display */}\n      {error && (\n        <motion.div\n          className=\"w-full max-w-4xl bg-red-900/90 text-white p-4 rounded-2xl mb-6 text-center font-medium shadow-2xl\"\n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: -20 }}\n          transition={{ duration: 0.3 }}\n        >\n          {error}\n          <button\n            onClick={() => setError(null)}\n            className=\"ml-4 text-xl font-bold\"\n          >\n            ×\n          </button>\n        </motion.div>\n      )}\n\n      {/* Filters Section */}\n      {userRole !== 'customer' && (\n        <div className=\"w-full max-w-7xl mb-8 bg-[#242526] p-6 rounded-2xl shadow-2xl border border-gray-700\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-6\">\n            <input\n              type=\"text\"\n              placeholder=\"ابحث باسم التاجر\"\n              value={vendorSearch}\n              onChange={(e) => setVendorSearch(e.target.value)}\n              className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"\n            />\n            <input\n              type=\"text\"\n              placeholder=\"ابحث برقم الهاتف\"\n              value={phoneSearch}\n              onChange={(e) => setPhoneSearch(e.target.value)}\n              className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"\n            />\n            <input\n              type=\"text\"\n              placeholder=\"ابحث برقم الطلب\"\n              value={orderNumberSearch}\n              onChange={(e) => setOrderNumberSearch(e.target.value)}\n              className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"\n            />\n            <input\n              type=\"date\"\n              value={startDate}\n              onChange={(e) => setStartDate(e.target.value)}\n              className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"\n            />\n            <input\n              type=\"date\"\n              value={endDate}\n              onChange={(e) => setEndDate(e.target.value)}\n              className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"\n            />\n          </div>\n          <div className=\"flex flex-wrap items-center gap-4 mb-6\">\n            <span className=\"text-gray-300 font-medium\">فلتر الحالة:</span>\n            {['rejected', 'shipped', 'delivered'].map(status => (\n              <label key={status} className=\"flex items-center space-x-2 space-x-reverse cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={statusFilters[status]}\n                  onChange={(e) => setStatusFilters(prev => ({ ...prev, [status]: e.target.checked }))}\n                  className=\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\"\n                />\n                <span className=\"text-white\">\n                  {status === 'rejected' ? 'مرفوض' : status === 'shipped' ? 'جاري الشحن' : 'تم التسليم'}\n                </span>\n              </label>\n            ))}\n            <label className=\"flex items-center space-x-2 space-x-reverse cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={showUnreadOnly}\n                onChange={(e) => setShowUnreadOnly(e.target.checked)}\n                className=\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\"\n              />\n              <span className=\"text-white\">الطلبات التي بها رسائل غير مقروءة فقط</span>\n            </label>\n          </div>\n          <div className=\"flex flex-wrap gap-4\">\n            <motion.button\n              onClick={fetchOrders}\n              className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\"\n              variants={buttonVariants}\n              whileHover=\"hover\"\n              whileTap=\"tap\"\n            >\n              بحث\n            </motion.button>\n            <motion.button\n              onClick={exportToWord}\n              className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\"\n              variants={buttonVariants}\n              whileHover=\"hover\"\n              whileTap=\"tap\"\n            >\n              تصدير إلى Word\n            </motion.button>\n          </div>\n        </div>\n      )}\n\n      {/* Loading / Empty / Table */}\n      <AnimatePresence mode=\"wait\">\n        {loading && (\n          <motion.p\n            key=\"loading\"\n            className=\"text-2xl text-gray-400 py-12\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n          >\n            جاري التحميل...\n          </motion.p>\n        )}\n        {!loading && displayOrders.length === 0 && (\n          <motion.p\n            key=\"no-orders\"\n            className=\"text-2xl text-gray-400 py-12\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n          >\n            لا توجد طلبات حالياً.\n          </motion.p>\n        )}\n        {!loading && displayOrders.length > 0 && (\n          <motion.div\n            key=\"table-container\"\n            className=\"w-full max-w-7xl overflow-x-auto bg-[#242526] rounded-2xl shadow-2xl border border-gray-700\"\n            variants={tableVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n          >\n            <table className=\"min-w-full divide-y divide-gray-700\">\n              <thead className=\"bg-[#3a3b3c]\">\n                <tr>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">رقم الطلب</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الصورة</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">العميل</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">رقم الهاتف</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">العنوان</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">المنتج</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">التاجر</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">تاريخ الطلب</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الحالة</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الكمية</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الرسائل غير المقروءة</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">إجراءات</th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-[#242526] divide-y divide-gray-700\">\n                {displayOrders.map((order, idx) => (\n                  <motion.tr\n                    key={order.isGrouped ? `group-${idx}` : order._id}\n                    className=\"hover:bg-[#3a3b3c] transition duration-200\"\n                    variants={rowVariants}\n                  >\n                    <td className=\"py-4 px-6 text-right text-sm\">{order.orderNumber || '-'}</td>\n                    <td className=\"py-4 px-6 text-center\">\n                      <img\n                        src={`${process.env.REACT_APP_API_URL}/Uploads/${order.selectedImage}`}\n                        alt=\"صورة الطلب\"\n                        className=\"w-20 h-20 object-cover rounded-xl mx-auto cursor-pointer shadow-md hover:shadow-xl transition\"\n                        onClick={() => openMedia(order.selectedImage)}\n                        onError={(e) => {\n                          e.target.onerror = null;\n                          e.target.src = `${process.env.REACT_APP_API_URL}/Uploads/placeholder-image.jpg`;\n                        }}\n                      />\n                    </td>\n                    <td className=\"py-4 px-6 text-right font-medium\">{order.user?.name || 'زائر'}</td>\n                    <td className=\"py-4 px-6 text-right\">{order.user?.phone || '-'}</td>\n                    <td className=\"py-4 px-6 text-right text-ellipsis overflow-hidden max-w-xs\">{order.address || '-'}</td>\n                    <td className=\"py-4 px-6 text-right\">{order.product?.name || 'غير معروف'}</td>\n                    <td className=\"py-4 px-6 text-right\">{order.product?.vendor?.name || 'غير معروف'}</td>\n                    <td className=\"py-4 px-6 text-right\">{new Date(order.createdAt).toLocaleDateString('ar-EG')}</td>\n                    <td className=\"py-4 px-6 text-right\">\n                      <span\n                        className={`px-4 py-2 rounded-full text-xs font-bold ${\n                          order.status === 'pending'\n                            ? 'bg-yellow-600/30 text-yellow-300 border border-yellow-600'\n                            : order.status === 'shipped'\n                            ? 'bg-blue-600/30 text-blue-300 border border-blue-600'\n                            : order.status === 'delivered'\n                            ? 'bg-green-600/30 text-green-300 border border-green-600'\n                            : 'bg-red-600/30 text-red-300 border border-red-600'\n                        }`}\n                      >\n                        {{\n                          pending: 'تحت المراجعة',\n                          shipped: 'جاري الشحن',\n                          delivered: 'تم التسليم',\n                          rejected: 'مرفوض',\n                        }[order.status] || 'غير معروف'}\n                      </span>\n                    </td>\n                    <td className=\"py-4 px-6 text-right font-bold text-yellow-400\">\n                      {order.quantity} {order.isGrouped && `(مجمع من ${order.totalOrders} طلب)`}\n                    </td>\n                    <td className=\"py-4 px-6 text-center\">\n                      <motion.button\n                        onClick={() => openMessages(order)}\n                        className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-lg text-lg ${\n                          order.unreadCount > 0\n                            ? 'bg-gradient-to-r from-red-600 to-red-800 animate-pulse'\n                            : 'bg-gradient-to-r from-gray-600 to-gray-800'\n                        }`}\n                        variants={buttonVariants}\n                        whileHover=\"hover\"\n                        whileTap=\"tap\"\n                      >\n                        {order.unreadCount > 0 ? order.unreadCount : 0}\n                      </motion.button>\n                    </td>\n                    <td className=\"py-4 px-6\">\n                      <div className=\"flex items-center justify-end gap-3 flex-wrap\">\n                        {userRole === 'admin' && !order.isGrouped && (\n                          <>\n                            <motion.button\n                              className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\"\n                              variants={buttonVariants}\n                              whileHover=\"hover\"\n                              whileTap=\"tap\"\n                              onClick={() => handleEditOrder(order)}\n                            >\n                              تعديل\n                            </motion.button>\n                            <motion.button\n                              onClick={() => handleDeleteOrder(order._id)}\n                              className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\"\n                              variants={buttonVariants}\n                              whileHover=\"hover\"\n                              whileTap=\"tap\"\n                            >\n                              حذف\n                            </motion.button>\n                          </>\n                        )}\n                        {userRole === 'vendor' && !order.isGrouped && (\n                          <motion.select\n                            value={order.status}\n                            onChange={(e) => handleUpdateStatus(order._id, e.target.value)}\n                            className=\"p-3 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm\"\n                            variants={buttonVariants}\n                            whileHover=\"hover\"\n                          >\n                            <option value=\"pending\">تحت المراجعة</option>\n                            <option value=\"shipped\">جاري الشحن</option>\n                            <option value=\"delivered\">تم التسليم</option>\n                            <option value=\"rejected\">مرفوض</option>\n                          </motion.select>\n                        )}\n                        {userRole === 'customer' && order.status === 'pending' && !order.isGrouped && (\n                          <>\n                            <motion.button\n                              className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\"\n                              variants={buttonVariants}\n                              whileHover=\"hover\"\n                              whileTap=\"tap\"\n                              onClick={() => handleEditOrder(order)}\n                            >\n                              تعديل\n                            </motion.button>\n                            <motion.button\n                              onClick={() => handleDeleteOrder(order._id)}\n                              className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\"\n                              variants={buttonVariants}\n                              whileHover=\"hover\"\n                              whileTap=\"tap\"\n                            >\n                              حذف\n                            </motion.button>\n                          </>\n                        )}\n                      </div>\n                    </td>\n                  </motion.tr>\n                ))}\n              </tbody>\n            </table>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Pagination */}\n      {!loading && total > limit && (\n        <div className=\"flex justify-center items-center gap-6 mt-8\">\n          <motion.button\n            onClick={() => setPage(prev => Math.max(1, prev - 1))}\n            disabled={page === 1}\n            className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\"\n            variants={buttonVariants}\n            whileHover={page !== 1 ? \"hover\" : {}}\n            whileTap={page !== 1 ? \"tap\" : {}}\n          >\n            السابق\n          </motion.button>\n          <span className=\"text-xl text-gray-300\">\n            صفحة {page} من {Math.ceil(total / limit)}\n          </span>\n          <motion.button\n            onClick={() => setPage(prev => prev + 1)}\n            disabled={page * limit >= total}\n            className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\"\n            variants={buttonVariants}\n            whileHover={page * limit < total ? \"hover\" : {}}\n            whileTap={page * limit < total ? \"tap\" : {}}\n          >\n            التالي\n          </motion.button>\n        </div>\n      )}\n\n      {/* Edit Modal */}\n      <AnimatePresence>\n        {editOrder && !editOrder.isGrouped && (\n          <motion.div\n            className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\n            variants={modalVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n            exit=\"exit\"\n            onClick={() => setEditOrder(null)}\n          >\n            <motion.div\n              className=\"bg-[#242526] p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <h2 className=\"text-3xl font-bold mb-8 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\">\n                تعديل الطلب\n              </h2>\n              <div className=\"space-y-6\">\n                <input\n                  type=\"number\"\n                  placeholder=\"الكمية\"\n                  value={editForm.quantity}\n                  onChange={(e) => setEditForm({ ...editForm, quantity: parseInt(e.target.value) || 1 })}\n                  className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\"\n                  min=\"1\"\n                />\n                <input\n                  type=\"text\"\n                  placeholder=\"العنوان\"\n                  value={editForm.address}\n                  onChange={(e) => setEditForm({ ...editForm, address: e.target.value })}\n                  className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\"\n                />\n              </div>\n              <div className=\"flex gap-4 mt-8\">\n                <motion.button\n                  onClick={handleEditSubmit}\n                  className=\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-green-600 to-green-800 shadow-xl text-lg\"\n                  variants={buttonVariants}\n                  whileHover=\"hover\"\n                  whileTap=\"tap\"\n                >\n                  حفظ التعديلات\n                </motion.button>\n                <motion.button\n                  onClick={() => setEditOrder(null)}\n                  className=\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\"\n                  variants={buttonVariants}\n                  whileHover=\"hover\"\n                  whileTap=\"tap\"\n                >\n                  إلغاء\n                </motion.button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Messages Modal */}\n      <AnimatePresence>\n        {selectedOrderForMessages && (\n          <motion.div\n            className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\n            variants={modalVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n            exit=\"exit\"\n            onClick={closeMessages}\n          >\n            <motion.div\n              className=\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <h2 className=\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\">\n                الرسائل للطلب #{selectedOrderForMessages.orderNumber}\n              </h2>\n              <div\n                ref={messagesContainerRef}\n                className=\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\"\n              >\n                {selectedOrderForMessages.messages && selectedOrderForMessages.messages.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {selectedOrderForMessages.messages.map((msg, index) => {\n                      const isMyMessage = msg.from === userRole;\n                      const senderName = msg.from === 'vendor' ? selectedOrderForMessages.product?.vendor?.name : selectedOrderForMessages.user?.name || 'غير معروف';\n                      return (\n                        <div\n                          key={msg._id || index}\n                          className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}\n                        >\n                          <div\n                            className={`max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md ${\n                              isMyMessage ? 'bg-gradient-to-r from-red-600 to-red-800 text-white' : 'bg-gray-700 text-white'\n                            }`}\n                          >\n                            <p className=\"font-bold text-sm opacity-90\">\n                              {msg.from === 'vendor' ? 'التاجر' : 'العميل'}: {senderName}\n                            </p>\n                            {msg.text && <p className=\"mt-2 text-lg\">{msg.text}</p>}\n                            {msg.image && (\n                              <img\n                                src={`${process.env.REACT_APP_API_URL}/Uploads/${msg.image}`}\n                                alt=\"صورة الرسالة\"\n                                className=\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  openMedia(msg.image);\n                                }}\n                                onError={(e) => {\n                                  e.target.onerror = null;\n                                  e.target.src = `${process.env.REACT_APP_API_URL}/Uploads/placeholder-image.jpg`;\n                                }}\n                              />\n                            )}\n                            <div className=\"flex items-center justify-between mt-3 text-xs opacity-70\">\n                              <p>{new Date(msg.timestamp).toLocaleString('ar-EG')}</p>\n                              {isMyMessage && (\n                                <span>\n                                  {msg.isRead ? '✓✓' : msg.isDelivered ? '✓' : '✓'}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-gray-400 text-lg\">لا توجد رسائل بعد.</p>\n                )}\n                <div ref={messagesEndRef} />\n              </div>\n              {(userRole === 'vendor' || userRole === 'customer') && (\n                <form onSubmit={handleSendMessage} className=\"space-y-4\">\n                  <textarea\n                    placeholder=\"اكتب رسالتك هنا...\"\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\"\n                    rows=\"4\"\n                  />\n                  <div className=\"flex items-center gap-4\">\n                    <input\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={(e) => setNewImage(e.target.files[0] || null)}\n                      className=\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\"\n                    />\n                    {newImagePreview && (\n                      <div className=\"relative\">\n                        <img src={newImagePreview} alt=\"معاينة\" className=\"w-24 h-24 object-cover rounded-xl shadow-lg\" />\n                        <button\n                          type=\"button\"\n                          onClick={() => {\n                            setNewImage(null);\n                            setNewImagePreview(null);\n                          }}\n                          className=\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\"\n                        >\n                          ×\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                  <motion.button\n                    type=\"submit\"\n                    className=\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\"\n                    variants={buttonVariants}\n                    whileHover=\"hover\"\n                    whileTap=\"tap\"\n                  >\n                    إرسال الرسالة\n                  </motion.button>\n                </form>\n              )}\n              <motion.button\n                onClick={closeMessages}\n                className=\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\"\n                variants={buttonVariants}\n                whileHover=\"hover\"\n                whileTap=\"tap\"\n              >\n                إغلاق\n              </motion.button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Media Viewer Modal */}\n      <AnimatePresence>\n        {selectedMedia && (\n          <motion.div\n            className=\"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4\"\n            variants={modalVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n            exit=\"exit\"\n            onClick={closeMedia}\n          >\n            <motion.div className=\"relative max-w-4xl max-h-full\" onClick={(e) => e.stopPropagation()}>\n              <img\n                src={selectedMedia.url}\n                className=\"max-w-full max-h-full rounded-2xl shadow-2xl\"\n                alt=\"صورة مكبرة\"\n                onError={(e) => {\n                  e.target.onerror = null;\n                  e.target.src = `${process.env.REACT_APP_API_URL}/Uploads/placeholder-image.jpg`;\n                }}\n              />\n              <motion.button\n                onClick={closeMedia}\n                className=\"absolute top-4 right-4 text-white text-5xl bg-black/70 rounded-full w-14 h-14 flex items-center justify-center shadow-xl hover:bg-black/90 transition\"\n                variants={buttonVariants}\n                whileHover=\"hover\"\n                whileTap=\"tap\"\n              >\n                ×\n              </motion.button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n};\n\nexport default Orders;\n"],"mappings":"mHAAA,OAASA,QAAQ,CAAEC,SAAS,CAAEC,MAAM,CAAEC,WAAW,KAAQ,OAAO,CAChE,OAASC,MAAM,CAAEC,eAAe,KAAQ,eAAe,CACvD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,QAAQ,CAAEC,MAAM,CAAEC,SAAS,CAAEC,KAAK,CAAEC,SAAS,CAAEC,QAAQ,CAAEC,OAAO,CAAEC,SAAS,KAAQ,MAAM,CAClG,OAASC,MAAM,KAAQ,YAAY,CACnC,OAASC,EAAE,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAEtC,KAAM,CAAAC,MAAM,CAAGA,CAAA,GAAM,CACnB,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAG1B,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAAC2B,YAAY,CAAEC,eAAe,CAAC,CAAG5B,QAAQ,CAAC,EAAE,CAAC,CACpD,KAAM,CAAC6B,WAAW,CAAEC,cAAc,CAAC,CAAG9B,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAAC+B,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGhC,QAAQ,CAAC,EAAE,CAAC,CAC9D,KAAM,CAACiC,SAAS,CAAEC,YAAY,CAAC,CAAGlC,QAAQ,CAAC,EAAE,CAAC,CAC9C,KAAM,CAACmC,OAAO,CAAEC,UAAU,CAAC,CAAGpC,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACqC,aAAa,CAAEC,gBAAgB,CAAC,CAAGtC,QAAQ,CAAC,CAAEuC,QAAQ,CAAE,KAAK,CAAEC,OAAO,CAAE,KAAK,CAAEC,SAAS,CAAE,KAAM,CAAC,CAAC,CACzG,KAAM,CAACC,cAAc,CAAEC,iBAAiB,CAAC,CAAG3C,QAAQ,CAAC,KAAK,CAAC,CAC3D,KAAM,CAAC4C,aAAa,CAAEC,gBAAgB,CAAC,CAAG7C,QAAQ,CAAC,IAAI,CAAC,CACxD,KAAM,CAAC8C,KAAK,CAAEC,QAAQ,CAAC,CAAG/C,QAAQ,CAAC,IAAI,CAAC,CACxC,KAAM,CAACgD,SAAS,CAAEC,YAAY,CAAC,CAAGjD,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAACkD,QAAQ,CAAEC,WAAW,CAAC,CAAGnD,QAAQ,CAAC,CAAEoD,QAAQ,CAAE,CAAC,CAAEC,OAAO,CAAE,EAAG,CAAC,CAAC,CACtE,KAAM,CAACC,wBAAwB,CAAEC,2BAA2B,CAAC,CAAGvD,QAAQ,CAAC,IAAI,CAAC,CAC9E,KAAM,CAACwD,UAAU,CAAEC,aAAa,CAAC,CAAGzD,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC0D,QAAQ,CAAEC,WAAW,CAAC,CAAG3D,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAAC4D,eAAe,CAAEC,kBAAkB,CAAC,CAAG7D,QAAQ,CAAC,IAAI,CAAC,CAC5D,KAAM,CAAC8D,IAAI,CAAEC,OAAO,CAAC,CAAG/D,QAAQ,CAAC,CAAC,CAAC,CACnC,KAAM,CAACgE,KAAK,CAAEC,QAAQ,CAAC,CAAGjE,QAAQ,CAAC,CAAC,CAAC,CACrC,KAAM,CAACkE,OAAO,CAAEC,UAAU,CAAC,CAAGnE,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAAoE,KAAK,CAAG,EAAE,CAChB,KAAM,CAAAC,QAAQ,CAAG/D,WAAW,CAAC,CAAC,CAE9B;AACA,KAAM,CAAAgE,SAAS,CAAGpE,MAAM,CAAC,IAAI,CAAC,CAC9B,KAAM,CAAAqE,iBAAiB,CAAGrE,MAAM,CAAC,IAAI,CAAC,CACtC,KAAM,CAAAsE,oBAAoB,CAAGtE,MAAM,CAAC,IAAI,CAAC,CACzC,KAAM,CAAAuE,cAAc,CAAGvE,MAAM,CAAC,IAAI,CAAC,CAEnC;AACAD,SAAS,CAAC,IAAM,CACd,GAAIyD,QAAQ,CAAE,CACZ,KAAM,CAAAgB,MAAM,CAAG,GAAI,CAAAC,UAAU,CAAC,CAAC,CAC/BD,MAAM,CAACE,SAAS,CAAG,IAAM,CACvBf,kBAAkB,CAACa,MAAM,CAACG,MAAM,CAAC,CACnC,CAAC,CACDH,MAAM,CAACI,aAAa,CAACpB,QAAQ,CAAC,CAChC,CAAC,IAAM,CACLG,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CACF,CAAC,CAAE,CAACH,QAAQ,CAAC,CAAC,CAEd;AACA,KAAM,CAAAqB,cAAc,CAAGA,CAAA,GAAM,KAAAC,qBAAA,CAC3B,CAAAA,qBAAA,CAAAP,cAAc,CAACQ,OAAO,UAAAD,qBAAA,iBAAtBA,qBAAA,CAAwBE,cAAc,CAAC,CAAEC,QAAQ,CAAE,QAAS,CAAC,CAAC,CAChE,CAAC,CAED;AACAlF,SAAS,CAAC,IAAM,CACd,KAAM,CAAAmF,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVrC,QAAQ,CAAC,mBAAmB,CAAC,CAC7BsB,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACA,GAAI,CACF,KAAM,CAAAkB,OAAO,CAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACN,KAAK,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CACrDrB,SAAS,CAACW,OAAO,CAAGhE,EAAE,CAAC2E,OAAO,CAACC,GAAG,CAACC,iBAAiB,CAAE,CAAEC,WAAW,CAAE,KAAM,CAAC,CAAC,CAC7E,KAAM,CAAAC,MAAM,CAAG1B,SAAS,CAACW,OAAO,CAChCe,MAAM,CAACC,OAAO,CAAC,CAAC,CAChBD,MAAM,CAACE,IAAI,CAAC,cAAc,CAAE,CAAEC,MAAM,CAAEZ,OAAO,CAACa,EAAE,CAAEC,IAAI,CAAEd,OAAO,CAACc,IAAK,CAAC,CAAC,CACvEL,MAAM,CAACM,EAAE,CAAC,SAAS,CAAE,IAAM,CACzBC,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC,CAC5C,GAAIjC,iBAAiB,CAACU,OAAO,CAAE,CAC7Be,MAAM,CAACE,IAAI,CAAC,WAAW,CAAE3B,iBAAiB,CAACU,OAAO,CAAC,CACrD,CACF,CAAC,CAAC,CACFe,MAAM,CAACM,EAAE,CAAC,OAAO,CAAGG,GAAG,EAAK,CAC1BF,OAAO,CAACzD,KAAK,CAAC,kBAAkB,CAAE2D,GAAG,CAAC,CACtC1D,QAAQ,gFAAA2D,MAAA,CAAoBD,GAAG,CAACE,OAAO,EAAI,WAAW,CAAE,CAAC,CAC3D,CAAC,CAAC,CACFX,MAAM,CAACM,EAAE,CAAC,aAAa,CAAEM,IAAA,EAAiB,IAAhB,CAAEC,OAAQ,CAAC,CAAAD,IAAA,CACnCL,OAAO,CAACC,GAAG,oCAAAE,MAAA,CAAoCG,OAAO,CAAE,CAAC,CAC3D,CAAC,CAAC,CACFb,MAAM,CAACM,EAAE,CAAC,YAAY,CAAE,IAAM,CAC5BC,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC,CACpC,CAAC,CAAC,CACF,MAAO,IAAM,CACX,GAAIR,MAAM,CAACc,SAAS,CAAE,CACpBd,MAAM,CAACe,UAAU,CAAC,CAAC,CACrB,CACF,CAAC,CACH,CAAE,MAAOC,CAAC,CAAE,CACVT,OAAO,CAACzD,KAAK,CAAC,qBAAqB,CAAEkE,CAAC,CAAC,CACvCjE,QAAQ,CAAC,4CAA4C,CAAC,CACtDsC,YAAY,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAChC5B,YAAY,CAAC4B,UAAU,CAAC,MAAM,CAAC,CAC/B5B,YAAY,CAAC4B,UAAU,CAAC,QAAQ,CAAC,CACjC5C,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAAE,CAACA,QAAQ,CAAC,CAAC,CAEd;AACA,KAAM,CAAA6C,WAAW,CAAG/G,WAAW,CAAC,IAAM,CACpCgE,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAiB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVrC,QAAQ,CAAC,gCAAgC,CAAC,CAC1CsB,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACA,GAAI,CAAA8C,GAAG,IAAAT,MAAA,CAAMd,OAAO,CAACC,GAAG,CAACC,iBAAiB,eAAa,CACvD,KAAM,CAAAsB,MAAM,CAAG,GAAI,CAAAC,eAAe,CAAC,CAAC,CACpC,GAAI1F,YAAY,CAAEyF,MAAM,CAACE,MAAM,CAAC,YAAY,CAAE3F,YAAY,CAAC,CAC3D,GAAIE,WAAW,CAAEuF,MAAM,CAACE,MAAM,CAAC,OAAO,CAAEzF,WAAW,CAAC,CACpD,GAAIE,iBAAiB,CAAEqF,MAAM,CAACE,MAAM,CAAC,aAAa,CAAEvF,iBAAiB,CAAC,CACtE,GAAIE,SAAS,CAAEmF,MAAM,CAACE,MAAM,CAAC,WAAW,CAAErF,SAAS,CAAC,CACpD,GAAIE,OAAO,CAAEiF,MAAM,CAACE,MAAM,CAAC,SAAS,CAAEnF,OAAO,CAAC,CAC9C,GAAIE,aAAa,CAACE,QAAQ,CAAE6E,MAAM,CAACE,MAAM,CAAC,QAAQ,CAAE,UAAU,CAAC,CAC/D,GAAIjF,aAAa,CAACG,OAAO,CAAE4E,MAAM,CAACE,MAAM,CAAC,QAAQ,CAAE,SAAS,CAAC,CAC7D,GAAIjF,aAAa,CAACI,SAAS,CAAE2E,MAAM,CAACE,MAAM,CAAC,QAAQ,CAAE,WAAW,CAAC,CACjEF,MAAM,CAACE,MAAM,CAAC,MAAM,CAAExD,IAAI,CAAC,CAC3BsD,MAAM,CAACE,MAAM,CAAC,OAAO,CAAElD,KAAK,CAAC,CAC7B,GAAIgD,MAAM,CAACG,QAAQ,CAAC,CAAC,CAAEJ,GAAG,MAAAT,MAAA,CAAQU,MAAM,CAACG,QAAQ,CAAC,CAAC,CAAE,CACrDhH,KAAK,CACFiH,GAAG,CAACL,GAAG,CAAE,CACRM,OAAO,CAAE,CAAEC,aAAa,WAAAhB,MAAA,CAAYtB,KAAK,CAAG,CAC9C,CAAC,CAAC,CACDuC,IAAI,CAACC,GAAG,EAAI,CACXrB,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEoB,GAAG,CAACC,IAAI,CAAC,CACxCnG,SAAS,CAACkG,GAAG,CAACC,IAAI,CAACpG,MAAM,EAAI,EAAE,CAAC,CAChCwC,QAAQ,CAAC2D,GAAG,CAACC,IAAI,CAAC7D,KAAK,EAAI,CAAC,CAAC,CAC7BjB,QAAQ,CAAC,IAAI,CAAC,CAChB,CAAC,CAAC,CACD+E,KAAK,CAACrB,GAAG,EAAI,KAAAsB,aAAA,CAAAC,kBAAA,CAAAC,cAAA,CACZ1B,OAAO,CAACzD,KAAK,CAAC,qBAAqB,CAAE2D,GAAG,CAAC,CACzC,KAAM,CAAAyB,YAAY,CAAG,EAAAH,aAAA,CAAAtB,GAAG,CAAC0B,QAAQ,UAAAJ,aAAA,kBAAAC,kBAAA,CAAZD,aAAA,CAAcF,IAAI,UAAAG,kBAAA,iBAAlBA,kBAAA,CAAoBrB,OAAO,GAAI,sBAAsB,CAAGF,GAAG,CAACE,OAAO,CACxF5D,QAAQ,CAACmF,YAAY,CAAC,CACtB,GAAI,EAAAD,cAAA,CAAAxB,GAAG,CAAC0B,QAAQ,UAAAF,cAAA,iBAAZA,cAAA,CAAcG,MAAM,IAAK,GAAG,CAAE,CAChCrF,QAAQ,CAAC,sCAAsC,CAAC,CAChDsC,YAAY,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAChC5B,YAAY,CAAC4B,UAAU,CAAC,MAAM,CAAC,CAC/B5B,YAAY,CAAC4B,UAAU,CAAC,QAAQ,CAAC,CACjC5C,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAAC,CACDgE,OAAO,CAAC,IAAM,CACblE,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAC,CACN,CAAC,CAAE,CAACxC,YAAY,CAAEE,WAAW,CAAEE,iBAAiB,CAAEE,SAAS,CAAEE,OAAO,CAAEE,aAAa,CAAEyB,IAAI,CAAEO,QAAQ,CAAC,CAAC,CAErGpE,SAAS,CAAC,IAAM,CACdiH,WAAW,CAAC,CAAC,CACf,CAAC,CAAE,CAACA,WAAW,CAAC,CAAC,CAEjB;AACAjH,SAAS,CAAC,IAAM,CACd,GAAI,CAACqD,wBAAwB,EAAI,CAACgB,SAAS,CAACW,OAAO,CAAE,CACnD,GAAIV,iBAAiB,CAACU,OAAO,EAAIX,SAAS,CAACW,OAAO,CAAE,CAClDX,SAAS,CAACW,OAAO,CAACiB,IAAI,CAAC,YAAY,CAAE3B,iBAAiB,CAACU,OAAO,CAAC,CAC/DV,iBAAiB,CAACU,OAAO,CAAG,IAAI,CAClC,CACA,OACF,CACA,KAAM,CAAA4B,OAAO,CAAGvD,wBAAwB,CAACgF,GAAG,CAC5C/D,iBAAiB,CAACU,OAAO,CAAG4B,OAAO,CACnCvC,SAAS,CAACW,OAAO,CAACiB,IAAI,CAAC,WAAW,CAAEW,OAAO,CAAC,CAC5C,KAAM,CAAAzB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAE3C;AACA/E,KAAK,CACFgI,IAAI,IAAA7B,MAAA,CACAd,OAAO,CAACC,GAAG,CAACC,iBAAiB,iBAAAY,MAAA,CAAeG,OAAO,cACtD,CAAC,CAAC,CACF,CACEY,OAAO,CAAE,CAAEC,aAAa,WAAAhB,MAAA,CAAYtB,KAAK,CAAG,CAC9C,CACF,CAAC,CACAuC,IAAI,CAACC,GAAG,EAAI,CACXlG,SAAS,CAAC8G,UAAU,EAClBA,UAAU,CAACC,GAAG,CAACC,CAAC,EAAKA,CAAC,CAACJ,GAAG,GAAKzB,OAAO,CAAA8B,aAAA,CAAAA,aAAA,IAAQD,CAAC,MAAEE,WAAW,CAAE,CAAC,GAAKF,CAAE,CACxE,CAAC,CACDnF,2BAA2B,CAACsF,IAAI,EAAAF,aAAA,CAAAA,aAAA,IAC3BE,IAAI,MACPC,QAAQ,CAAElB,GAAG,CAACC,IAAI,CAACkB,KAAK,CAACD,QAAQ,EAAI,EAAE,CACvCF,WAAW,CAAE,CAAC,EACd,CAAC,CACH;AACF,CAAC,CAAC,CACDd,KAAK,CAACrB,GAAG,EAAI,CACZF,OAAO,CAACzD,KAAK,CAAC,kBAAkB,CAAE2D,GAAG,CAAC,CACxC;AACA,CAAC,CAAC,CAEJ,KAAM,CAAAuC,gBAAgB,CAAIrC,OAAO,EAAK,CACpC,GAAIA,OAAO,CAACE,OAAO,GAAKA,OAAO,CAAE,OACjCtD,2BAA2B,CAACsF,IAAI,EAAI,KAAAI,cAAA,CAClC,KAAM,CAAAC,MAAM,EAAAD,cAAA,CAAGJ,IAAI,CAACC,QAAQ,UAAAG,cAAA,iBAAbA,cAAA,CAAeE,IAAI,CAACC,CAAC,EAAIA,CAAC,CAACd,GAAG,GAAK3B,OAAO,CAAC2B,GAAG,CAAC,CAC9D,GAAIY,MAAM,CAAE,MAAO,CAAAL,IAAI,CACvB,OAAAF,aAAA,CAAAA,aAAA,IACKE,IAAI,MACPC,QAAQ,CAAE,CAAC,IAAID,IAAI,CAACC,QAAQ,EAAI,EAAE,CAAC,CAAEnC,OAAO,CAAC,GAEjD,CAAC,CAAC,CACF,GAAIA,OAAO,CAAC0C,IAAI,GAAKC,WAAW,CAAC,CAAC,CAAE,CAClC5H,SAAS,CAAC8G,UAAU,EAClBA,UAAU,CAACC,GAAG,CAACC,CAAC,EACdA,CAAC,CAACJ,GAAG,GAAKzB,OAAO,CAAA8B,aAAA,CAAAA,aAAA,IACRD,CAAC,MAAEE,WAAW,CAAE,CAACF,CAAC,CAACE,WAAW,EAAI,CAAC,EAAI,CAAC,GAC7CF,CACN,CACF,CAAC,CACH,CACA;AACF,CAAC,CAED,KAAM,CAAAa,qBAAqB,CAAI1B,IAAI,EAAK,CACtC,GAAIA,IAAI,CAAChB,OAAO,GAAKA,OAAO,CAAE,OAC9BtD,2BAA2B,CAACsF,IAAI,EAAAF,aAAA,CAAAA,aAAA,IAC3BE,IAAI,MACPC,QAAQ,CAAEjB,IAAI,CAACiB,QAAQ,EAAI,EAAE,CAC7BF,WAAW,CAAEf,IAAI,CAACiB,QAAQ,CAACU,MAAM,CAACC,GAAG,EAAI,CAACA,GAAG,CAACC,MAAM,EAAID,GAAG,CAACJ,IAAI,GAAKC,WAAW,CAAC,CAAC,CAAC,CAACK,MAAM,EAC1F,CAAC,CACH;AACF,CAAC,CAED,KAAM,CAAAC,kBAAkB,CAAGC,KAAA,EAAyC,IAAxC,CAAEhD,OAAO,CAAEiD,SAAS,CAAElB,WAAY,CAAC,CAAAiB,KAAA,CAC7DnI,SAAS,CAACmH,IAAI,EACZA,IAAI,CAACJ,GAAG,CAACC,CAAC,EAAKA,CAAC,CAACJ,GAAG,GAAKwB,SAAS,CAAAnB,aAAA,CAAAA,aAAA,IAAQD,CAAC,MAAEE,WAAW,GAAKF,CAAE,CACjE,CAAC,CACD,GAAIoB,SAAS,GAAKjD,OAAO,CAAE,CACzBtD,2BAA2B,CAACsF,IAAI,EAAAF,aAAA,CAAAA,aAAA,IAAUE,IAAI,MAAED,WAAW,EAAG,CAAC,CACjE,CACF,CAAC,CAED,KAAM,CAAA5C,MAAM,CAAG1B,SAAS,CAACW,OAAO,CAChCe,MAAM,CAACM,EAAE,CAAC,YAAY,CAAE0C,gBAAgB,CAAC,CACzChD,MAAM,CAACM,EAAE,CAAC,iBAAiB,CAAEiD,qBAAqB,CAAC,CACnDvD,MAAM,CAACM,EAAE,CAAC,cAAc,CAAEsD,kBAAkB,CAAC,CAE7C;AAEA,MAAO,IAAM,CACX5D,MAAM,CAAC+D,GAAG,CAAC,YAAY,CAAEf,gBAAgB,CAAC,CAC1ChD,MAAM,CAAC+D,GAAG,CAAC,iBAAiB,CAAER,qBAAqB,CAAC,CACpDvD,MAAM,CAAC+D,GAAG,CAAC,cAAc,CAAEH,kBAAkB,CAAC,CAC9C5D,MAAM,CAACE,IAAI,CAAC,YAAY,CAAEW,OAAO,CAAC,CAClCtC,iBAAiB,CAACU,OAAO,CAAG,IAAI,CAClC,CAAC,CACH,CAAC,CAAE,CAAC3B,wBAAwB,CAAC,CAAC,CAE9B;AACA,KAAM,CAAA0G,iBAAiB,CAAI5D,EAAE,EAAK,CAChC,GAAI,CAAC6D,MAAM,CAACC,OAAO,CAAC,wBAAwB,CAAC,CAAE,OAC/C,KAAM,CAAA9E,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVrC,QAAQ,CAAC,yCAAyC,CAAC,CACnDsB,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACA9D,KAAK,CACF4J,MAAM,IAAAzD,MAAA,CAAId,OAAO,CAACC,GAAG,CAACC,iBAAiB,iBAAAY,MAAA,CAAeN,EAAE,EAAI,CAC3DqB,OAAO,CAAE,CAAEC,aAAa,WAAAhB,MAAA,CAAYtB,KAAK,CAAG,CAC9C,CAAC,CAAC,CACDuC,IAAI,CAAC,IAAM,CACVjG,SAAS,CAACmH,IAAI,EAAIA,IAAI,CAACW,MAAM,CAACd,CAAC,EAAIA,CAAC,CAACJ,GAAG,GAAKlC,EAAE,CAAC,CAAC,CACjDrD,QAAQ,CAAC,IAAI,CAAC,CACdqH,KAAK,CAAC,oBAAoB,CAAC,CAC7B,CAAC,CAAC,CACDtC,KAAK,CAACrB,GAAG,EAAI,KAAA4D,cAAA,CAAAC,mBAAA,CAAAC,cAAA,CACZ,KAAM,CAAArC,YAAY,CAAG,EAAAmC,cAAA,CAAA5D,GAAG,CAAC0B,QAAQ,UAAAkC,cAAA,kBAAAC,mBAAA,CAAZD,cAAA,CAAcxC,IAAI,UAAAyC,mBAAA,iBAAlBA,mBAAA,CAAoB3D,OAAO,GAAI,gBAAgB,CAAGF,GAAG,CAACE,OAAO,CAClF5D,QAAQ,CAACmF,YAAY,CAAC,CACtB,GAAI,EAAAqC,cAAA,CAAA9D,GAAG,CAAC0B,QAAQ,UAAAoC,cAAA,iBAAZA,cAAA,CAAcnC,MAAM,IAAK,GAAG,CAAE,CAChCrF,QAAQ,CAAC,sCAAsC,CAAC,CAChDsC,YAAY,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAChC5B,YAAY,CAAC4B,UAAU,CAAC,MAAM,CAAC,CAC/B5B,YAAY,CAAC4B,UAAU,CAAC,QAAQ,CAAC,CACjC5C,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAAC,CACN,CAAC,CAED;AACA,KAAM,CAAAmG,kBAAkB,CAAGA,CAACpE,EAAE,CAAEgC,MAAM,GAAK,CACzC,KAAM,CAAAhD,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVrC,QAAQ,CAAC,8CAA8C,CAAC,CACxDsB,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACA9D,KAAK,CACFkK,GAAG,IAAA/D,MAAA,CACCd,OAAO,CAACC,GAAG,CAACC,iBAAiB,iBAAAY,MAAA,CAAeN,EAAE,YACjD,CAAEgC,MAAO,CAAC,CACV,CACEX,OAAO,CAAE,CAAEC,aAAa,WAAAhB,MAAA,CAAYtB,KAAK,CAAG,CAC9C,CACF,CAAC,CACAuC,IAAI,CAACC,GAAG,EAAI,CACXlG,SAAS,CAACmH,IAAI,EAAIA,IAAI,CAACJ,GAAG,CAACC,CAAC,EAAKA,CAAC,CAACJ,GAAG,GAAKlC,EAAE,CAAGwB,GAAG,CAACC,IAAI,CAACkB,KAAK,CAAGL,CAAE,CAAC,CAAC,CACrE3F,QAAQ,CAAC,IAAI,CAAC,CACdqH,KAAK,CAAC,2BAA2B,CAAC,CACpC,CAAC,CAAC,CACDtC,KAAK,CAACrB,GAAG,EAAI,KAAAiE,cAAA,CAAAC,mBAAA,CAAAC,cAAA,CACZ,KAAM,CAAA1C,YAAY,CAAG,EAAAwC,cAAA,CAAAjE,GAAG,CAAC0B,QAAQ,UAAAuC,cAAA,kBAAAC,mBAAA,CAAZD,cAAA,CAAc7C,IAAI,UAAA8C,mBAAA,iBAAlBA,mBAAA,CAAoBhE,OAAO,GAAI,kBAAkB,CAAGF,GAAG,CAACE,OAAO,CACpF5D,QAAQ,CAACmF,YAAY,CAAC,CACtB,GAAI,EAAA0C,cAAA,CAAAnE,GAAG,CAAC0B,QAAQ,UAAAyC,cAAA,iBAAZA,cAAA,CAAcxC,MAAM,IAAK,GAAG,CAAE,CAChCrF,QAAQ,CAAC,sCAAsC,CAAC,CAChDsC,YAAY,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAChC5B,YAAY,CAAC4B,UAAU,CAAC,MAAM,CAAC,CAC/B5B,YAAY,CAAC4B,UAAU,CAAC,QAAQ,CAAC,CACjC5C,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAAC,CACN,CAAC,CAED;AACA,KAAM,CAAAwG,eAAe,CAAI9B,KAAK,EAAK,CACjC9F,YAAY,CAAC8F,KAAK,CAAC,CACnB5F,WAAW,CAAC,CAAEC,QAAQ,CAAE2F,KAAK,CAAC3F,QAAQ,EAAI,CAAC,CAAEC,OAAO,CAAE0F,KAAK,CAAC1F,OAAO,EAAI,EAAG,CAAC,CAAC,CAC9E,CAAC,CAED,KAAM,CAAAyH,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,KAAM,CAAA1F,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVrC,QAAQ,CAAC,yCAAyC,CAAC,CACnDsB,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACA9D,KAAK,CACFkK,GAAG,IAAA/D,MAAA,CACCd,OAAO,CAACC,GAAG,CAACC,iBAAiB,iBAAAY,MAAA,CAAe1D,SAAS,CAACsF,GAAG,EAC5DpF,QAAQ,CACR,CACEuE,OAAO,CAAE,CAAEC,aAAa,WAAAhB,MAAA,CAAYtB,KAAK,CAAG,CAC9C,CACF,CAAC,CACAuC,IAAI,CAACC,GAAG,EAAI,CACXlG,SAAS,CAACmH,IAAI,EAAIA,IAAI,CAACJ,GAAG,CAACC,CAAC,EAAKA,CAAC,CAACJ,GAAG,GAAKtF,SAAS,CAACsF,GAAG,CAAGV,GAAG,CAACC,IAAI,CAACkB,KAAK,CAAGL,CAAE,CAAC,CAAC,CAChFzF,YAAY,CAAC,IAAI,CAAC,CAClBE,WAAW,CAAC,CAAEC,QAAQ,CAAE,CAAC,CAAEC,OAAO,CAAE,EAAG,CAAC,CAAC,CACzCN,QAAQ,CAAC,IAAI,CAAC,CACdqH,KAAK,CAAC,sBAAsB,CAAC,CAC/B,CAAC,CAAC,CACDtC,KAAK,CAACrB,GAAG,EAAI,KAAAsE,cAAA,CAAAC,mBAAA,CAAAC,cAAA,CACZ,KAAM,CAAA/C,YAAY,CAAG,EAAA6C,cAAA,CAAAtE,GAAG,CAAC0B,QAAQ,UAAA4C,cAAA,kBAAAC,mBAAA,CAAZD,cAAA,CAAclD,IAAI,UAAAmD,mBAAA,iBAAlBA,mBAAA,CAAoBrE,OAAO,GAAI,sBAAsB,CAAGF,GAAG,CAACE,OAAO,CACxF5D,QAAQ,CAACmF,YAAY,CAAC,CACtB,GAAI,EAAA+C,cAAA,CAAAxE,GAAG,CAAC0B,QAAQ,UAAA8C,cAAA,iBAAZA,cAAA,CAAc7C,MAAM,IAAK,GAAG,CAAE,CAChCrF,QAAQ,CAAC,sCAAsC,CAAC,CAChDsC,YAAY,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAChC5B,YAAY,CAAC4B,UAAU,CAAC,MAAM,CAAC,CAC/B5B,YAAY,CAAC4B,UAAU,CAAC,QAAQ,CAAC,CACjC5C,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAAC,CACN,CAAC,CAED;AACA,KAAM,CAAA6G,SAAS,CAAIC,KAAK,EAAK,CAC3B,GAAIA,KAAK,CAAE,CACTtI,gBAAgB,CAAC,CAAEsE,GAAG,IAAAT,MAAA,CAAKd,OAAO,CAACC,GAAG,CAACC,iBAAiB,cAAAY,MAAA,CAAYyE,KAAK,CAAE,CAAEC,IAAI,CAAE,OAAQ,CAAC,CAAC,CAC/F,CACF,CAAC,CACD,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAMxI,gBAAgB,CAAC,IAAI,CAAC,CAE/C;AACA,KAAM,CAAAyI,WAAW,CAAGnL,WAAW,CAAC,CAACoL,UAAU,CAAElF,IAAI,GAAK,CACpD,GAAIA,IAAI,GAAK,UAAU,CAAE,MAAO,CAAAkF,UAAU,CAC1C,KAAM,CAAAC,OAAO,CAAG,CAAC,CAAC,CAClBD,UAAU,CAACE,OAAO,CAAC1C,KAAK,EAAI,CAC1B,KAAM,CAAA2C,GAAG,IAAAhF,MAAA,CAAMqC,KAAK,CAAC4C,OAAO,CAACrD,GAAG,MAAA5B,MAAA,CAAIqC,KAAK,CAAC6C,IAAI,CAACtD,GAAG,MAAA5B,MAAA,CAAIqC,KAAK,CAAC1F,OAAO,CAAE,CACrE,GAAI,CAACmI,OAAO,CAACE,GAAG,CAAC,CAAE,CACjBF,OAAO,CAACE,GAAG,CAAC,CAAA/C,aAAA,CAAAA,aAAA,IACPI,KAAK,MACR3F,QAAQ,CAAE,CAAC,CACXyI,QAAQ,CAAE,EAAE,CACZC,cAAc,CAAE,GAAI,CAAAC,GAAG,CAAC,CAAC,CACzBjD,QAAQ,CAAE,EAAE,CACZF,WAAW,CAAE,CAAC,EACf,CACH,CACA4C,OAAO,CAACE,GAAG,CAAC,CAACtI,QAAQ,EAAI2F,KAAK,CAAC3F,QAAQ,CACvCoI,OAAO,CAACE,GAAG,CAAC,CAACG,QAAQ,CAACG,IAAI,CAACjD,KAAK,CAACT,GAAG,CAAC,CACrCkD,OAAO,CAACE,GAAG,CAAC,CAAC5C,QAAQ,CAAG0C,OAAO,CAACE,GAAG,CAAC,CAAC5C,QAAQ,CAACpC,MAAM,CAACqC,KAAK,CAACD,QAAQ,EAAI,EAAE,CAAC,CAC1E,GAAIC,KAAK,CAACkD,aAAa,CAAE,CACvBT,OAAO,CAACE,GAAG,CAAC,CAACI,cAAc,CAACI,GAAG,CAACnD,KAAK,CAACkD,aAAa,CAAC,CACtD,CACA,GAAIlD,KAAK,CAACD,QAAQ,CAAE,CAClB,KAAM,CAAAqD,MAAM,CAAGpD,KAAK,CAACD,QAAQ,CAACU,MAAM,CAACC,GAAG,EAAI,CAACA,GAAG,CAACC,MAAM,EAAID,GAAG,CAACJ,IAAI,GAAKhD,IAAI,CAAC,CAACsD,MAAM,CACpF6B,OAAO,CAACE,GAAG,CAAC,CAAC9C,WAAW,EAAIuD,MAAM,CACpC,CACF,CAAC,CAAC,CACF,IAAK,GAAI,CAAAT,GAAG,GAAI,CAAAF,OAAO,CAAE,CACvBA,OAAO,CAACE,GAAG,CAAC,CAAC5C,QAAQ,CAACsD,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,GAAI,CAAAC,IAAI,CAACF,CAAC,CAACG,SAAS,CAAC,CAAG,GAAI,CAAAD,IAAI,CAACD,CAAC,CAACE,SAAS,CAAC,CAAC,CACrF,CACA,MAAO,CAAAC,MAAM,CAACC,MAAM,CAAClB,OAAO,CAAC,CAAC/C,GAAG,CAACkE,KAAK,EAAAhE,aAAA,CAAAA,aAAA,IAClCgE,KAAK,MACRV,aAAa,CAAEW,KAAK,CAACvD,IAAI,CAACsD,KAAK,CAACb,cAAc,CAAC,CAAC,CAAC,CAAC,EAAI,uBAAuB,CAC7Ee,SAAS,CAAEF,KAAK,CAACd,QAAQ,CAAClC,MAAM,CAAG,CAAC,CACpCmD,WAAW,CAAEH,KAAK,CAACd,QAAQ,CAAClC,MAAM,CAClCf,WAAW,CAAE+D,KAAK,CAAC/D,WAAW,EAC9B,CAAC,CACL,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAmE,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,GAAI,CACF,KAAM,CAAA3H,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAAA6B,GAAG,IAAAT,MAAA,CAAMd,OAAO,CAACC,GAAG,CAACC,iBAAiB,eAAa,CACvD,KAAM,CAAAsB,MAAM,CAAG,GAAI,CAAAC,eAAe,CAAC,CAAC,CACpC,GAAI1F,YAAY,CAAEyF,MAAM,CAACE,MAAM,CAAC,YAAY,CAAE3F,YAAY,CAAC,CAC3D,GAAIE,WAAW,CAAEuF,MAAM,CAACE,MAAM,CAAC,OAAO,CAAEzF,WAAW,CAAC,CACpD,GAAIE,iBAAiB,CAAEqF,MAAM,CAACE,MAAM,CAAC,aAAa,CAAEvF,iBAAiB,CAAC,CACtE,GAAIE,SAAS,CAAEmF,MAAM,CAACE,MAAM,CAAC,WAAW,CAAErF,SAAS,CAAC,CACpD,GAAIE,OAAO,CAAEiF,MAAM,CAACE,MAAM,CAAC,SAAS,CAAEnF,OAAO,CAAC,CAC9C,GAAIE,aAAa,CAACE,QAAQ,CAAE6E,MAAM,CAACE,MAAM,CAAC,QAAQ,CAAE,UAAU,CAAC,CAC/D,GAAIjF,aAAa,CAACG,OAAO,CAAE4E,MAAM,CAACE,MAAM,CAAC,QAAQ,CAAE,SAAS,CAAC,CAC7D,GAAIjF,aAAa,CAACI,SAAS,CAAE2E,MAAM,CAACE,MAAM,CAAC,QAAQ,CAAE,WAAW,CAAC,CACjE,GAAIF,MAAM,CAACG,QAAQ,CAAC,CAAC,CAAEJ,GAAG,MAAAT,MAAA,CAAQU,MAAM,CAACG,QAAQ,CAAC,CAAC,CAAE,CACrD,KAAM,CAAAK,GAAG,CAAG,KAAM,CAAArH,KAAK,CAACiH,GAAG,CAACL,GAAG,CAAE,CAC/BM,OAAO,CAAE,CAAEC,aAAa,WAAAhB,MAAA,CAAYtB,KAAK,CAAG,CAC9C,CAAC,CAAC,CACF,KAAM,CAAA4H,SAAS,CAAGpF,GAAG,CAACC,IAAI,CAACpG,MAAM,EAAImG,GAAG,CAACC,IAAI,CAC7C,KAAM,CAAA2D,OAAO,CAAGF,WAAW,CAAC0B,SAAS,CAAE1D,WAAW,CAAC,CAAC,CAAC,CACrD,KAAM,CAAA2D,GAAG,CAAG,GAAI,CAAAzM,QAAQ,CAAC,CACvB0M,QAAQ,CAAE,CACR,CACEC,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CACZyM,QAAQ,CAAE,CACR,GAAI,CAAArM,OAAO,CAAC,CAAEsM,IAAI,CAAE,eAAe,CAAEC,IAAI,CAAE,EAAE,CAAEC,IAAI,CAAE,IAAI,CAAEC,GAAG,CAAE,IAAK,CAAC,CAAC,CACxE,CACDC,SAAS,CAAE,OAAO,CAClBC,OAAO,CAAE,CAAEC,KAAK,CAAE,GAAI,CACxB,CAAC,CAAC,CACF,GAAI,CAAA/M,KAAK,CAAC,CACRgN,IAAI,CAAE,CACJ,GAAI,CAAA9M,QAAQ,CAAC,CACXsM,QAAQ,CAAE,CACR,GAAI,CAAAvM,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,WAAW,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACvEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,QAAQ,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACpEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,QAAQ,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACpEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,YAAY,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACxEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,SAAS,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACrEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,QAAQ,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACpEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,QAAQ,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACpEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,aAAa,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACzEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,QAAQ,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACpEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CACF,GAAI,CAAAjN,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,QAAQ,CAAEG,GAAG,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAAC,CACpEM,KAAK,CAAE,CAAEP,IAAI,CAAE,EAAE,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CAChD,CAAC,CAAC,CAEN,CAAC,CAAC,CACF,GAAGrC,OAAO,CAAC/C,GAAG,CAACM,KAAK,OAAA+E,WAAA,CAAAC,YAAA,CAAAC,cAAA,CAAAC,eAAA,CAAAC,qBAAA,OAClB,IAAI,CAAArN,QAAQ,CAAC,CACXsM,QAAQ,CAAE,CACR,GAAI,CAAAvM,SAAS,CAAC,CACZuM,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,CAACrE,KAAK,CAACoF,WAAW,EAAI,GAAG,EAAE5G,QAAQ,CAAC,CAAC,CAAEgG,GAAG,CAAE,IAAK,CAAC,CAAC,CAE7E,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CACZ0M,IAAI,CAAErE,KAAK,CAACkD,aAAa,EAAI,uBAAuB,CACpDsB,GAAG,CAAE,IACP,CAAC,CAAC,CAEN,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,EAAAU,WAAA,CAAA/E,KAAK,CAAC6C,IAAI,UAAAkC,WAAA,iBAAVA,WAAA,CAAYM,IAAI,GAAI,MAAM,CAAEb,GAAG,CAAE,IAAK,CAAC,CAAC,CAC3E,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,EAAAW,YAAA,CAAAhF,KAAK,CAAC6C,IAAI,UAAAmC,YAAA,iBAAVA,YAAA,CAAYM,KAAK,GAAI,GAAG,CAAEd,GAAG,CAAE,IAAK,CAAC,CAAC,CACzE,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CAAC,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAErE,KAAK,CAAC1F,OAAO,EAAI,GAAG,CAAEkK,GAAG,CAAE,IAAK,CAAC,CAAC,CACrE,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CAAE0M,IAAI,CAAE,EAAAY,cAAA,CAAAjF,KAAK,CAAC4C,OAAO,UAAAqC,cAAA,iBAAbA,cAAA,CAAeI,IAAI,GAAI,WAAW,CAAEb,GAAG,CAAE,IAAK,CAAC,CAAC,CAE1E,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CACZ0M,IAAI,CAAE,EAAAa,eAAA,CAAAlF,KAAK,CAAC4C,OAAO,UAAAsC,eAAA,kBAAAC,qBAAA,CAAbD,eAAA,CAAeK,MAAM,UAAAJ,qBAAA,iBAArBA,qBAAA,CAAuBE,IAAI,GAAI,WAAW,CAChDb,GAAG,CAAE,IACP,CAAC,CAAC,CAEN,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CACZ0M,IAAI,CAAE,GAAI,CAAAb,IAAI,CAACxD,KAAK,CAACwF,SAAS,CAAC,CAACC,kBAAkB,CAAC,OAAO,CAAC,EAAI,GAAG,CAClEjB,GAAG,CAAE,IACP,CAAC,CAAC,CAEN,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CACZ0M,IAAI,CACF,CACEqB,OAAO,CAAE,cAAc,CACvBjM,OAAO,CAAE,YAAY,CACrBC,SAAS,CAAE,YAAY,CACvBF,QAAQ,CAAE,OACZ,CAAC,CAACwG,KAAK,CAACX,MAAM,CAAC,EAAI,WAAW,CAChCmF,GAAG,CAAE,IACP,CAAC,CAAC,CAEN,CAAC,CAAC,CACF,GAAI,CAAA3M,SAAS,CAAC,CACZuM,QAAQ,CAAE,CACR,GAAI,CAAAzM,SAAS,CAAC,CACZ0M,IAAI,CAAErE,KAAK,CAAC8D,SAAS,IAAAnG,MAAA,CAAMqC,KAAK,CAAC3F,QAAQ,gCAAY2F,KAAK,CAAC3F,QAAQ,CAACmE,QAAQ,CAAC,CAAC,CAC9EgG,GAAG,CAAE,IACP,CAAC,CAAC,CAEN,CAAC,CAAC,CAEN,CAAC,CAAC,EACJ,CAAC,CACF,CACDK,KAAK,CAAE,CAAEP,IAAI,CAAE,GAAG,CAAEjC,IAAI,CAAErK,SAAS,CAAC8M,UAAW,CACjD,CAAC,CAAC,CAEN,CAAC,CAEL,CAAC,CAAC,CACF,KAAM,CAAAa,IAAI,CAAG,KAAM,CAAAjO,MAAM,CAACkO,MAAM,CAAC1B,GAAG,CAAC,CACrCjM,MAAM,CAAC0N,IAAI,CAAE,aAAa,CAAC,CAC3B3L,QAAQ,CAAC,IAAI,CAAC,CAChB,CAAE,MAAOD,KAAK,CAAE,CACdyD,OAAO,CAACzD,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CAC7CC,QAAQ,CAAC,yBAAyB,CAAGD,KAAK,CAAC6D,OAAO,CAAC,CACrD,CACF,CAAC,CAED;AACA,KAAM,CAAAiI,iBAAiB,CAAG,KAAO,CAAA5H,CAAC,EAAK,CACrCA,CAAC,CAAC6H,cAAc,CAAC,CAAC,CAClB7H,CAAC,CAAC8H,eAAe,CAAC,CAAC,CACnB,KAAM,CAAA1J,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVrC,QAAQ,CAAC,mBAAmB,CAAC,CAC7BsB,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACA,GAAI,CAACb,UAAU,CAACuL,IAAI,CAAC,CAAC,EAAI,CAACrL,QAAQ,CAAE,CACnCX,QAAQ,CAAC,6BAA6B,CAAC,CACvC,OACF,CACA,KAAM,CAAAiM,QAAQ,CAAG,GAAI,CAAAC,QAAQ,CAAC,CAAC,CAC/B,GAAIzL,UAAU,CAACuL,IAAI,CAAC,CAAC,CAAEC,QAAQ,CAAC1H,MAAM,CAAC,MAAM,CAAE9D,UAAU,CAACuL,IAAI,CAAC,CAAC,CAAC,CACjE,GAAIrL,QAAQ,CAAEsL,QAAQ,CAAC1H,MAAM,CAAC,OAAO,CAAE5D,QAAQ,CAAC,CAChD,GAAI,CACF,KAAM,CAAAkE,GAAG,CAAG,KAAM,CAAArH,KAAK,CAACgI,IAAI,IAAA7B,MAAA,CACvBd,OAAO,CAACC,GAAG,CAACC,iBAAiB,iBAAAY,MAAA,CAAepD,wBAAwB,CAACgF,GAAG,aAC3E0G,QAAQ,CACR,CACEvH,OAAO,CAAE,CACPC,aAAa,WAAAhB,MAAA,CAAYtB,KAAK,CAAE,CAChC,cAAc,CAAE,qBAClB,CACF,CACF,CAAC,CACD7B,2BAA2B,CAACsF,IAAI,EAAAF,aAAA,CAAAA,aAAA,IAC3BE,IAAI,MACPC,QAAQ,CAAElB,GAAG,CAACC,IAAI,CAACkB,KAAK,CAACD,QAAQ,EAAI,EAAE,EACvC,CAAC,CACHrF,aAAa,CAAC,EAAE,CAAC,CACjBE,WAAW,CAAC,IAAI,CAAC,CACjBE,kBAAkB,CAAC,IAAI,CAAC,CACxBd,QAAQ,CAAC,IAAI,CAAC,CAEd;AACAmM,UAAU,CAAC,IAAM,CACfnK,cAAc,CAAC,CAAC,CAClB,CAAC,CAAE,GAAG,CAAC,CACT,CAAE,MAAO0B,GAAG,CAAE,KAAA0I,cAAA,CAAAC,mBAAA,CACZ,KAAM,CAAAlH,YAAY,CAAG,EAAAiH,cAAA,CAAA1I,GAAG,CAAC0B,QAAQ,UAAAgH,cAAA,kBAAAC,mBAAA,CAAZD,cAAA,CAActH,IAAI,UAAAuH,mBAAA,iBAAlBA,mBAAA,CAAoBzI,OAAO,GAAI,sBAAsB,CAC1E5D,QAAQ,CAACmF,YAAY,CAAC,CACxB,CACF,CAAC,CAED;AACA,KAAM,CAAAmH,YAAY,CAAItG,KAAK,EAAK,CAC9BxF,2BAA2B,CAACwF,KAAK,CAAC,CACpC,CAAC,CACD,KAAM,CAAAuG,aAAa,CAAGA,CAAA,GAAM,CAC1B/L,2BAA2B,CAAC,IAAI,CAAC,CACjCE,aAAa,CAAC,EAAE,CAAC,CACjBE,WAAW,CAAC,IAAI,CAAC,CACjBE,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CAAC,CAED;AACA,KAAM,CAAAyF,WAAW,CAAGA,CAAA,GAAM,CACxB,KAAM,CAAAlE,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAIF,KAAK,CAAE,CACT,GAAI,CACF,KAAM,CAAAG,OAAO,CAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACN,KAAK,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CACrD,MAAO,CAAAJ,OAAO,CAACc,IAAI,EAAI,MAAM,CAC/B,CAAE,MAAOW,CAAC,CAAE,CACVT,OAAO,CAACzD,KAAK,CAAC,uBAAuB,CAAEkE,CAAC,CAAC,CACzCjE,QAAQ,CAAC,oDAAoD,CAAC,CAC9DsC,YAAY,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAChC5B,YAAY,CAAC4B,UAAU,CAAC,MAAM,CAAC,CAC/B5B,YAAY,CAAC4B,UAAU,CAAC,QAAQ,CAAC,CACjC5C,QAAQ,CAAC,QAAQ,CAAC,CAClB,MAAO,MAAM,CACf,CACF,CACA,MAAO,MAAM,CACf,CAAC,CACD,KAAM,CAAAkL,QAAQ,CAAGjG,WAAW,CAAC,CAAC,CAE9B;AACA,KAAM,CAAAkG,gBAAgB,CAAG9M,cAAc,CAAGjB,MAAM,CAAC+H,MAAM,CAACd,CAAC,EAAI,CAACA,CAAC,CAACE,WAAW,EAAI,CAAC,EAAI,CAAC,CAAC,CAAGnH,MAAM,CAC/F,KAAM,CAAAgO,aAAa,CAAGnE,WAAW,CAACkE,gBAAgB,CAAED,QAAQ,CAAC,CAE7D;AACA,KAAM,CAAAG,aAAa,CAAG,CACpBC,MAAM,CAAE,CAAEC,OAAO,CAAE,CAAC,CAAEC,CAAC,CAAE,EAAG,CAAC,CAC7BC,OAAO,CAAE,CACPF,OAAO,CAAE,CAAC,CACVC,CAAC,CAAE,CAAC,CACJE,UAAU,CAAE,CAAEC,QAAQ,CAAE,GAAG,CAAEC,eAAe,CAAE,IAAK,CACrD,CACF,CAAC,CACD,KAAM,CAAAC,WAAW,CAAG,CAClBP,MAAM,CAAE,CAAEC,OAAO,CAAE,CAAC,CAAEO,CAAC,CAAE,CAAC,EAAG,CAAC,CAC9BL,OAAO,CAAE,CAAEF,OAAO,CAAE,CAAC,CAAEO,CAAC,CAAE,CAAC,CAAEJ,UAAU,CAAE,CAAEC,QAAQ,CAAE,GAAI,CAAE,CAC7D,CAAC,CACD,KAAM,CAAAI,cAAc,CAAG,CACrBC,KAAK,CAAE,CAAEC,KAAK,CAAE,IAAI,CAAEC,SAAS,CAAE,8BAA+B,CAAC,CACjEC,GAAG,CAAE,CAAEF,KAAK,CAAE,IAAK,CACrB,CAAC,CACD,KAAM,CAAAG,aAAa,CAAG,CACpBd,MAAM,CAAE,CAAEC,OAAO,CAAE,CAAC,CAAEU,KAAK,CAAE,IAAK,CAAC,CACnCR,OAAO,CAAE,CAAEF,OAAO,CAAE,CAAC,CAAEU,KAAK,CAAE,CAAC,CAAEP,UAAU,CAAE,CAAEC,QAAQ,CAAE,IAAK,CAAE,CAAC,CACjEU,IAAI,CAAE,CAAEd,OAAO,CAAE,CAAC,CAAEU,KAAK,CAAE,IAAI,CAAEP,UAAU,CAAE,CAAEC,QAAQ,CAAE,GAAI,CAAE,CACjE,CAAC,CAED,mBACE3O,KAAA,CAACjB,MAAM,CAACuQ,GAAG,EACTC,SAAS,CAAC,8FAA8F,CACxGC,OAAO,CAAE,CAAEjB,OAAO,CAAE,CAAE,CAAE,CACxBkB,OAAO,CAAE,CAAElB,OAAO,CAAE,CAAE,CAAE,CACxBG,UAAU,CAAE,CAAEC,QAAQ,CAAE,GAAI,CAAE,CAAA7C,QAAA,eAG9BhM,IAAA,OAAIyP,SAAS,CAAC,mJAAmJ,CAAAzD,QAAA,CAAC,2EAElK,CAAI,CAAC,CAGJrK,KAAK,eACJzB,KAAA,CAACjB,MAAM,CAACuQ,GAAG,EACTC,SAAS,CAAC,mGAAmG,CAC7GC,OAAO,CAAE,CAAEjB,OAAO,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAC,EAAG,CAAE,CAChCiB,OAAO,CAAE,CAAElB,OAAO,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAE,CAAE,CAC9Ba,IAAI,CAAE,CAAEd,OAAO,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAC,EAAG,CAAE,CAC7BE,UAAU,CAAE,CAAEC,QAAQ,CAAE,GAAI,CAAE,CAAA7C,QAAA,EAE7BrK,KAAK,cACN3B,IAAA,WACE4P,OAAO,CAAEA,CAAA,GAAMhO,QAAQ,CAAC,IAAI,CAAE,CAC9B6N,SAAS,CAAC,wBAAwB,CAAAzD,QAAA,CACnC,MAED,CAAQ,CAAC,EACC,CACb,CAGAoC,QAAQ,GAAK,UAAU,eACtBlO,KAAA,QAAKuP,SAAS,CAAC,sFAAsF,CAAAzD,QAAA,eACnG9L,KAAA,QAAKuP,SAAS,CAAC,0EAA0E,CAAAzD,QAAA,eACvFhM,IAAA,UACEiK,IAAI,CAAC,MAAM,CACX4F,WAAW,CAAC,wFAAkB,CAC9BC,KAAK,CAAEtP,YAAa,CACpBuP,QAAQ,CAAGlK,CAAC,EAAKpF,eAAe,CAACoF,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAE,CACjDL,SAAS,CAAC,6HAA6H,CACxI,CAAC,cACFzP,IAAA,UACEiK,IAAI,CAAC,MAAM,CACX4F,WAAW,CAAC,wFAAkB,CAC9BC,KAAK,CAAEpP,WAAY,CACnBqP,QAAQ,CAAGlK,CAAC,EAAKlF,cAAc,CAACkF,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAE,CAChDL,SAAS,CAAC,6HAA6H,CACxI,CAAC,cACFzP,IAAA,UACEiK,IAAI,CAAC,MAAM,CACX4F,WAAW,CAAC,kFAAiB,CAC7BC,KAAK,CAAElP,iBAAkB,CACzBmP,QAAQ,CAAGlK,CAAC,EAAKhF,oBAAoB,CAACgF,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAE,CACtDL,SAAS,CAAC,6HAA6H,CACxI,CAAC,cACFzP,IAAA,UACEiK,IAAI,CAAC,MAAM,CACX6F,KAAK,CAAEhP,SAAU,CACjBiP,QAAQ,CAAGlK,CAAC,EAAK9E,YAAY,CAAC8E,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAE,CAC9CL,SAAS,CAAC,6HAA6H,CACxI,CAAC,cACFzP,IAAA,UACEiK,IAAI,CAAC,MAAM,CACX6F,KAAK,CAAE9O,OAAQ,CACf+O,QAAQ,CAAGlK,CAAC,EAAK5E,UAAU,CAAC4E,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAE,CAC5CL,SAAS,CAAC,6HAA6H,CACxI,CAAC,EACC,CAAC,cACNvP,KAAA,QAAKuP,SAAS,CAAC,wCAAwC,CAAAzD,QAAA,eACrDhM,IAAA,SAAMyP,SAAS,CAAC,2BAA2B,CAAAzD,QAAA,CAAC,gEAAY,CAAM,CAAC,CAC9D,CAAC,UAAU,CAAE,SAAS,CAAE,WAAW,CAAC,CAAC1E,GAAG,CAACL,MAAM,eAC9C/G,KAAA,UAAoBuP,SAAS,CAAC,4DAA4D,CAAAzD,QAAA,eACxFhM,IAAA,UACEiK,IAAI,CAAC,UAAU,CACfgG,OAAO,CAAE/O,aAAa,CAAC+F,MAAM,CAAE,CAC/B8I,QAAQ,CAAGlK,CAAC,EAAK1E,gBAAgB,CAACuG,IAAI,EAAAF,aAAA,CAAAA,aAAA,IAAUE,IAAI,MAAE,CAACT,MAAM,EAAGpB,CAAC,CAACmK,MAAM,CAACC,OAAO,EAAG,CAAE,CACrFR,SAAS,CAAC,gEAAgE,CAC3E,CAAC,cACFzP,IAAA,SAAMyP,SAAS,CAAC,YAAY,CAAAzD,QAAA,CACzB/E,MAAM,GAAK,UAAU,CAAG,OAAO,CAAGA,MAAM,GAAK,SAAS,CAAG,YAAY,CAAG,YAAY,CACjF,CAAC,GATGA,MAUL,CACR,CAAC,cACF/G,KAAA,UAAOuP,SAAS,CAAC,4DAA4D,CAAAzD,QAAA,eAC3EhM,IAAA,UACEiK,IAAI,CAAC,UAAU,CACfgG,OAAO,CAAE1O,cAAe,CACxBwO,QAAQ,CAAGlK,CAAC,EAAKrE,iBAAiB,CAACqE,CAAC,CAACmK,MAAM,CAACC,OAAO,CAAE,CACrDR,SAAS,CAAC,gEAAgE,CAC3E,CAAC,cACFzP,IAAA,SAAMyP,SAAS,CAAC,YAAY,CAAAzD,QAAA,CAAC,kMAAqC,CAAM,CAAC,EACpE,CAAC,EACL,CAAC,cACN9L,KAAA,QAAKuP,SAAS,CAAC,sBAAsB,CAAAzD,QAAA,eACnChM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAE7J,WAAY,CACrB0J,SAAS,CAAC,sGAAsG,CAChHU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,oBAED,CAAe,CAAC,cAChBhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEhE,YAAa,CACtB6D,SAAS,CAAC,sGAAsG,CAChHU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,wDAED,CAAe,CAAC,EACb,CAAC,EACH,CACN,cAGD9L,KAAA,CAAChB,eAAe,EAACoR,IAAI,CAAC,MAAM,CAAAtE,QAAA,EACzBjJ,OAAO,eACN/C,IAAA,CAACf,MAAM,CAACsR,CAAC,EAEPd,SAAS,CAAC,8BAA8B,CACxCC,OAAO,CAAE,CAAEjB,OAAO,CAAE,CAAE,CAAE,CACxBkB,OAAO,CAAE,CAAElB,OAAO,CAAE,CAAE,CAAE,CACxBc,IAAI,CAAE,CAAEd,OAAO,CAAE,CAAE,CAAE,CAAAzC,QAAA,CACtB,wEAED,EAPM,SAOI,CACX,CACA,CAACjJ,OAAO,EAAIuL,aAAa,CAAC9F,MAAM,GAAK,CAAC,eACrCxI,IAAA,CAACf,MAAM,CAACsR,CAAC,EAEPd,SAAS,CAAC,8BAA8B,CACxCC,OAAO,CAAE,CAAEjB,OAAO,CAAE,CAAE,CAAE,CACxBkB,OAAO,CAAE,CAAElB,OAAO,CAAE,CAAE,CAAE,CACxBc,IAAI,CAAE,CAAEd,OAAO,CAAE,CAAE,CAAE,CAAAzC,QAAA,CACtB,4GAED,EAPM,WAOI,CACX,CACA,CAACjJ,OAAO,EAAIuL,aAAa,CAAC9F,MAAM,CAAG,CAAC,eACnCxI,IAAA,CAACf,MAAM,CAACuQ,GAAG,EAETC,SAAS,CAAC,6FAA6F,CACvGU,QAAQ,CAAE5B,aAAc,CACxBmB,OAAO,CAAC,QAAQ,CAChBC,OAAO,CAAC,SAAS,CAAA3D,QAAA,cAEjB9L,KAAA,UAAOuP,SAAS,CAAC,qCAAqC,CAAAzD,QAAA,eACpDhM,IAAA,UAAOyP,SAAS,CAAC,cAAc,CAAAzD,QAAA,cAC7B9L,KAAA,OAAA8L,QAAA,eACEhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,mDAAS,CAAI,CAAC,cAC5GhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,sCAAM,CAAI,CAAC,cACzGhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,sCAAM,CAAI,CAAC,cACzGhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,yDAAU,CAAI,CAAC,cAC7GhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,4CAAO,CAAI,CAAC,cAC1GhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,sCAAM,CAAI,CAAC,cACzGhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,sCAAM,CAAI,CAAC,cACzGhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,+DAAW,CAAI,CAAC,cAC9GhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,sCAAM,CAAI,CAAC,cACzGhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,sCAAM,CAAI,CAAC,cACzGhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,gHAAoB,CAAI,CAAC,cACvHhM,IAAA,OAAIyP,SAAS,CAAC,+EAA+E,CAAAzD,QAAA,CAAC,4CAAO,CAAI,CAAC,EACxG,CAAC,CACA,CAAC,cACRhM,IAAA,UAAOyP,SAAS,CAAC,uCAAuC,CAAAzD,QAAA,CACrDsC,aAAa,CAAChH,GAAG,CAAC,CAACM,KAAK,CAAE4I,GAAG,QAAAC,YAAA,CAAAC,YAAA,CAAAC,eAAA,CAAAC,eAAA,CAAAC,qBAAA,oBAC5B3Q,KAAA,CAACjB,MAAM,CAAC6R,EAAE,EAERrB,SAAS,CAAC,4CAA4C,CACtDU,QAAQ,CAAEpB,WAAY,CAAA/C,QAAA,eAEtBhM,IAAA,OAAIyP,SAAS,CAAC,8BAA8B,CAAAzD,QAAA,CAAEpE,KAAK,CAACoF,WAAW,EAAI,GAAG,CAAK,CAAC,cAC5EhN,IAAA,OAAIyP,SAAS,CAAC,uBAAuB,CAAAzD,QAAA,cACnChM,IAAA,QACE+Q,GAAG,IAAAxL,MAAA,CAAKd,OAAO,CAACC,GAAG,CAACC,iBAAiB,cAAAY,MAAA,CAAYqC,KAAK,CAACkD,aAAa,CAAG,CACvEkG,GAAG,CAAC,yDAAY,CAChBvB,SAAS,CAAC,+FAA+F,CACzGG,OAAO,CAAEA,CAAA,GAAM7F,SAAS,CAACnC,KAAK,CAACkD,aAAa,CAAE,CAC9CmG,OAAO,CAAGpL,CAAC,EAAK,CACdA,CAAC,CAACmK,MAAM,CAACkB,OAAO,CAAG,IAAI,CACvBrL,CAAC,CAACmK,MAAM,CAACe,GAAG,IAAAxL,MAAA,CAAMd,OAAO,CAACC,GAAG,CAACC,iBAAiB,kCAAgC,CACjF,CAAE,CACH,CAAC,CACA,CAAC,cACL3E,IAAA,OAAIyP,SAAS,CAAC,kCAAkC,CAAAzD,QAAA,CAAE,EAAAyE,YAAA,CAAA7I,KAAK,CAAC6C,IAAI,UAAAgG,YAAA,iBAAVA,YAAA,CAAYxD,IAAI,GAAI,MAAM,CAAK,CAAC,cAClFjN,IAAA,OAAIyP,SAAS,CAAC,sBAAsB,CAAAzD,QAAA,CAAE,EAAA0E,YAAA,CAAA9I,KAAK,CAAC6C,IAAI,UAAAiG,YAAA,iBAAVA,YAAA,CAAYxD,KAAK,GAAI,GAAG,CAAK,CAAC,cACpElN,IAAA,OAAIyP,SAAS,CAAC,6DAA6D,CAAAzD,QAAA,CAAEpE,KAAK,CAAC1F,OAAO,EAAI,GAAG,CAAK,CAAC,cACvGlC,IAAA,OAAIyP,SAAS,CAAC,sBAAsB,CAAAzD,QAAA,CAAE,EAAA2E,eAAA,CAAA/I,KAAK,CAAC4C,OAAO,UAAAmG,eAAA,iBAAbA,eAAA,CAAe1D,IAAI,GAAI,WAAW,CAAK,CAAC,cAC9EjN,IAAA,OAAIyP,SAAS,CAAC,sBAAsB,CAAAzD,QAAA,CAAE,EAAA4E,eAAA,CAAAhJ,KAAK,CAAC4C,OAAO,UAAAoG,eAAA,kBAAAC,qBAAA,CAAbD,eAAA,CAAezD,MAAM,UAAA0D,qBAAA,iBAArBA,qBAAA,CAAuB5D,IAAI,GAAI,WAAW,CAAK,CAAC,cACtFjN,IAAA,OAAIyP,SAAS,CAAC,sBAAsB,CAAAzD,QAAA,CAAE,GAAI,CAAAZ,IAAI,CAACxD,KAAK,CAACwF,SAAS,CAAC,CAACC,kBAAkB,CAAC,OAAO,CAAC,CAAK,CAAC,cACjGrN,IAAA,OAAIyP,SAAS,CAAC,sBAAsB,CAAAzD,QAAA,cAClChM,IAAA,SACEyP,SAAS,6CAAAlK,MAAA,CACPqC,KAAK,CAACX,MAAM,GAAK,SAAS,CACtB,2DAA2D,CAC3DW,KAAK,CAACX,MAAM,GAAK,SAAS,CAC1B,qDAAqD,CACrDW,KAAK,CAACX,MAAM,GAAK,WAAW,CAC5B,wDAAwD,CACxD,kDAAkD,CACrD,CAAA+E,QAAA,CAEF,CACCsB,OAAO,CAAE,cAAc,CACvBjM,OAAO,CAAE,YAAY,CACrBC,SAAS,CAAE,YAAY,CACvBF,QAAQ,CAAE,OACZ,CAAC,CAACwG,KAAK,CAACX,MAAM,CAAC,EAAI,WAAW,CAC1B,CAAC,CACL,CAAC,cACL/G,KAAA,OAAIuP,SAAS,CAAC,gDAAgD,CAAAzD,QAAA,EAC3DpE,KAAK,CAAC3F,QAAQ,CAAC,GAAC,CAAC2F,KAAK,CAAC8D,SAAS,4CAAAnG,MAAA,CAAgBqC,KAAK,CAAC+D,WAAW,wBAAO,EACvE,CAAC,cACL3L,IAAA,OAAIyP,SAAS,CAAC,uBAAuB,CAAAzD,QAAA,cACnChM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEA,CAAA,GAAM1B,YAAY,CAACtG,KAAK,CAAE,CACnC6H,SAAS,mGAAAlK,MAAA,CACPqC,KAAK,CAACH,WAAW,CAAG,CAAC,CACjB,wDAAwD,CACxD,4CAA4C,CAC/C,CACH0I,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CAEbpE,KAAK,CAACH,WAAW,CAAG,CAAC,CAAGG,KAAK,CAACH,WAAW,CAAG,CAAC,CACjC,CAAC,CACd,CAAC,cACLzH,IAAA,OAAIyP,SAAS,CAAC,WAAW,CAAAzD,QAAA,cACvB9L,KAAA,QAAKuP,SAAS,CAAC,+CAA+C,CAAAzD,QAAA,EAC3DoC,QAAQ,GAAK,OAAO,EAAI,CAACxG,KAAK,CAAC8D,SAAS,eACvCxL,KAAA,CAAAE,SAAA,EAAA4L,QAAA,eACEhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZT,SAAS,CAAC,gGAAgG,CAC1GU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CACdT,OAAO,CAAEA,CAAA,GAAMlG,eAAe,CAAC9B,KAAK,CAAE,CAAAoE,QAAA,CACvC,gCAED,CAAe,CAAC,cAChBhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEA,CAAA,GAAM/G,iBAAiB,CAACjB,KAAK,CAACT,GAAG,CAAE,CAC5CsI,SAAS,CAAC,8FAA8F,CACxGU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,oBAED,CAAe,CAAC,EAChB,CACH,CACAoC,QAAQ,GAAK,QAAQ,EAAI,CAACxG,KAAK,CAAC8D,SAAS,eACxCxL,KAAA,CAACjB,MAAM,CAACkS,MAAM,EACZrB,KAAK,CAAElI,KAAK,CAACX,MAAO,CACpB8I,QAAQ,CAAGlK,CAAC,EAAKwD,kBAAkB,CAACzB,KAAK,CAACT,GAAG,CAAEtB,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAE,CAC/DL,SAAS,CAAC,0HAA0H,CACpIU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAAApE,QAAA,eAElBhM,IAAA,WAAQ8P,KAAK,CAAC,SAAS,CAAA9D,QAAA,CAAC,qEAAY,CAAQ,CAAC,cAC7ChM,IAAA,WAAQ8P,KAAK,CAAC,SAAS,CAAA9D,QAAA,CAAC,yDAAU,CAAQ,CAAC,cAC3ChM,IAAA,WAAQ8P,KAAK,CAAC,WAAW,CAAA9D,QAAA,CAAC,yDAAU,CAAQ,CAAC,cAC7ChM,IAAA,WAAQ8P,KAAK,CAAC,UAAU,CAAA9D,QAAA,CAAC,gCAAK,CAAQ,CAAC,EAC1B,CAChB,CACAoC,QAAQ,GAAK,UAAU,EAAIxG,KAAK,CAACX,MAAM,GAAK,SAAS,EAAI,CAACW,KAAK,CAAC8D,SAAS,eACxExL,KAAA,CAAAE,SAAA,EAAA4L,QAAA,eACEhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZT,SAAS,CAAC,gGAAgG,CAC1GU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CACdT,OAAO,CAAEA,CAAA,GAAMlG,eAAe,CAAC9B,KAAK,CAAE,CAAAoE,QAAA,CACvC,gCAED,CAAe,CAAC,cAChBhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEA,CAAA,GAAM/G,iBAAiB,CAACjB,KAAK,CAACT,GAAG,CAAE,CAC5CsI,SAAS,CAAC,8FAA8F,CACxGU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,oBAED,CAAe,CAAC,EAChB,CACH,EACE,CAAC,CACJ,CAAC,GA1HApE,KAAK,CAAC8D,SAAS,UAAAnG,MAAA,CAAYiL,GAAG,EAAK5I,KAAK,CAACT,GA2HrC,CAAC,EACb,CAAC,CACG,CAAC,EACH,CAAC,EAxJJ,iBAyJM,CACb,EACc,CAAC,CAGjB,CAACpE,OAAO,EAAIF,KAAK,CAAGI,KAAK,eACxB/C,KAAA,QAAKuP,SAAS,CAAC,6CAA6C,CAAAzD,QAAA,eAC1DhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEA,CAAA,GAAMhN,OAAO,CAAC8E,IAAI,EAAI0J,IAAI,CAACC,GAAG,CAAC,CAAC,CAAE3J,IAAI,CAAG,CAAC,CAAC,CAAE,CACtD4J,QAAQ,CAAE3O,IAAI,GAAK,CAAE,CACrB8M,SAAS,CAAC,sJAAsJ,CAChKU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAEzN,IAAI,GAAK,CAAC,CAAG,OAAO,CAAG,CAAC,CAAE,CACtC0N,QAAQ,CAAE1N,IAAI,GAAK,CAAC,CAAG,KAAK,CAAG,CAAC,CAAE,CAAAqJ,QAAA,CACnC,sCAED,CAAe,CAAC,cAChB9L,KAAA,SAAMuP,SAAS,CAAC,uBAAuB,CAAAzD,QAAA,EAAC,2BACjC,CAACrJ,IAAI,CAAC,gBAAI,CAACyO,IAAI,CAACG,IAAI,CAAC1O,KAAK,CAAGI,KAAK,CAAC,EACpC,CAAC,cACPjD,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEA,CAAA,GAAMhN,OAAO,CAAC8E,IAAI,EAAIA,IAAI,CAAG,CAAC,CAAE,CACzC4J,QAAQ,CAAE3O,IAAI,CAAGM,KAAK,EAAIJ,KAAM,CAChC4M,SAAS,CAAC,sJAAsJ,CAChKU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAEzN,IAAI,CAAGM,KAAK,CAAGJ,KAAK,CAAG,OAAO,CAAG,CAAC,CAAE,CAChDwN,QAAQ,CAAE1N,IAAI,CAAGM,KAAK,CAAGJ,KAAK,CAAG,KAAK,CAAG,CAAC,CAAE,CAAAmJ,QAAA,CAC7C,sCAED,CAAe,CAAC,EACb,CACN,cAGDhM,IAAA,CAACd,eAAe,EAAA8M,QAAA,CACbnK,SAAS,EAAI,CAACA,SAAS,CAAC6J,SAAS,eAChC1L,IAAA,CAACf,MAAM,CAACuQ,GAAG,EACTC,SAAS,CAAC,qEAAqE,CAC/EU,QAAQ,CAAEb,aAAc,CACxBI,OAAO,CAAC,QAAQ,CAChBC,OAAO,CAAC,SAAS,CACjBJ,IAAI,CAAC,MAAM,CACXK,OAAO,CAAEA,CAAA,GAAM9N,YAAY,CAAC,IAAI,CAAE,CAAAkK,QAAA,cAElC9L,KAAA,CAACjB,MAAM,CAACuQ,GAAG,EACTC,SAAS,CAAC,gFAAgF,CAC1FG,OAAO,CAAG/J,CAAC,EAAKA,CAAC,CAAC8H,eAAe,CAAC,CAAE,CAAA3B,QAAA,eAEpChM,IAAA,OAAIyP,SAAS,CAAC,2GAA2G,CAAAzD,QAAA,CAAC,+DAE1H,CAAI,CAAC,cACL9L,KAAA,QAAKuP,SAAS,CAAC,WAAW,CAAAzD,QAAA,eACxBhM,IAAA,UACEiK,IAAI,CAAC,QAAQ,CACb4F,WAAW,CAAC,sCAAQ,CACpBC,KAAK,CAAE/N,QAAQ,CAACE,QAAS,CACzB8N,QAAQ,CAAGlK,CAAC,EAAK7D,WAAW,CAAAwF,aAAA,CAAAA,aAAA,IAAMzF,QAAQ,MAAEE,QAAQ,CAAEuP,QAAQ,CAAC3L,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAC,EAAI,CAAC,EAAE,CAAE,CACvFL,SAAS,CAAC,4IAA4I,CACtJgC,GAAG,CAAC,GAAG,CACR,CAAC,cACFzR,IAAA,UACEiK,IAAI,CAAC,MAAM,CACX4F,WAAW,CAAC,4CAAS,CACrBC,KAAK,CAAE/N,QAAQ,CAACG,OAAQ,CACxB6N,QAAQ,CAAGlK,CAAC,EAAK7D,WAAW,CAAAwF,aAAA,CAAAA,aAAA,IAAMzF,QAAQ,MAAEG,OAAO,CAAE2D,CAAC,CAACmK,MAAM,CAACF,KAAK,EAAE,CAAE,CACvEL,SAAS,CAAC,4IAA4I,CACvJ,CAAC,EACC,CAAC,cACNvP,KAAA,QAAKuP,SAAS,CAAC,iBAAiB,CAAAzD,QAAA,eAC9BhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEjG,gBAAiB,CAC1B8F,SAAS,CAAC,4GAA4G,CACtHU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,2EAED,CAAe,CAAC,cAChBhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEA,CAAA,GAAM9N,YAAY,CAAC,IAAI,CAAE,CAClC2N,SAAS,CAAC,wGAAwG,CAClHU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,gCAED,CAAe,CAAC,EACb,CAAC,EACI,CAAC,CACH,CACb,CACc,CAAC,cAGlBhM,IAAA,CAACd,eAAe,EAAA8M,QAAA,CACb7J,wBAAwB,eACvBnC,IAAA,CAACf,MAAM,CAACuQ,GAAG,EACTC,SAAS,CAAC,qEAAqE,CAC/EU,QAAQ,CAAEb,aAAc,CACxBI,OAAO,CAAC,QAAQ,CAChBC,OAAO,CAAC,SAAS,CACjBJ,IAAI,CAAC,MAAM,CACXK,OAAO,CAAEzB,aAAc,CAAAnC,QAAA,cAEvB9L,KAAA,CAACjB,MAAM,CAACuQ,GAAG,EACTC,SAAS,CAAC,mHAAmH,CAC7HG,OAAO,CAAG/J,CAAC,EAAKA,CAAC,CAAC8H,eAAe,CAAC,CAAE,CAAA3B,QAAA,eAEpC9L,KAAA,OAAIuP,SAAS,CAAC,2GAA2G,CAAAzD,QAAA,EAAC,6EACzG,CAAC7J,wBAAwB,CAAC6K,WAAW,EAClD,CAAC,cACL9M,KAAA,QACEwR,GAAG,CAAErO,oBAAqB,CAC1BoM,SAAS,CAAC,uEAAuE,CAAAzD,QAAA,EAEhF7J,wBAAwB,CAACwF,QAAQ,EAAIxF,wBAAwB,CAACwF,QAAQ,CAACa,MAAM,CAAG,CAAC,cAChFxI,IAAA,QAAKyP,SAAS,CAAC,WAAW,CAAAzD,QAAA,CACvB7J,wBAAwB,CAACwF,QAAQ,CAACL,GAAG,CAAC,CAACgB,GAAG,CAAEqJ,KAAK,GAAK,KAAAC,qBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CACrD,KAAM,CAAAC,WAAW,CAAGzJ,GAAG,CAACJ,IAAI,GAAKkG,QAAQ,CACzC,KAAM,CAAA4D,UAAU,CAAG1J,GAAG,CAACJ,IAAI,GAAK,QAAQ,EAAA0J,qBAAA,CAAGzP,wBAAwB,CAACqI,OAAO,UAAAoH,qBAAA,kBAAAC,sBAAA,CAAhCD,qBAAA,CAAkCzE,MAAM,UAAA0E,sBAAA,iBAAxCA,sBAAA,CAA0C5E,IAAI,CAAG,EAAA6E,sBAAA,CAAA3P,wBAAwB,CAACsI,IAAI,UAAAqH,sBAAA,iBAA7BA,sBAAA,CAA+B7E,IAAI,GAAI,WAAW,CAC9I,mBACEjN,IAAA,QAEEyP,SAAS,SAAAlK,MAAA,CAAUwM,WAAW,CAAG,aAAa,CAAG,eAAe,CAAG,CAAA/F,QAAA,cAEnE9L,KAAA,QACEuP,SAAS,mDAAAlK,MAAA,CACPwM,WAAW,CAAG,qDAAqD,CAAG,wBAAwB,CAC7F,CAAA/F,QAAA,eAEH9L,KAAA,MAAGuP,SAAS,CAAC,8BAA8B,CAAAzD,QAAA,EACxC1D,GAAG,CAACJ,IAAI,GAAK,QAAQ,CAAG,QAAQ,CAAG,QAAQ,CAAC,IAAE,CAAC8J,UAAU,EACzD,CAAC,CACH1J,GAAG,CAAC2D,IAAI,eAAIjM,IAAA,MAAGyP,SAAS,CAAC,cAAc,CAAAzD,QAAA,CAAE1D,GAAG,CAAC2D,IAAI,CAAI,CAAC,CACtD3D,GAAG,CAAC2J,KAAK,eACRjS,IAAA,QACE+Q,GAAG,IAAAxL,MAAA,CAAKd,OAAO,CAACC,GAAG,CAACC,iBAAiB,cAAAY,MAAA,CAAY+C,GAAG,CAAC2J,KAAK,CAAG,CAC7DjB,GAAG,CAAC,qEAAc,CAClBvB,SAAS,CAAC,kGAAkG,CAC5GG,OAAO,CAAG/J,CAAC,EAAK,CACdA,CAAC,CAAC8H,eAAe,CAAC,CAAC,CACnB5D,SAAS,CAACzB,GAAG,CAAC2J,KAAK,CAAC,CACtB,CAAE,CACFhB,OAAO,CAAGpL,CAAC,EAAK,CACdA,CAAC,CAACmK,MAAM,CAACkB,OAAO,CAAG,IAAI,CACvBrL,CAAC,CAACmK,MAAM,CAACe,GAAG,IAAAxL,MAAA,CAAMd,OAAO,CAACC,GAAG,CAACC,iBAAiB,kCAAgC,CACjF,CAAE,CACH,CACF,cACDzE,KAAA,QAAKuP,SAAS,CAAC,2DAA2D,CAAAzD,QAAA,eACxEhM,IAAA,MAAAgM,QAAA,CAAI,GAAI,CAAAZ,IAAI,CAAC9C,GAAG,CAAC+C,SAAS,CAAC,CAAC6G,cAAc,CAAC,OAAO,CAAC,CAAI,CAAC,CACvDH,WAAW,eACV/R,IAAA,SAAAgM,QAAA,CACG1D,GAAG,CAACC,MAAM,CAAG,IAAI,CAAGD,GAAG,CAAC6J,WAAW,CAAG,GAAG,CAAG,GAAG,CAC5C,CACP,EACE,CAAC,EACH,CAAC,EAnCD7J,GAAG,CAACnB,GAAG,EAAIwK,KAoCb,CAAC,CAEV,CAAC,CAAC,CACC,CAAC,cAEN3R,IAAA,MAAGyP,SAAS,CAAC,mCAAmC,CAAAzD,QAAA,CAAC,0FAAkB,CAAG,CACvE,cACDhM,IAAA,QAAK0R,GAAG,CAAEpO,cAAe,CAAE,CAAC,EACzB,CAAC,CACL,CAAC8K,QAAQ,GAAK,QAAQ,EAAIA,QAAQ,GAAK,UAAU,gBAChDlO,KAAA,SAAMkS,QAAQ,CAAE3E,iBAAkB,CAACgC,SAAS,CAAC,WAAW,CAAAzD,QAAA,eACtDhM,IAAA,aACE6P,WAAW,CAAC,qFAAoB,CAChCC,KAAK,CAAEzN,UAAW,CAClB0N,QAAQ,CAAGlK,CAAC,EAAKvD,aAAa,CAACuD,CAAC,CAACmK,MAAM,CAACF,KAAK,CAAE,CAC/CL,SAAS,CAAC,gJAAgJ,CAC1JjD,IAAI,CAAC,GAAG,CACT,CAAC,cACFtM,KAAA,QAAKuP,SAAS,CAAC,yBAAyB,CAAAzD,QAAA,eACtChM,IAAA,UACEiK,IAAI,CAAC,MAAM,CACXoI,MAAM,CAAC,SAAS,CAChBtC,QAAQ,CAAGlK,CAAC,EAAKrD,WAAW,CAACqD,CAAC,CAACmK,MAAM,CAACsC,KAAK,CAAC,CAAC,CAAC,EAAI,IAAI,CAAE,CACxD7C,SAAS,CAAC,yIAAyI,CACpJ,CAAC,CACDhN,eAAe,eACdvC,KAAA,QAAKuP,SAAS,CAAC,UAAU,CAAAzD,QAAA,eACvBhM,IAAA,QAAK+Q,GAAG,CAAEtO,eAAgB,CAACuO,GAAG,CAAC,sCAAQ,CAACvB,SAAS,CAAC,6CAA6C,CAAE,CAAC,cAClGzP,IAAA,WACEiK,IAAI,CAAC,QAAQ,CACb2F,OAAO,CAAEA,CAAA,GAAM,CACbpN,WAAW,CAAC,IAAI,CAAC,CACjBE,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CAAE,CACF+M,SAAS,CAAC,4GAA4G,CAAAzD,QAAA,CACvH,MAED,CAAQ,CAAC,EACN,CACN,EACE,CAAC,cACNhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZjG,IAAI,CAAC,QAAQ,CACbwF,SAAS,CAAC,wGAAwG,CAClHU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,2EAED,CAAe,CAAC,EACZ,CACP,cACDhM,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAEzB,aAAc,CACvBsB,SAAS,CAAC,+GAA+G,CACzHU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,gCAED,CAAe,CAAC,EACN,CAAC,CACH,CACb,CACc,CAAC,cAGlBhM,IAAA,CAACd,eAAe,EAAA8M,QAAA,CACbvK,aAAa,eACZzB,IAAA,CAACf,MAAM,CAACuQ,GAAG,EACTC,SAAS,CAAC,qEAAqE,CAC/EU,QAAQ,CAAEb,aAAc,CACxBI,OAAO,CAAC,QAAQ,CAChBC,OAAO,CAAC,SAAS,CACjBJ,IAAI,CAAC,MAAM,CACXK,OAAO,CAAE1F,UAAW,CAAA8B,QAAA,cAEpB9L,KAAA,CAACjB,MAAM,CAACuQ,GAAG,EAACC,SAAS,CAAC,+BAA+B,CAACG,OAAO,CAAG/J,CAAC,EAAKA,CAAC,CAAC8H,eAAe,CAAC,CAAE,CAAA3B,QAAA,eACxFhM,IAAA,QACE+Q,GAAG,CAAEtP,aAAa,CAACuE,GAAI,CACvByJ,SAAS,CAAC,8CAA8C,CACxDuB,GAAG,CAAC,yDAAY,CAChBC,OAAO,CAAGpL,CAAC,EAAK,CACdA,CAAC,CAACmK,MAAM,CAACkB,OAAO,CAAG,IAAI,CACvBrL,CAAC,CAACmK,MAAM,CAACe,GAAG,IAAAxL,MAAA,CAAMd,OAAO,CAACC,GAAG,CAACC,iBAAiB,kCAAgC,CACjF,CAAE,CACH,CAAC,cACF3E,IAAA,CAACf,MAAM,CAACiR,MAAM,EACZN,OAAO,CAAE1F,UAAW,CACpBuF,SAAS,CAAC,uJAAuJ,CACjKU,QAAQ,CAAElB,cAAe,CACzBmB,UAAU,CAAC,OAAO,CAClBC,QAAQ,CAAC,KAAK,CAAArE,QAAA,CACf,MAED,CAAe,CAAC,EACN,CAAC,CACH,CACb,CACc,CAAC,EACR,CAAC,CAEjB,CAAC,CAED,cAAe,CAAA3L,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}