{"ast":null,"code":"import _objectSpread from\"/root/shose/app-shose/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// frontend/src/pages/Orders.js\nimport{useState,useEffect,useRef,useCallback}from'react';import{motion,AnimatePresence}from'framer-motion';import{useNavigate}from'react-router-dom';import axios from'axios';import{Document,Packer,Paragraph,Table,TableCell,TableRow,TextRun,WidthType}from'docx';import{saveAs}from'file-saver';import{io}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Orders=()=>{const[orders,setOrders]=useState([]);const[vendorSearch,setVendorSearch]=useState('');const[phoneSearch,setPhoneSearch]=useState('');const[orderNumberSearch,setOrderNumberSearch]=useState('');const[startDate,setStartDate]=useState('');const[endDate,setEndDate]=useState('');const[statusFilters,setStatusFilters]=useState({rejected:false,shipped:false,delivered:false});const[showUnreadOnly,setShowUnreadOnly]=useState(false);const[selectedMedia,setSelectedMedia]=useState(null);const[error,setError]=useState(null);const[editOrder,setEditOrder]=useState(null);const[editForm,setEditForm]=useState({quantity:1,address:''});const[selectedOrderForMessages,setSelectedOrderForMessages]=useState(null);const[isChatManuallyOpened,setIsChatManuallyOpened]=useState(false);const[newMessage,setNewMessage]=useState('');const[newImage,setNewImage]=useState(null);const[newImagePreview,setNewImagePreview]=useState(null);const[page,setPage]=useState(1);const[total,setTotal]=useState(0);const[loading,setLoading]=useState(true);const[showFloatingChatButton,setShowFloatingChatButton]=useState(true);const limit=20;const navigate=useNavigate();// Refs\nconst socketRef=useRef(null);const currentOrderIdRef=useRef(null);const chatContainerRef=useRef(null);const isFirstOpenRef=useRef(true);// Image preview effect\nuseEffect(()=>{if(newImage){const reader=new FileReader();reader.onloadend=()=>{setNewImagePreview(reader.result);};reader.readAsDataURL(newImage);}else{setNewImagePreview(null);}},[newImage]);// دالة السكرول إلى الأسفل\nconst scrollToBottom=useCallback(()=>{if(chatContainerRef.current){const container=chatContainerRef.current;container.scrollTop=container.scrollHeight;}},[]);// Reset first open flag when chat closes\nuseEffect(()=>{if(!isChatManuallyOpened){isFirstOpenRef.current=true;}},[isChatManuallyOpened]);// Socket authentication & connection management\nuseEffect(()=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول');navigate('/login');return;}try{const payload=JSON.parse(atob(token.split('.')[1]));socketRef.current=io(process.env.REACT_APP_API_URL,{autoConnect:false});const socket=socketRef.current;socket.connect();socket.emit('authenticate',{userId:payload.id,role:payload.role});socket.on('connect',()=>{console.log('Socket connected successfully');if(currentOrderIdRef.current){socket.emit('joinOrder',currentOrderIdRef.current);}});socket.on('error',err=>{console.error('Socket.IO error:',err);setError(\"\\u062E\\u0637\\u0623 \\u0641\\u064A \\u0627\\u0644\\u0627\\u062A\\u0635\\u0627\\u0644: \".concat(err.message||'غير معروف'));});socket.on('orderJoined',_ref=>{let{orderId}=_ref;console.log(\"Successfully joined order room: \".concat(orderId));});socket.on('disconnect',()=>{console.log('Socket disconnected');});return()=>{if(socket.connected){socket.disconnect();}};}catch(e){console.error('Token decode error:',e);setError('خطأ في التوثيق، يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}},[navigate]);// Fetch orders\nconst fetchOrders=useCallback(()=>{setLoading(true);const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لجلب الطلبات');navigate('/login');return;}let url=\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders\");const params=new URLSearchParams();if(vendorSearch)params.append('vendorName',vendorSearch);if(phoneSearch)params.append('phone',phoneSearch);if(orderNumberSearch)params.append('orderNumber',orderNumberSearch);if(startDate)params.append('startDate',startDate);if(endDate)params.append('endDate',endDate);if(statusFilters.rejected)params.append('status','rejected');if(statusFilters.shipped)params.append('status','shipped');if(statusFilters.delivered)params.append('status','delivered');params.append('page',page);params.append('limit',limit);if(params.toString())url+=\"?\".concat(params.toString());axios.get(url,{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{console.log('Fetched orders:',res.data);const fetchedOrders=res.data.orders||[];setOrders(fetchedOrders.map(order=>_objectSpread(_objectSpread({},order),{},{unreadCount:order.unreadCount||0,messages:order.messages||[]})));setTotal(res.data.total||0);setError(null);}).catch(err=>{var _err$response,_err$response$data,_err$response2;console.error('Fetch orders error:',err);const errorMessage=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'خطأ في جلب الطلبات: '+err.message;setError(errorMessage);if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}}).finally(()=>{setLoading(false);});},[vendorSearch,phoneSearch,orderNumberSearch,startDate,endDate,statusFilters,page,navigate]);useEffect(()=>{fetchOrders();},[fetchOrders]);// Global Socket Listeners - تحديث فوري للـ unreadCount\nuseEffect(()=>{const socket=socketRef.current;if(!socket)return;const userRole=getUserRole();const handleNewMessage=message=>{const orderId=message.orderId;// تحديث unreadCount فوراً في الـ orders\nif(message.from!==userRole){setOrders(prevOrders=>prevOrders.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount:(o.unreadCount||0)+1}):o));}// إذا الشات مفتوح، أضف الرسالة\nif(isChatManuallyOpened&&(selectedOrderForMessages===null||selectedOrderForMessages===void 0?void 0:selectedOrderForMessages._id)===orderId){setSelectedOrderForMessages(prev=>{var _prev$messages;const exists=(_prev$messages=prev.messages)===null||_prev$messages===void 0?void 0:_prev$messages.some(m=>m._id===message._id);if(exists)return prev;return _objectSpread(_objectSpread({},prev),{},{messages:[...(prev.messages||[]),message]});});setTimeout(scrollToBottom,100);}// إظهار زر الإشعار العائم\nif(!isChatManuallyOpened&&message.from!==userRole){setShowFloatingChatButton(true);}};const handleMessagesUpdated=data=>{const{orderId,messages}=data;const unreadCount=messages.filter(msg=>!msg.isRead&&msg.from!==userRole).length;setOrders(prev=>prev.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount,messages}):o));if(isChatManuallyOpened&&(selectedOrderForMessages===null||selectedOrderForMessages===void 0?void 0:selectedOrderForMessages._id)===orderId){setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:messages||[],unreadCount}));setTimeout(scrollToBottom,100);}};const handleUnreadUpdate=_ref2=>{let{orderId,unreadCount}=_ref2;setOrders(prev=>prev.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount}):o));if((selectedOrderForMessages===null||selectedOrderForMessages===void 0?void 0:selectedOrderForMessages._id)===orderId){setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{unreadCount}));}if(unreadCount>0&&!isChatManuallyOpened){setShowFloatingChatButton(true);}};socket.on('newMessage',handleNewMessage);socket.on('messagesUpdated',handleMessagesUpdated);socket.on('unreadUpdate',handleUnreadUpdate);return()=>{socket.off('newMessage',handleNewMessage);socket.off('messagesUpdated',handleMessagesUpdated);socket.off('unreadUpdate',handleUnreadUpdate);};},[isChatManuallyOpened,selectedOrderForMessages,scrollToBottom]);// Chat-specific socket handling\nuseEffect(()=>{if(!isChatManuallyOpened||!selectedOrderForMessages||!socketRef.current||selectedOrderForMessages.isGrouped){if(currentOrderIdRef.current&&socketRef.current){socketRef.current.emit('leaveOrder',currentOrderIdRef.current);currentOrderIdRef.current=null;}return;}const orderId=selectedOrderForMessages._id;currentOrderIdRef.current=orderId;socketRef.current.emit('joinOrder',orderId);const token=localStorage.getItem('token');axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(orderId,\"/markRead\"),{},{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{const updatedOrder=res.data.order;setOrders(prevOrders=>prevOrders.map(o=>o._id===orderId?updatedOrder:o));setSelectedOrderForMessages(_objectSpread(_objectSpread({},updatedOrder),{},{messages:updatedOrder.messages||[],unreadCount:0}));}).catch(console.error);if(isFirstOpenRef.current){setTimeout(scrollToBottom,100);isFirstOpenRef.current=false;}return()=>{socketRef.current.emit('leaveOrder',orderId);currentOrderIdRef.current=null;};},[isChatManuallyOpened,selectedOrderForMessages,scrollToBottom]);// Delete order\nconst handleDeleteOrder=id=>{if(!window.confirm('هل تريد حذف هذا الطلب؟'))return;const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لتتمكن من حذف الطلبات');navigate('/login');return;}axios.delete(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(id),{headers:{Authorization:\"Bearer \".concat(token)}}).then(()=>{setOrders(prev=>prev.filter(o=>o._id!==id));setError(null);alert('تم حذف الطلب بنجاح');}).catch(err=>{var _err$response3,_err$response3$data,_err$response4;const errorMessage=((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'خطأ في الحذف: '+err.message;setError(errorMessage);if(((_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});};// Update status\nconst handleUpdateStatus=(id,status)=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لتتمكن من تحديث حالة الطلب');navigate('/login');return;}axios.put(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(id,\"/status\"),{status},{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(prev=>prev.map(o=>o._id===id?res.data.order:o));setError(null);alert('تم تحديث حالة الطلب بنجاح');}).catch(err=>{var _err$response5,_err$response5$data,_err$response6;const errorMessage=((_err$response5=err.response)===null||_err$response5===void 0?void 0:(_err$response5$data=_err$response5.data)===null||_err$response5$data===void 0?void 0:_err$response5$data.message)||'خطأ في التحديث: '+err.message;setError(errorMessage);if(((_err$response6=err.response)===null||_err$response6===void 0?void 0:_err$response6.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});};// Edit order\nconst handleEditOrder=order=>{setEditOrder(order);setEditForm({quantity:order.quantity||1,address:order.address||''});};const handleEditSubmit=()=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لتتمكن من تعديل الطلب');navigate('/login');return;}axios.put(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(editOrder._id),editForm,{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(prev=>prev.map(o=>o._id===editOrder._id?res.data.order:o));setEditOrder(null);setEditForm({quantity:1,address:''});setError(null);alert('تم تعديل الطلب بنجاح');}).catch(err=>{var _err$response7,_err$response7$data,_err$response8;const errorMessage=((_err$response7=err.response)===null||_err$response7===void 0?void 0:(_err$response7$data=_err$response7.data)===null||_err$response7$data===void 0?void 0:_err$response7$data.message)||'خطأ في تعديل الطلب: '+err.message;setError(errorMessage);if(((_err$response8=err.response)===null||_err$response8===void 0?void 0:_err$response8.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});};// Media handlers\nconst openMedia=media=>{if(media){setSelectedMedia({url:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(media),type:'image'});}};const closeMedia=()=>setSelectedMedia(null);// Group orders - مع دعم unreadCount\nconst groupOrders=useCallback((ordersList,role)=>{if(role==='customer')return ordersList;const grouped={};let totalUnreadInGroup=0;ordersList.forEach(order=>{const key=\"\".concat(order.product._id,\"-\").concat(order.user._id,\"-\").concat(order.address);if(!grouped[key]){grouped[key]=_objectSpread(_objectSpread({},order),{},{quantity:0,orderIds:[],selectedImages:new Set(),messages:[],unreadCount:0,user:_objectSpread({},order.user)});}grouped[key].quantity+=order.quantity;grouped[key].orderIds.push(order._id);if(order.selectedImage){grouped[key].selectedImages.add(order.selectedImage);}grouped[key].unreadCount+=order.unreadCount||0;totalUnreadInGroup+=order.unreadCount||0;});return Object.values(grouped).map(group=>_objectSpread(_objectSpread({},group),{},{selectedImage:Array.from(group.selectedImages)[0]||'placeholder-image.jpg',isGrouped:group.orderIds.length>1,totalOrders:group.orderIds.length}));},[]);// Export to Word\nconst exportToWord=async()=>{try{const token=localStorage.getItem('token');let url=\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders\");const params=new URLSearchParams();if(vendorSearch)params.append('vendorName',vendorSearch);if(phoneSearch)params.append('phone',phoneSearch);if(orderNumberSearch)params.append('orderNumber',orderNumberSearch);if(startDate)params.append('startDate',startDate);if(endDate)params.append('endDate',endDate);if(statusFilters.rejected)params.append('status','rejected');if(statusFilters.shipped)params.append('status','shipped');if(statusFilters.delivered)params.append('status','delivered');if(params.toString())url+=\"?\".concat(params.toString());const res=await axios.get(url,{headers:{Authorization:\"Bearer \".concat(token)}});const allOrders=res.data.orders||res.data;const grouped=groupOrders(allOrders,getUserRole());const doc=new Document({sections:[{children:[new Paragraph({children:[new TextRun({text:'قائمة الطلبات',size:32,bold:true,rtl:true})],alignment:'right',spacing:{after:200}}),new Table({rows:[new TableRow({children:[new TableCell({children:[new Paragraph({text:'رقم الطلب',rtl:true,bold:true})],width:{size:10,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'الصورة',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'العميل',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'رقم الهاتف',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'العنوان',rtl:true,bold:true})],width:{size:15,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'المنتج',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'التاجر',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'تاريخ الطلب',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'الحالة',rtl:true,bold:true})],width:{size:12,type:WidthType.PERCENTAGE}}),new TableCell({children:[new Paragraph({text:'الكمية',rtl:true,bold:true})],width:{size:13,type:WidthType.PERCENTAGE}})]}),...grouped.map(order=>{var _order$user,_order$user2,_order$product,_order$product2,_order$product2$vendo;return new TableRow({children:[new TableCell({children:[new Paragraph({text:(order.orderNumber||'-').toString(),rtl:true})]}),new TableCell({children:[new Paragraph({text:order.selectedImage||'placeholder-image.jpg',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$user=order.user)===null||_order$user===void 0?void 0:_order$user.name)||'زائر',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$user2=order.user)===null||_order$user2===void 0?void 0:_order$user2.phone)||'-',rtl:true})]}),new TableCell({children:[new Paragraph({text:order.address||'-',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$product=order.product)===null||_order$product===void 0?void 0:_order$product.name)||'غير معروف',rtl:true})]}),new TableCell({children:[new Paragraph({text:((_order$product2=order.product)===null||_order$product2===void 0?void 0:(_order$product2$vendo=_order$product2.vendor)===null||_order$product2$vendo===void 0?void 0:_order$product2$vendo.name)||'غير معروف',rtl:true})]}),new TableCell({children:[new Paragraph({text:new Date(order.createdAt).toLocaleDateString('ar-EG')||'-',rtl:true})]}),new TableCell({children:[new Paragraph({text:{pending:'تحت المراجعة',shipped:'جاري الشحن',delivered:'تم التسليم',rejected:'مرفوض'}[order.status]||'غير معروف',rtl:true})]}),new TableCell({children:[new Paragraph({text:order.isGrouped?\"\".concat(order.quantity,\" (\\u0645\\u062C\\u0645\\u0639)\"):order.quantity.toString(),rtl:true})]})]});})],width:{size:100,type:WidthType.PERCENTAGE}})]}]});const blob=await Packer.toBlob(doc);saveAs(blob,'orders.docx');setError(null);}catch(error){console.error('Export to Word error:',error);setError('خطأ في تصدير الـ Word: '+error.message);}};// Send message handler\nconst handleSendMessage=async e=>{e.preventDefault();e.stopPropagation();const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول');navigate('/login');return;}if(!newMessage.trim()&&!newImage){setError('يجب إدخال رسالة أو رفع صورة');return;}const formData=new FormData();if(newMessage.trim())formData.append('text',newMessage.trim());if(newImage)formData.append('image',newImage);try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(selectedOrderForMessages._id,\"/message\"),formData,{headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'multipart/form-data'}});setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:res.data.order.messages||[]}));setNewMessage('');setNewImage(null);setNewImagePreview(null);setError(null);setTimeout(scrollToBottom,100);}catch(err){var _err$response9,_err$response9$data;const errorMessage=((_err$response9=err.response)===null||_err$response9===void 0?void 0:(_err$response9$data=_err$response9.data)===null||_err$response9$data===void 0?void 0:_err$response9$data.message)||'خطأ في إرسال الرسالة';setError(errorMessage);}};// Messages modal open/close\nconst openMessages=order=>{if(order.isGrouped){alert('الشات متاح فقط للطلبات الفردية');return;}const originalOrder=orders.find(o=>o._id===order._id);if(!originalOrder)return;setSelectedOrderForMessages(_objectSpread(_objectSpread({},originalOrder),{},{messages:originalOrder.messages||[],unreadCount:originalOrder.unreadCount||0}));setShowFloatingChatButton(false);setIsChatManuallyOpened(true);isFirstOpenRef.current=true;};const closeMessages=()=>{setSelectedOrderForMessages(null);setNewMessage('');setNewImage(null);setNewImagePreview(null);setShowFloatingChatButton(true);setIsChatManuallyOpened(false);};// User role getter\nconst getUserRole=()=>{const token=localStorage.getItem('token');if(token){try{const payload=JSON.parse(atob(token.split('.')[1]));return payload.role||'user';}catch(e){console.error('Error decoding token:',e);setError('خطأ في فك تشفير التوكن، يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');return'user';}}return'user';};const userRole=getUserRole();const rawDisplayOrders=showUnreadOnly?orders.filter(o=>(o.unreadCount||0)>0):orders;const displayOrders=groupOrders(rawDisplayOrders,userRole);const totalUnread=orders.reduce((acc,o)=>acc+(o.unreadCount||0),0);// Animation variants\nconst tableVariants={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:0.4,staggerChildren:0.05}}};const rowVariants={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:{duration:0.3}}};const buttonVariants={hover:{scale:1.05,boxShadow:'0 8px 16px rgba(239, 68, 68, 0.3)'},tap:{scale:0.95}};const modalVariants={hidden:{opacity:0,scale:0.85},visible:{opacity:1,scale:1,transition:{duration:0.25}},exit:{opacity:0,scale:0.85,transition:{duration:0.2}}};return/*#__PURE__*/_jsxs(motion.div,{className:\"min-h-screen flex flex-col items-center bg-[#18191a] p-4 sm:p-6 text-white overflow-x-hidden\",initial:{opacity:0},animate:{opacity:1},transition:{duration:0.5},children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl sm:text-4xl md:text-5xl font-bold mb-8 text-center bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-red-600 drop-shadow-lg\",children:\"\\u0642\\u0627\\u0626\\u0645\\u0629 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),error&&/*#__PURE__*/_jsxs(motion.div,{className:\"w-full max-w-4xl bg-red-900/90 text-white p-4 rounded-2xl mb-6 text-center font-medium shadow-2xl\",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:0.3},children:[error,/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),className:\"ml-4 text-xl font-bold\",children:\"\\xD7\"})]}),userRole!=='customer'&&/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-7xl mb-8 bg-[#242526] p-6 rounded-2xl shadow-2xl border border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-6\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0628\\u062D\\u062B \\u0628\\u0627\\u0633\\u0645 \\u0627\\u0644\\u062A\\u0627\\u062C\\u0631\",value:vendorSearch,onChange:e=>setVendorSearch(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0628\\u062D\\u062B \\u0628\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0647\\u0627\\u062A\\u0641\",value:phoneSearch,onChange:e=>setPhoneSearch(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0628\\u062D\\u062B \\u0628\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0637\\u0644\\u0628\",value:orderNumberSearch,onChange:e=>setOrderNumberSearch(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:startDate,onChange:e=>setStartDate(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:endDate,onChange:e=>setEndDate(e.target.value),className:\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-4 mb-6\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-300 font-medium\",children:\"\\u0641\\u0644\\u062A\\u0631 \\u0627\\u0644\\u062D\\u0627\\u0644\\u0629:\"}),['rejected','shipped','delivered'].map(status=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2 space-x-reverse cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:statusFilters[status],onChange:e=>setStatusFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[status]:e.target.checked})),className:\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:status==='rejected'?'مرفوض':status==='shipped'?'جاري الشحن':'تم التسليم'})]},status)),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2 space-x-reverse cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:showUnreadOnly,onChange:e=>setShowUnreadOnly(e.target.checked),className:\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"\\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A \\u0627\\u0644\\u062A\\u064A \\u0628\\u0647\\u0627 \\u0631\\u0633\\u0627\\u0626\\u0644 \\u063A\\u064A\\u0631 \\u0645\\u0642\\u0631\\u0648\\u0621\\u0629 \\u0641\\u0642\\u0637\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4\",children:[/*#__PURE__*/_jsx(motion.button,{onClick:fetchOrders,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0628\\u062D\\u062B\"}),/*#__PURE__*/_jsx(motion.button,{onClick:exportToWord,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062A\\u0635\\u062F\\u064A\\u0631 \\u0625\\u0644\\u0649 Word\"})]})]}),/*#__PURE__*/_jsxs(AnimatePresence,{mode:\"wait\",children:[loading&&/*#__PURE__*/_jsx(motion.p,{className:\"text-2xl text-gray-400 py-12\",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"},\"loading\"),!loading&&displayOrders.length===0&&/*#__PURE__*/_jsx(motion.p,{className:\"text-2xl text-gray-400 py-12\",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0637\\u0644\\u0628\\u0627\\u062A \\u062D\\u0627\\u0644\\u064A\\u0627\\u064B.\"},\"no-orders\"),!loading&&displayOrders.length>0&&/*#__PURE__*/_jsx(motion.div,{className:\"w-full max-w-7xl overflow-x-auto bg-[#242526] rounded-2xl shadow-2xl border border-gray-700\",variants:tableVariants,initial:\"hidden\",animate:\"visible\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-700\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-[#3a3b3c]\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0635\\u0648\\u0631\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0639\\u0645\\u064A\\u0644\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0647\\u0627\\u062A\\u0641\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u062A\\u0627\\u062C\\u0631\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u062D\\u0627\\u0644\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0643\\u0645\\u064A\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644 \\u063A\\u064A\\u0631 \\u0627\\u0644\\u0645\\u0642\\u0631\\u0648\\u0621\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\",children:\"\\u0625\\u062C\\u0631\\u0627\\u0621\\u0627\\u062A\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-[#242526] divide-y divide-gray-700\",children:displayOrders.map((order,idx)=>{var _order$user3,_order$user4,_order$product3,_order$product4,_order$product4$vendo;return/*#__PURE__*/_jsxs(motion.tr,{className:\"hover:bg-[#3a3b3c] transition duration-200\",variants:rowVariants,children:[/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right text-sm\",children:order.orderNumber||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-center\",children:/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(order.selectedImage),alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0627\\u0644\\u0637\\u0644\\u0628\",className:\"w-20 h-20 object-cover rounded-xl mx-auto cursor-pointer shadow-md hover:shadow-xl transition\",onClick:()=>openMedia(order.selectedImage),onError:e=>{e.target.onerror=null;e.target.src=\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/placeholder-image.jpg\");}})}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right font-medium\",children:((_order$user3=order.user)===null||_order$user3===void 0?void 0:_order$user3.name)||'زائر'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:((_order$user4=order.user)===null||_order$user4===void 0?void 0:_order$user4.phone)||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right text-ellipsis overflow-hidden max-w-xs\",children:order.address||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:((_order$product3=order.product)===null||_order$product3===void 0?void 0:_order$product3.name)||'غير معروف'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:((_order$product4=order.product)===null||_order$product4===void 0?void 0:(_order$product4$vendo=_order$product4.vendor)===null||_order$product4$vendo===void 0?void 0:_order$product4$vendo.name)||'غير معروف'}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:new Date(order.createdAt).toLocaleDateString('ar-EG')}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-right\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-4 py-2 rounded-full text-xs font-bold \".concat(order.status==='pending'?'bg-yellow-600/30 text-yellow-300 border border-yellow-600':order.status==='shipped'?'bg-blue-600/30 text-blue-300 border border-blue-600':order.status==='delivered'?'bg-green-600/30 text-green-300 border border-green-600':'bg-red-600/30 text-red-300 border border-red-600'),children:{pending:'تحت المراجعة',shipped:'جاري الشحن',delivered:'تم التسليم',rejected:'مرفوض'}[order.status]||'غير معروف'})}),/*#__PURE__*/_jsxs(\"td\",{className:\"py-4 px-6 text-right font-bold text-yellow-400\",children:[order.quantity,\" \",order.isGrouped&&\"(\\u0645\\u062C\\u0645\\u0639 \\u0645\\u0646 \".concat(order.totalOrders,\" \\u0637\\u0644\\u0628)\")]}),/*#__PURE__*/_jsxs(\"td\",{className:\"py-4 px-6 text-center\",children:[!order.isGrouped&&/*#__PURE__*/_jsxs(motion.button,{onClick:()=>openMessages(order),className:\"relative w-12 h-12 rounded-full flex items-center justify-center text-red-400 font-bold shadow-lg text-lg bg-gradient-to-r \".concat(order.unreadCount>0?'from-red-600 to-red-800 animate-pulse':'from-gray-600 to-gray-800'),variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"})}),order.unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-bounce\",children:order.unreadCount>99?'99+':order.unreadCount})]}),order.isGrouped&&order.unreadCount>0&&/*#__PURE__*/_jsx(\"div\",{className:\"relative inline-block\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-red-500 font-bold\",children:[order.unreadCount,\" \\u0631\\u0633\\u0627\\u0626\\u0644 \\u062C\\u062F\\u064A\\u062F\\u0629\"]})})]}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-end gap-3 flex-wrap\",children:[userRole==='admin'&&!order.isGrouped&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(motion.button,{className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",onClick:()=>handleEditOrder(order),children:\"\\u062A\\u0639\\u062F\\u064A\\u0644\"}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>handleDeleteOrder(order._id),className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062D\\u0630\\u0641\"})]}),userRole==='vendor'&&!order.isGrouped&&/*#__PURE__*/_jsxs(motion.select,{value:order.status,onChange:e=>handleUpdateStatus(order._id,e.target.value),className:\"p-3 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm\",variants:buttonVariants,whileHover:\"hover\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"pending\",children:\"\\u062A\\u062D\\u062A \\u0627\\u0644\\u0645\\u0631\\u0627\\u062C\\u0639\\u0629\"}),/*#__PURE__*/_jsx(\"option\",{value:\"shipped\",children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u0634\\u062D\\u0646\"}),/*#__PURE__*/_jsx(\"option\",{value:\"delivered\",children:\"\\u062A\\u0645 \\u0627\\u0644\\u062A\\u0633\\u0644\\u064A\\u0645\"}),/*#__PURE__*/_jsx(\"option\",{value:\"rejected\",children:\"\\u0645\\u0631\\u0641\\u0648\\u0636\"})]}),userRole==='customer'&&order.status==='pending'&&!order.isGrouped&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(motion.button,{className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",onClick:()=>handleEditOrder(order),children:\"\\u062A\\u0639\\u062F\\u064A\\u0644\"}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>handleDeleteOrder(order._id),className:\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062D\\u0630\\u0641\"})]})]})})]},order.isGrouped?\"group-\".concat(idx):order._id);})})]})},\"table-container\")]}),!loading&&total>limit&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center gap-6 mt-8\",children:[/*#__PURE__*/_jsx(motion.button,{onClick:()=>setPage(prev=>Math.max(1,prev-1)),disabled:page===1,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\",variants:buttonVariants,whileHover:page!==1?\"hover\":{},whileTap:page!==1?\"tap\":{},children:\"\\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xl text-gray-300\",children:[\"\\u0635\\u0641\\u062D\\u0629 \",page,\" \\u0645\\u0646 \",Math.ceil(total/limit)]}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>setPage(prev=>prev+1),disabled:page*limit>=total,className:\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\",variants:buttonVariants,whileHover:page*limit<total?\"hover\":{},whileTap:page*limit<total?\"tap\":{},children:\"\\u0627\\u0644\\u062A\\u0627\\u0644\\u064A\"})]}),(userRole==='customer'||userRole==='vendor')&&totalUnread>0&&showFloatingChatButton&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed bottom-6 right-6 z-50\",initial:{scale:0},animate:{scale:1},transition:{type:\"spring\",stiffness:300},children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{const orderWithUnread=orders.find(o=>!o.isGrouped&&o.unreadCount>0);if(orderWithUnread){openMessages(orderWithUnread);}},className:\"relative w-16 h-16 bg-gradient-to-r from-red-600 to-red-700 rounded-full shadow-2xl flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-8 w-8 text-red-400\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-7 h-7 flex items-center justify-center animate-pulse\",children:totalUnread>99?'99+':totalUnread})]})}),/*#__PURE__*/_jsx(AnimatePresence,{children:editOrder&&!editOrder.isGrouped&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",onClick:e=>e.stopPropagation(),children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-[#242526] p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold mb-8 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\",children:\"\\u062A\\u0639\\u062F\\u064A\\u0644 \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"\\u0627\\u0644\\u0643\\u0645\\u064A\\u0629\",value:editForm.quantity,onChange:e=>setEditForm(_objectSpread(_objectSpread({},editForm),{},{quantity:parseInt(e.target.value)||1})),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\",min:\"1\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\",value:editForm.address,onChange:e=>setEditForm(_objectSpread(_objectSpread({},editForm),{},{address:e.target.value})),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4 mt-8\",children:[/*#__PURE__*/_jsx(motion.button,{onClick:handleEditSubmit,className:\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-green-600 to-green-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u062D\\u0641\\u0638 \\u0627\\u0644\\u062A\\u0639\\u062F\\u064A\\u0644\\u0627\\u062A\"}),/*#__PURE__*/_jsx(motion.button,{onClick:()=>setEditOrder(null),className:\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedOrderForMessages&&isChatManuallyOpened&&!selectedOrderForMessages.isGrouped&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\",children:[\"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644 \\u0644\\u0644\\u0637\\u0644\\u0628 #\",selectedOrderForMessages.orderNumber]}),/*#__PURE__*/_jsx(\"div\",{ref:chatContainerRef,className:\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\",children:selectedOrderForMessages.messages&&selectedOrderForMessages.messages.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:selectedOrderForMessages.messages.map((msg,index)=>{var _selectedOrderForMess,_selectedOrderForMess2,_selectedOrderForMess3;const isMyMessage=msg.from===userRole;const senderName=msg.from==='vendor'?(_selectedOrderForMess=selectedOrderForMessages.product)===null||_selectedOrderForMess===void 0?void 0:(_selectedOrderForMess2=_selectedOrderForMess.vendor)===null||_selectedOrderForMess2===void 0?void 0:_selectedOrderForMess2.name:((_selectedOrderForMess3=selectedOrderForMessages.user)===null||_selectedOrderForMess3===void 0?void 0:_selectedOrderForMess3.name)||'غير معروف';return/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(isMyMessage?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md \".concat(isMyMessage?'bg-gradient-to-r from-red-600 to-red-800 text-white':'bg-gray-700 text-white'),children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold text-sm opacity-90\",children:[msg.from==='vendor'?'التاجر':'العميل',\": \",senderName]}),msg.text&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-lg\",children:msg.text}),msg.image&&/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(msg.image),alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\",className:\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\",onClick:e=>{e.stopPropagation();openMedia(msg.image);},onError:e=>{e.target.onerror=null;e.target.src=\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/placeholder-image.jpg\");}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-3 text-xs opacity-70\",children:[/*#__PURE__*/_jsx(\"p\",{children:new Date(msg.timestamp).toLocaleString('ar-EG')}),isMyMessage&&/*#__PURE__*/_jsx(\"span\",{children:msg.isRead?'✓✓':msg.isDelivered?'✓':'✓'})]})]})},msg._id||index);})}):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-400 text-lg\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0631\\u0633\\u0627\\u0626\\u0644 \\u0628\\u0639\\u062F.\"})}),(userRole==='vendor'||userRole==='customer')&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"\\u0627\\u0643\\u062A\\u0628 \\u0631\\u0633\\u0627\\u0644\\u062A\\u0643 \\u0647\\u0646\\u0627...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\",rows:\"4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:e=>setNewImage(e.target.files[0]||null),className:\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\"}),newImagePreview&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:newImagePreview,alt:\"\\u0645\\u0639\\u0627\\u064A\\u0646\\u0629\",className:\"w-24 h-24 object-cover rounded-xl shadow-lg\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setNewImage(null);setNewImagePreview(null);},className:\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\",children:\"\\xD7\"})]})]}),/*#__PURE__*/_jsx(motion.button,{type:\"submit\",className:\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\"})]}),/*#__PURE__*/_jsx(motion.button,{onClick:closeMessages,className:\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u063A\\u0644\\u0627\\u0642\"})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedMedia&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",onClick:closeMedia,children:/*#__PURE__*/_jsxs(motion.div,{className:\"relative max-w-4xl max-h-full\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"img\",{src:selectedMedia.url,className:\"max-w-full max-h-full rounded-2xl shadow-2xl\",alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0645\\u0643\\u0628\\u0631\\u0629\",onError:e=>{e.target.onerror=null;e.target.src=\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/placeholder-image.jpg\");}}),/*#__PURE__*/_jsx(motion.button,{onClick:closeMedia,className:\"absolute top-4 right-4 text-white text-5xl bg-black/70 rounded-full w-14 h-14 flex items-center justify-center shadow-xl hover:bg-black/90 transition\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\xD7\"})]})})})]});};export default Orders;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","motion","AnimatePresence","useNavigate","axios","Document","Packer","Paragraph","Table","TableCell","TableRow","TextRun","WidthType","saveAs","io","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Orders","orders","setOrders","vendorSearch","setVendorSearch","phoneSearch","setPhoneSearch","orderNumberSearch","setOrderNumberSearch","startDate","setStartDate","endDate","setEndDate","statusFilters","setStatusFilters","rejected","shipped","delivered","showUnreadOnly","setShowUnreadOnly","selectedMedia","setSelectedMedia","error","setError","editOrder","setEditOrder","editForm","setEditForm","quantity","address","selectedOrderForMessages","setSelectedOrderForMessages","isChatManuallyOpened","setIsChatManuallyOpened","newMessage","setNewMessage","newImage","setNewImage","newImagePreview","setNewImagePreview","page","setPage","total","setTotal","loading","setLoading","showFloatingChatButton","setShowFloatingChatButton","limit","navigate","socketRef","currentOrderIdRef","chatContainerRef","isFirstOpenRef","reader","FileReader","onloadend","result","readAsDataURL","scrollToBottom","current","container","scrollTop","scrollHeight","token","localStorage","getItem","payload","JSON","parse","atob","split","process","env","REACT_APP_API_URL","autoConnect","socket","connect","emit","userId","id","role","on","console","log","err","concat","message","_ref","orderId","connected","disconnect","e","removeItem","fetchOrders","url","params","URLSearchParams","append","toString","get","headers","Authorization","then","res","data","fetchedOrders","map","order","_objectSpread","unreadCount","messages","catch","_err$response","_err$response$data","_err$response2","errorMessage","response","status","finally","userRole","getUserRole","handleNewMessage","from","prevOrders","o","_id","prev","_prev$messages","exists","some","m","setTimeout","handleMessagesUpdated","filter","msg","isRead","length","handleUnreadUpdate","_ref2","off","isGrouped","post","updatedOrder","handleDeleteOrder","window","confirm","delete","alert","_err$response3","_err$response3$data","_err$response4","handleUpdateStatus","put","_err$response5","_err$response5$data","_err$response6","handleEditOrder","handleEditSubmit","_err$response7","_err$response7$data","_err$response8","openMedia","media","type","closeMedia","groupOrders","ordersList","grouped","totalUnreadInGroup","forEach","key","product","user","orderIds","selectedImages","Set","push","selectedImage","add","Object","values","group","Array","totalOrders","exportToWord","allOrders","doc","sections","children","text","size","bold","rtl","alignment","spacing","after","rows","width","PERCENTAGE","_order$user","_order$user2","_order$product","_order$product2","_order$product2$vendo","orderNumber","name","phone","vendor","Date","createdAt","toLocaleDateString","pending","blob","toBlob","handleSendMessage","preventDefault","stopPropagation","trim","formData","FormData","_err$response9","_err$response9$data","openMessages","originalOrder","find","closeMessages","rawDisplayOrders","displayOrders","totalUnread","reduce","acc","tableVariants","hidden","opacity","y","visible","transition","duration","staggerChildren","rowVariants","x","buttonVariants","hover","scale","boxShadow","tap","modalVariants","exit","div","className","initial","animate","onClick","placeholder","value","onChange","target","checked","button","variants","whileHover","whileTap","mode","p","idx","_order$user3","_order$user4","_order$product3","_order$product4","_order$product4$vendo","tr","src","alt","onError","onerror","xmlns","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","select","Math","max","disabled","ceil","stiffness","orderWithUnread","parseInt","min","ref","index","_selectedOrderForMess","_selectedOrderForMess2","_selectedOrderForMess3","isMyMessage","senderName","image","timestamp","toLocaleString","isDelivered","onSubmit","accept","files"],"sources":["/root/shose/app-shose/frontend/src/pages/Orders.js"],"sourcesContent":["// frontend/src/pages/Orders.js\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { Document, Packer, Paragraph, Table, TableCell, TableRow, TextRun, WidthType } from 'docx';\nimport { saveAs } from 'file-saver';\nimport { io } from 'socket.io-client';\n\nconst Orders = () => {\n  const [orders, setOrders] = useState([]);\n  const [vendorSearch, setVendorSearch] = useState('');\n  const [phoneSearch, setPhoneSearch] = useState('');\n  const [orderNumberSearch, setOrderNumberSearch] = useState('');\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n  const [statusFilters, setStatusFilters] = useState({ rejected: false, shipped: false, delivered: false });\n  const [showUnreadOnly, setShowUnreadOnly] = useState(false);\n  const [selectedMedia, setSelectedMedia] = useState(null);\n  const [error, setError] = useState(null);\n  const [editOrder, setEditOrder] = useState(null);\n  const [editForm, setEditForm] = useState({ quantity: 1, address: '' });\n  const [selectedOrderForMessages, setSelectedOrderForMessages] = useState(null);\n  const [isChatManuallyOpened, setIsChatManuallyOpened] = useState(false);\n  const [newMessage, setNewMessage] = useState('');\n  const [newImage, setNewImage] = useState(null);\n  const [newImagePreview, setNewImagePreview] = useState(null);\n  const [page, setPage] = useState(1);\n  const [total, setTotal] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [showFloatingChatButton, setShowFloatingChatButton] = useState(true);\n  const limit = 20;\n  const navigate = useNavigate();\n\n  // Refs\n  const socketRef = useRef(null);\n  const currentOrderIdRef = useRef(null);\n  const chatContainerRef = useRef(null);\n  const isFirstOpenRef = useRef(true);\n\n  // Image preview effect\n  useEffect(() => {\n    if (newImage) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setNewImagePreview(reader.result);\n      };\n      reader.readAsDataURL(newImage);\n    } else {\n      setNewImagePreview(null);\n    }\n  }, [newImage]);\n\n  // دالة السكرول إلى الأسفل\n  const scrollToBottom = useCallback(() => {\n    if (chatContainerRef.current) {\n      const container = chatContainerRef.current;\n      container.scrollTop = container.scrollHeight;\n    }\n  }, []);\n\n  // Reset first open flag when chat closes\n  useEffect(() => {\n    if (!isChatManuallyOpened) {\n      isFirstOpenRef.current = true;\n    }\n  }, [isChatManuallyOpened]);\n\n  // Socket authentication & connection management\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول');\n      navigate('/login');\n      return;\n    }\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      socketRef.current = io(process.env.REACT_APP_API_URL, { autoConnect: false });\n      const socket = socketRef.current;\n      socket.connect();\n      socket.emit('authenticate', { userId: payload.id, role: payload.role });\n      socket.on('connect', () => {\n        console.log('Socket connected successfully');\n        if (currentOrderIdRef.current) {\n          socket.emit('joinOrder', currentOrderIdRef.current);\n        }\n      });\n      socket.on('error', (err) => {\n        console.error('Socket.IO error:', err);\n        setError(`خطأ في الاتصال: ${err.message || 'غير معروف'}`);\n      });\n      socket.on('orderJoined', ({ orderId }) => {\n        console.log(`Successfully joined order room: ${orderId}`);\n      });\n      socket.on('disconnect', () => {\n        console.log('Socket disconnected');\n      });\n      return () => {\n        if (socket.connected) {\n          socket.disconnect();\n        }\n      };\n    } catch (e) {\n      console.error('Token decode error:', e);\n      setError('خطأ في التوثيق، يرجى تسجيل الدخول مرة أخرى');\n      localStorage.removeItem('token');\n      localStorage.removeItem('role');\n      localStorage.removeItem('userId');\n      navigate('/login');\n    }\n  }, [navigate]);\n\n  // Fetch orders\n  const fetchOrders = useCallback(() => {\n    setLoading(true);\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لجلب الطلبات');\n      navigate('/login');\n      return;\n    }\n    let url = `${process.env.REACT_APP_API_URL}/api/orders`;\n    const params = new URLSearchParams();\n    if (vendorSearch) params.append('vendorName', vendorSearch);\n    if (phoneSearch) params.append('phone', phoneSearch);\n    if (orderNumberSearch) params.append('orderNumber', orderNumberSearch);\n    if (startDate) params.append('startDate', startDate);\n    if (endDate) params.append('endDate', endDate);\n    if (statusFilters.rejected) params.append('status', 'rejected');\n    if (statusFilters.shipped) params.append('status', 'shipped');\n    if (statusFilters.delivered) params.append('status', 'delivered');\n    params.append('page', page);\n    params.append('limit', limit);\n    if (params.toString()) url += `?${params.toString()}`;\n    axios\n      .get(url, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(res => {\n        console.log('Fetched orders:', res.data);\n        const fetchedOrders = res.data.orders || [];\n        setOrders(fetchedOrders.map(order => ({\n          ...order,\n          unreadCount: order.unreadCount || 0,\n          messages: order.messages || []\n        })));\n        setTotal(res.data.total || 0);\n        setError(null);\n      })\n      .catch(err => {\n        console.error('Fetch orders error:', err);\n        const errorMessage = err.response?.data?.message || 'خطأ في جلب الطلبات: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      })\n      .finally(() => {\n        setLoading(false);\n      });\n  }, [vendorSearch, phoneSearch, orderNumberSearch, startDate, endDate, statusFilters, page, navigate]);\n\n  useEffect(() => {\n    fetchOrders();\n  }, [fetchOrders]);\n\n  // Global Socket Listeners - تحديث فوري للـ unreadCount\n  useEffect(() => {\n    const socket = socketRef.current;\n    if (!socket) return;\n    const userRole = getUserRole();\n    const handleNewMessage = (message) => {\n      const orderId = message.orderId;\n      // تحديث unreadCount فوراً في الـ orders\n      if (message.from !== userRole) {\n        setOrders(prevOrders =>\n          prevOrders.map(o =>\n            o._id === orderId\n              ? { ...o, unreadCount: (o.unreadCount || 0) + 1 }\n              : o\n          )\n        );\n      }\n      // إذا الشات مفتوح، أضف الرسالة\n      if (isChatManuallyOpened && selectedOrderForMessages?._id === orderId) {\n        setSelectedOrderForMessages(prev => {\n          const exists = prev.messages?.some(m => m._id === message._id);\n          if (exists) return prev;\n          return {\n            ...prev,\n            messages: [...(prev.messages || []), message],\n          };\n        });\n        setTimeout(scrollToBottom, 100);\n      }\n      // إظهار زر الإشعار العائم\n      if (!isChatManuallyOpened && message.from !== userRole) {\n        setShowFloatingChatButton(true);\n      }\n    };\n    const handleMessagesUpdated = (data) => {\n      const { orderId, messages } = data;\n      const unreadCount = messages.filter(msg => !msg.isRead && msg.from !== userRole).length;\n      setOrders(prev =>\n        prev.map(o => (o._id === orderId ? { ...o, unreadCount, messages } : o))\n      );\n      if (isChatManuallyOpened && selectedOrderForMessages?._id === orderId) {\n        setSelectedOrderForMessages(prev => ({\n          ...prev,\n          messages: messages || [],\n          unreadCount,\n        }));\n        setTimeout(scrollToBottom, 100);\n      }\n    };\n    const handleUnreadUpdate = ({ orderId, unreadCount }) => {\n      setOrders(prev =>\n        prev.map(o => (o._id === orderId ? { ...o, unreadCount } : o))\n      );\n      if (selectedOrderForMessages?._id === orderId) {\n        setSelectedOrderForMessages(prev => ({ ...prev, unreadCount }));\n      }\n      if (unreadCount > 0 && !isChatManuallyOpened) {\n        setShowFloatingChatButton(true);\n      }\n    };\n    socket.on('newMessage', handleNewMessage);\n    socket.on('messagesUpdated', handleMessagesUpdated);\n    socket.on('unreadUpdate', handleUnreadUpdate);\n    return () => {\n      socket.off('newMessage', handleNewMessage);\n      socket.off('messagesUpdated', handleMessagesUpdated);\n      socket.off('unreadUpdate', handleUnreadUpdate);\n    };\n  }, [isChatManuallyOpened, selectedOrderForMessages, scrollToBottom]);\n\n  // Chat-specific socket handling\n  useEffect(() => {\n    if (!isChatManuallyOpened || !selectedOrderForMessages || !socketRef.current || selectedOrderForMessages.isGrouped) {\n      if (currentOrderIdRef.current && socketRef.current) {\n        socketRef.current.emit('leaveOrder', currentOrderIdRef.current);\n        currentOrderIdRef.current = null;\n      }\n      return;\n    }\n    const orderId = selectedOrderForMessages._id;\n    currentOrderIdRef.current = orderId;\n    socketRef.current.emit('joinOrder', orderId);\n    const token = localStorage.getItem('token');\n    axios\n      .post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${orderId}/markRead`,\n        {},\n        { headers: { Authorization: `Bearer ${token}` } }\n      )\n      .then(res => {\n        const updatedOrder = res.data.order;\n        setOrders(prevOrders =>\n          prevOrders.map(o => (o._id === orderId ? updatedOrder : o))\n        );\n        setSelectedOrderForMessages({\n          ...updatedOrder,\n          messages: updatedOrder.messages || [],\n          unreadCount: 0,\n        });\n      })\n      .catch(console.error);\n    if (isFirstOpenRef.current) {\n      setTimeout(scrollToBottom, 100);\n      isFirstOpenRef.current = false;\n    }\n    return () => {\n      socketRef.current.emit('leaveOrder', orderId);\n      currentOrderIdRef.current = null;\n    };\n  }, [isChatManuallyOpened, selectedOrderForMessages, scrollToBottom]);\n\n  // Delete order\n  const handleDeleteOrder = (id) => {\n    if (!window.confirm('هل تريد حذف هذا الطلب؟')) return;\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لتتمكن من حذف الطلبات');\n      navigate('/login');\n      return;\n    }\n    axios\n      .delete(`${process.env.REACT_APP_API_URL}/api/orders/${id}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(() => {\n        setOrders(prev => prev.filter(o => o._id !== id));\n        setError(null);\n        alert('تم حذف الطلب بنجاح');\n      })\n      .catch(err => {\n        const errorMessage = err.response?.data?.message || 'خطأ في الحذف: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n  };\n\n  // Update status\n  const handleUpdateStatus = (id, status) => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لتتمكن من تحديث حالة الطلب');\n      navigate('/login');\n      return;\n    }\n    axios\n      .put(\n        `${process.env.REACT_APP_API_URL}/api/orders/${id}/status`,\n        { status },\n        { headers: { Authorization: `Bearer ${token}` } }\n      )\n      .then(res => {\n        setOrders(prev => prev.map(o => (o._id === id ? res.data.order : o)));\n        setError(null);\n        alert('تم تحديث حالة الطلب بنجاح');\n      })\n      .catch(err => {\n        const errorMessage = err.response?.data?.message || 'خطأ في التحديث: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n  };\n\n  // Edit order\n  const handleEditOrder = (order) => {\n    setEditOrder(order);\n    setEditForm({ quantity: order.quantity || 1, address: order.address || '' });\n  };\n  const handleEditSubmit = () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لتتمكن من تعديل الطلب');\n      navigate('/login');\n      return;\n    }\n    axios\n      .put(\n        `${process.env.REACT_APP_API_URL}/api/orders/${editOrder._id}`,\n        editForm,\n        { headers: { Authorization: `Bearer ${token}` } }\n      )\n      .then(res => {\n        setOrders(prev => prev.map(o => (o._id === editOrder._id ? res.data.order : o)));\n        setEditOrder(null);\n        setEditForm({ quantity: 1, address: '' });\n        setError(null);\n        alert('تم تعديل الطلب بنجاح');\n      })\n      .catch(err => {\n        const errorMessage = err.response?.data?.message || 'خطأ في تعديل الطلب: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n  };\n\n  // Media handlers\n  const openMedia = (media) => {\n    if (media) {\n      setSelectedMedia({ url: `${process.env.REACT_APP_API_URL}/Uploads/${media}`, type: 'image' });\n    }\n  };\n  const closeMedia = () => setSelectedMedia(null);\n\n  // Group orders - مع دعم unreadCount\n  const groupOrders = useCallback((ordersList, role) => {\n    if (role === 'customer') return ordersList;\n    const grouped = {};\n    let totalUnreadInGroup = 0;\n    ordersList.forEach(order => {\n      const key = `${order.product._id}-${order.user._id}-${order.address}`;\n      if (!grouped[key]) {\n        grouped[key] = {\n          ...order,\n          quantity: 0,\n          orderIds: [],\n          selectedImages: new Set(),\n          messages: [],\n          unreadCount: 0,\n          user: { ...order.user },\n        };\n      }\n      grouped[key].quantity += order.quantity;\n      grouped[key].orderIds.push(order._id);\n      if (order.selectedImage) {\n        grouped[key].selectedImages.add(order.selectedImage);\n      }\n      grouped[key].unreadCount += (order.unreadCount || 0);\n      totalUnreadInGroup += (order.unreadCount || 0);\n    });\n    return Object.values(grouped).map(group => ({\n      ...group,\n      selectedImage: Array.from(group.selectedImages)[0] || 'placeholder-image.jpg',\n      isGrouped: group.orderIds.length > 1,\n      totalOrders: group.orderIds.length,\n    }));\n  }, []);\n\n  // Export to Word\n  const exportToWord = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      let url = `${process.env.REACT_APP_API_URL}/api/orders`;\n      const params = new URLSearchParams();\n      if (vendorSearch) params.append('vendorName', vendorSearch);\n      if (phoneSearch) params.append('phone', phoneSearch);\n      if (orderNumberSearch) params.append('orderNumber', orderNumberSearch);\n      if (startDate) params.append('startDate', startDate);\n      if (endDate) params.append('endDate', endDate);\n      if (statusFilters.rejected) params.append('status', 'rejected');\n      if (statusFilters.shipped) params.append('status', 'shipped');\n      if (statusFilters.delivered) params.append('status', 'delivered');\n      if (params.toString()) url += `?${params.toString()}`;\n      const res = await axios.get(url, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      const allOrders = res.data.orders || res.data;\n      const grouped = groupOrders(allOrders, getUserRole());\n      const doc = new Document({\n        sections: [\n          {\n            children: [\n              new Paragraph({\n                children: [new TextRun({ text: 'قائمة الطلبات', size: 32, bold: true, rtl: true })],\n                alignment: 'right',\n                spacing: { after: 200 },\n              }),\n              new Table({\n                rows: [\n                  new TableRow({\n                    children: [\n                      new TableCell({ children: [new Paragraph({ text: 'رقم الطلب', rtl: true, bold: true })], width: { size: 10, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'الصورة', rtl: true, bold: true })], width: { size: 12, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'العميل', rtl: true, bold: true })], width: { size: 12, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'رقم الهاتف', rtl: true, bold: true })], width: { size: 12, type:  WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'العنوان', rtl: true, bold: true })], width: { size: 15, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'المنتج', rtl: true, bold: true })], width: { size: 12, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'التاجر', rtl: true, bold: true })], width: { size: 12, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'تاريخ الطلب', rtl: true, bold: true })], width: { size: 12, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'الحالة', rtl: true, bold: true })], width: { size: 12, type: WidthType.PERCENTAGE } }),\n                      new TableCell({ children: [new Paragraph({ text: 'الكمية', rtl: true, bold: true })], width: { size: 13, type: WidthType.PERCENTAGE } }),\n                    ],\n                  }),\n                  ...grouped.map(order =>\n                    new TableRow({\n                      children: [\n                        new TableCell({ children: [new Paragraph({ text: (order.orderNumber || '-').toString(), rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: order.selectedImage || 'placeholder-image.jpg', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: order.user?.name || 'زائر', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: order.user?.phone || '-', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: order.address || '-', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: order.product?.name || 'غير معروف', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: order.product?.vendor?.name || 'غير معروف', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: new Date(order.createdAt).toLocaleDateString('ar-EG') || '-', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: { pending: 'تحت المراجعة', shipped: 'جاري الشحن', delivered: 'تم التسليم', rejected: 'مرفوض' }[order.status] || 'غير معروف', rtl: true })] }),\n                        new TableCell({ children: [new Paragraph({ text: order.isGrouped ? `${order.quantity} (مجمع)` : order.quantity.toString(), rtl: true })] }),\n                      ],\n                    })\n                  ),\n                ],\n                width: { size: 100, type: WidthType.PERCENTAGE },\n              }),\n            ],\n          },\n        ],\n      });\n      const blob = await Packer.toBlob(doc);\n      saveAs(blob, 'orders.docx');\n      setError(null);\n    } catch (error) {\n      console.error('Export to Word error:', error);\n      setError('خطأ في تصدير الـ Word: ' + error.message);\n    }\n  };\n\n  // Send message handler\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول');\n      navigate('/login');\n      return;\n    }\n    if (!newMessage.trim() && !newImage) {\n      setError('يجب إدخال رسالة أو رفع صورة');\n      return;\n    }\n    const formData = new FormData();\n    if (newMessage.trim()) formData.append('text', newMessage.trim());\n    if (newImage) formData.append('image', newImage);\n    try {\n      const res = await axios.post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${selectedOrderForMessages._id}/message`,\n        formData,\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data',\n          },\n        }\n      );\n      setSelectedOrderForMessages(prev => ({\n        ...prev,\n        messages: res.data.order.messages || [],\n      }));\n      setNewMessage('');\n      setNewImage(null);\n      setNewImagePreview(null);\n      setError(null);\n      setTimeout(scrollToBottom, 100);\n    } catch (err) {\n      const errorMessage = err.response?.data?.message || 'خطأ في إرسال الرسالة';\n      setError(errorMessage);\n    }\n  };\n\n  // Messages modal open/close\n  const openMessages = (order) => {\n    if (order.isGrouped) {\n      alert('الشات متاح فقط للطلبات الفردية');\n      return;\n    }\n    const originalOrder = orders.find(o => o._id === order._id);\n    if (!originalOrder) return;\n    setSelectedOrderForMessages({\n      ...originalOrder,\n      messages: originalOrder.messages || [],\n      unreadCount: originalOrder.unreadCount || 0,\n    });\n    setShowFloatingChatButton(false);\n    setIsChatManuallyOpened(true);\n    isFirstOpenRef.current = true;\n  };\n  const closeMessages = () => {\n    setSelectedOrderForMessages(null);\n    setNewMessage('');\n    setNewImage(null);\n    setNewImagePreview(null);\n    setShowFloatingChatButton(true);\n    setIsChatManuallyOpened(false);\n  };\n\n  // User role getter\n  const getUserRole = () => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        return payload.role || 'user';\n      } catch (e) {\n        console.error('Error decoding token:', e);\n        setError('خطأ في فك تشفير التوكن، يرجى تسجيل الدخول مرة أخرى');\n        localStorage.removeItem('token');\n        localStorage.removeItem('role');\n        localStorage.removeItem('userId');\n        navigate('/login');\n        return 'user';\n      }\n    }\n    return 'user';\n  };\n  const userRole = getUserRole();\n  const rawDisplayOrders = showUnreadOnly ? orders.filter(o => (o.unreadCount || 0) > 0) : orders;\n  const displayOrders = groupOrders(rawDisplayOrders, userRole);\n  const totalUnread = orders.reduce((acc, o) => acc + (o.unreadCount || 0), 0);\n\n  // Animation variants\n  const tableVariants = { hidden: { opacity: 0, y: 20 }, visible: { opacity: 1, y: 0, transition: { duration: 0.4, staggerChildren: 0.05 } } };\n  const rowVariants = { hidden: { opacity: 0, x: -20 }, visible: { opacity: 1, x: 0, transition: { duration: 0.3 } } };\n  const buttonVariants = { hover: { scale: 1.05, boxShadow: '0 8px 16px rgba(239, 68, 68, 0.3)' }, tap: { scale: 0.95 } };\n  const modalVariants = { hidden: { opacity: 0, scale: 0.85 }, visible: { opacity: 1, scale: 1, transition: { duration: 0.25 } }, exit: { opacity: 0, scale: 0.85, transition: { duration: 0.2 } } };\n\n  return (\n    <motion.div className=\"min-h-screen flex flex-col items-center bg-[#18191a] p-4 sm:p-6 text-white overflow-x-hidden\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5 }}>\n      {/* Header */}\n      <h1 className=\"text-3xl sm:text-4xl md:text-5xl font-bold mb-8 text-center bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-red-600 drop-shadow-lg\">\n        قائمة الطلبات\n      </h1>\n\n      {/* Error Display */}\n      {error && (\n        <motion.div className=\"w-full max-w-4xl bg-red-900/90 text-white p-4 rounded-2xl mb-6 text-center font-medium shadow-2xl\" initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }} transition={{ duration: 0.3 }}>\n          {error}\n          <button onClick={() => setError(null)} className=\"ml-4 text-xl font-bold\">×</button>\n        </motion.div>\n      )}\n\n      {/* Filters Section */}\n      {userRole !== 'customer' && (\n        <div className=\"w-full max-w-7xl mb-8 bg-[#242526] p-6 rounded-2xl shadow-2xl border border-gray-700\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-6\">\n            <input type=\"text\" placeholder=\"ابحث باسم التاجر\" value={vendorSearch} onChange={(e) => setVendorSearch(e.target.value)} className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\" />\n            <input type=\"text\" placeholder=\"ابحث برقم الهاتف\" value={phoneSearch} onChange={(e) => setPhoneSearch(e.target.value)} className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\" />\n            <input type=\"text\" placeholder=\"ابحث برقم الطلب\" value={orderNumberSearch} onChange={(e) => setOrderNumberSearch(e.target.value)} className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\" />\n            <input type=\"date\" value={startDate} onChange={(e) => setStartDate(e.target.value)} className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\" />\n            <input type=\"date\" value={endDate} onChange={(e) => setEndDate(e.target.value)} className=\"p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition\" />\n          </div>\n          <div className=\"flex flex-wrap items-center gap-4 mb-6\">\n            <span className=\"text-gray-300 font-medium\">فلتر الحالة:</span>\n            {['rejected', 'shipped', 'delivered'].map(status => (\n              <label key={status} className=\"flex items-center space-x-2 space-x-reverse cursor-pointer\">\n                <input type=\"checkbox\" checked={statusFilters[status]} onChange={(e) => setStatusFilters(prev => ({ ...prev, [status]: e.target.checked }))} className=\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\" />\n                <span className=\"text-white\">{status === 'rejected' ? 'مرفوض' : status === 'shipped' ? 'جاري الشحن' : 'تم التسليم'}</span>\n              </label>\n            ))}\n            <label className=\"flex items-center space-x-2 space-x-reverse cursor-pointer\">\n              <input type=\"checkbox\" checked={showUnreadOnly} onChange={(e) => setShowUnreadOnly(e.target.checked)} className=\"w-5 h-5 text-red-600 rounded focus:ring-red-500 accent-red-600\" />\n              <span className=\"text-white\">الطلبات التي بها رسائل غير مقروءة فقط</span>\n            </label>\n          </div>\n          <div className=\"flex flex-wrap gap-4\">\n            <motion.button onClick={fetchOrders} className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">بحث</motion.button>\n            <motion.button onClick={exportToWord} className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">تصدير إلى Word</motion.button>\n          </div>\n        </div>\n      )}\n\n      {/* Loading / Empty / Table */}\n      <AnimatePresence mode=\"wait\">\n        {loading && <motion.p key=\"loading\" className=\"text-2xl text-gray-400 py-12\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>جاري التحميل...</motion.p>}\n        {!loading && displayOrders.length === 0 && <motion.p key=\"no-orders\" className=\"text-2xl text-gray-400 py-12\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>لا توجد طلبات حالياً.</motion.p>}\n        {!loading && displayOrders.length > 0 && (\n          <motion.div key=\"table-container\" className=\"w-full max-w-7xl overflow-x-auto bg-[#242526] rounded-2xl shadow-2xl border border-gray-700\" variants={tableVariants} initial=\"hidden\" animate=\"visible\">\n            <table className=\"min-w-full divide-y divide-gray-700\">\n              <thead className=\"bg-[#3a3b3c]\">\n                <tr>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">رقم الطلب</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الصورة</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">العميل</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">رقم الهاتف</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">العنوان</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">المنتج</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">التاجر</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">تاريخ الطلب</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الحالة</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الكمية</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">الرسائل غير المقروءة</th>\n                  <th className=\"py-5 px-6 text-right text-sm font-bold text-gray-300 uppercase tracking-wider\">إجراءات</th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-[#242526] divide-y divide-gray-700\">\n                {displayOrders.map((order, idx) => (\n                  <motion.tr key={order.isGrouped ? `group-${idx}` : order._id} className=\"hover:bg-[#3a3b3c] transition duration-200\" variants={rowVariants}>\n                    <td className=\"py-4 px-6 text-right text-sm\">{order.orderNumber || '-'}</td>\n                    <td className=\"py-4 px-6 text-center\">\n                      <img src={`${process.env.REACT_APP_API_URL}/Uploads/${order.selectedImage}`} alt=\"صورة الطلب\" className=\"w-20 h-20 object-cover rounded-xl mx-auto cursor-pointer shadow-md hover:shadow-xl transition\" onClick={() => openMedia(order.selectedImage)} onError={(e) => { e.target.onerror = null; e.target.src = `${process.env.REACT_APP_API_URL}/Uploads/placeholder-image.jpg`; }} />\n                    </td>\n                    <td className=\"py-4 px-6 text-right font-medium\">{order.user?.name || 'زائر'}</td>\n                    <td className=\"py-4 px-6 text-right\">{order.user?.phone || '-'}</td>\n                    <td className=\"py-4 px-6 text-right text-ellipsis overflow-hidden max-w-xs\">{order.address || '-'}</td>\n                    <td className=\"py-4 px-6 text-right\">{order.product?.name || 'غير معروف'}</td>\n                    <td className=\"py-4 px-6 text-right\">{order.product?.vendor?.name || 'غير معروف'}</td>\n                    <td className=\"py-4 px-6 text-right\">{new Date(order.createdAt).toLocaleDateString('ar-EG')}</td>\n                    <td className=\"py-4 px-6 text-right\">\n                      <span className={`px-4 py-2 rounded-full text-xs font-bold ${order.status === 'pending' ? 'bg-yellow-600/30 text-yellow-300 border border-yellow-600' : order.status === 'shipped' ? 'bg-blue-600/30 text-blue-300 border border-blue-600' : order.status === 'delivered' ? 'bg-green-600/30 text-green-300 border border-green-600' : 'bg-red-600/30 text-red-300 border border-red-600'}`}>\n                        {{ pending: 'تحت المراجعة', shipped: 'جاري الشحن', delivered: 'تم التسليم', rejected: 'مرفوض' }[order.status] || 'غير معروف'}\n                      </span>\n                    </td>\n                    <td className=\"py-4 px-6 text-right font-bold text-yellow-400\">\n                      {order.quantity} {order.isGrouped && `(مجمع من ${order.totalOrders} طلب)`}\n                    </td>\n                    <td className=\"py-4 px-6 text-center\">\n                      {!order.isGrouped && (\n                        <motion.button onClick={() => openMessages(order)} className={`relative w-12 h-12 rounded-full flex items-center justify-center text-red-400 font-bold shadow-lg text-lg bg-gradient-to-r ${order.unreadCount > 0 ? 'from-red-600 to-red-800 animate-pulse' : 'from-gray-600 to-gray-800'}`} variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\n                          </svg>\n                          {order.unreadCount > 0 && (\n                            <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-bounce\">\n                              {order.unreadCount > 99 ? '99+' : order.unreadCount}\n                            </span>\n                          )}\n                        </motion.button>\n                      )}\n                      {order.isGrouped && order.unreadCount > 0 && (\n                        <div className=\"relative inline-block\">\n                          <span className=\"text-red-500 font-bold\">{order.unreadCount} رسائل جديدة</span>\n                        </div>\n                      )}\n                    </td>\n                    <td className=\"py-4 px-6\">\n                      <div className=\"flex items-center justify-end gap-3 flex-wrap\">\n                        {userRole === 'admin' && !order.isGrouped && (\n                          <>\n                            <motion.button className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\" onClick={() => handleEditOrder(order)}>تعديل</motion.button>\n                            <motion.button onClick={() => handleDeleteOrder(order._id)} className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">حذف</motion.button>\n                          </>\n                        )}\n                        {userRole === 'vendor' && !order.isGrouped && (\n                          <motion.select value={order.status} onChange={(e) => handleUpdateStatus(order._id, e.target.value)} className=\"p-3 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm\" variants={buttonVariants} whileHover=\"hover\">\n                            <option value=\"pending\">تحت المراجعة</option>\n                            <option value=\"shipped\">جاري الشحن</option>\n                            <option value=\"delivered\">تم التسليم</option>\n                            <option value=\"rejected\">مرفوض</option>\n                          </motion.select>\n                        )}\n                        {userRole === 'customer' && order.status === 'pending' && !order.isGrouped && (\n                          <>\n                            <motion.button className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\" onClick={() => handleEditOrder(order)}>تعديل</motion.button>\n                            <motion.button onClick={() => handleDeleteOrder(order._id)} className=\"px-5 py-2 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">حذف</motion.button>\n                          </>\n                        )}\n                      </div>\n                    </td>\n                  </motion.tr>\n                ))}\n              </tbody>\n            </table>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Pagination */}\n      {!loading && total > limit && (\n        <div className=\"flex justify-center items-center gap-6 mt-8\">\n          <motion.button onClick={() => setPage(prev => Math.max(1, prev - 1))} disabled={page === 1} className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\" variants={buttonVariants} whileHover={page !== 1 ? \"hover\" : {}} whileTap={page !== 1 ? \"tap\" : {}}>السابق</motion.button>\n          <span className=\"text-xl text-gray-300\">صفحة {page} من {Math.ceil(total / limit)}</span>\n          <motion.button onClick={() => setPage(prev => prev + 1)} disabled={page * limit >= total} className=\"px-8 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed text-lg\" variants={buttonVariants} whileHover={page * limit < total ? \"hover\" : {}} whileTap={page * limit < total ? \"tap\" : {}}>التالي</motion.button>\n        </div>\n      )}\n\n      {/* Floating Chat Button */}\n      {(userRole === 'customer' || userRole === 'vendor') && totalUnread > 0 && showFloatingChatButton && (\n        <motion.div className=\"fixed bottom-6 right-6 z-50\" initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: \"spring\", stiffness: 300 }}>\n          <button\n            onClick={() => {\n              const orderWithUnread = orders.find(o => !o.isGrouped && o.unreadCount > 0);\n              if (orderWithUnread) {\n                openMessages(orderWithUnread);\n              }\n            }}\n            className=\"relative w-16 h-16 bg-gradient-to-r from-red-600 to-red-700 rounded-full shadow-2xl flex items-center justify-center\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8 text-red-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\n            </svg>\n            <span className=\"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-7 h-7 flex items-center justify-center animate-pulse\">\n              {totalUnread > 99 ? '99+' : totalUnread}\n            </span>\n          </button>\n        </motion.div>\n      )}\n\n      {/* Edit Modal */}\n      <AnimatePresence>\n        {editOrder && !editOrder.isGrouped && (\n          <motion.div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"exit\" onClick={(e) => e.stopPropagation()}>\n            <motion.div className=\"bg-[#242526] p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md\" onClick={(e) => e.stopPropagation()}>\n              <h2 className=\"text-3xl font-bold mb-8 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\">تعديل الطلب</h2>\n              <div className=\"space-y-6\">\n                <input type=\"number\" placeholder=\"الكمية\" value={editForm.quantity} onChange={(e) => setEditForm({ ...editForm, quantity: parseInt(e.target.value) || 1 })} className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\" min=\"1\" />\n                <input type=\"text\" placeholder=\"العنوان\" value={editForm.address} onChange={(e) => setEditForm({ ...editForm, address: e.target.value })} className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right text-lg\" />\n              </div>\n              <div className=\"flex gap-4 mt-8\">\n                <motion.button onClick={handleEditSubmit} className=\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-green-600 to-green-800 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">حفظ التعديلات</motion.button>\n                <motion.button onClick={() => setEditOrder(null)} className=\"flex-1 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">إلغاء</motion.button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Messages Modal */}\n      <AnimatePresence>\n        {selectedOrderForMessages && isChatManuallyOpened && !selectedOrderForMessages.isGrouped && (\n          <motion.div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"exit\">\n            <motion.div className=\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\" onClick={(e) => e.stopPropagation()}>\n              <h2 className=\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\">\n                الرسائل للطلب #{selectedOrderForMessages.orderNumber}\n              </h2>\n              <div ref={chatContainerRef} className=\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\">\n                {selectedOrderForMessages.messages && selectedOrderForMessages.messages.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {selectedOrderForMessages.messages.map((msg, index) => {\n                      const isMyMessage = msg.from === userRole;\n                      const senderName = msg.from === 'vendor' ? selectedOrderForMessages.product?.vendor?.name : selectedOrderForMessages.user?.name || 'غير معروف';\n                      return (\n                        <div key={msg._id || index} className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}>\n                          <div className={`max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md ${isMyMessage ? 'bg-gradient-to-r from-red-600 to-red-800 text-white' : 'bg-gray-700 text-white'}`}>\n                            <p className=\"font-bold text-sm opacity-90\">{msg.from === 'vendor' ? 'التاجر' : 'العميل'}: {senderName}</p>\n                            {msg.text && <p className=\"mt-2 text-lg\">{msg.text}</p>}\n                            {msg.image && (\n                              <img src={`${process.env.REACT_APP_API_URL}/Uploads/${msg.image}`} alt=\"صورة الرسالة\" className=\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\" onClick={(e) => { e.stopPropagation(); openMedia(msg.image); }} onError={(e) => { e.target.onerror = null; e.target.src = `${process.env.REACT_APP_API_URL}/Uploads/placeholder-image.jpg`; }} />\n                            )}\n                            <div className=\"flex items-center justify-between mt-3 text-xs opacity-70\">\n                              <p>{new Date(msg.timestamp).toLocaleString('ar-EG')}</p>\n                              {isMyMessage && <span>{msg.isRead ? '✓✓' : msg.isDelivered ? '✓' : '✓'}</span>}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-gray-400 text-lg\">لا توجد رسائل بعد.</p>\n                )}\n              </div>\n              {(userRole === 'vendor' || userRole === 'customer') && (\n                <form onSubmit={handleSendMessage} className=\"space-y-4\">\n                  <textarea placeholder=\"اكتب رسالتك هنا...\" value={newMessage} onChange={(e) => setNewMessage(e.target.value)} className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\" rows=\"4\" />\n                  <div className=\"flex items-center gap-4\">\n                    <input type=\"file\" accept=\"image/*\" onChange={(e) => setNewImage(e.target.files[0] || null)} className=\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\" />\n                    {newImagePreview && (\n                      <div className=\"relative\">\n                        <img src={newImagePreview} alt=\"معاينة\" className=\"w-24 h-24 object-cover rounded-xl shadow-lg\" />\n                        <button type=\"button\" onClick={() => { setNewImage(null); setNewImagePreview(null); }} className=\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\">×</button>\n                      </div>\n                    )}\n                  </div>\n                  <motion.button type=\"submit\" className=\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">إرسال الرسالة</motion.button>\n                </form>\n              )}\n              <motion.button onClick={closeMessages} className=\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">\n                إغلاق\n              </motion.button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Media Viewer Modal */}\n      <AnimatePresence>\n        {selectedMedia && (\n          <motion.div className=\"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"exit\" onClick={closeMedia}>\n            <motion.div className=\"relative max-w-4xl max-h-full\" onClick={(e) => e.stopPropagation()}>\n              <img src={selectedMedia.url} className=\"max-w-full max-h-full rounded-2xl shadow-2xl\" alt=\"صورة مكبرة\" onError={(e) => { e.target.onerror = null; e.target.src = `${process.env.REACT_APP_API_URL}/Uploads/placeholder-image.jpg`; }} />\n              <motion.button onClick={closeMedia} className=\"absolute top-4 right-4 text-white text-5xl bg-black/70 rounded-full w-14 h-14 flex items-center justify-center shadow-xl hover:bg-black/90 transition\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">×</motion.button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n};\n\nexport default Orders;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}