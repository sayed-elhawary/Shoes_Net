{"ast":null,"code":"import _objectSpread from\"/root/shose/app-shose/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// frontend/src/pages/Home.js\nimport{useState,useEffect,useRef}from'react';import{motion,AnimatePresence}from'framer-motion';import{Link,useNavigate}from'react-router-dom';import axios from'axios';import{io}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Home=()=>{const[products,setProducts]=useState([]);const[filteredProducts,setFilteredProducts]=useState([]);const[filterType,setFilterType]=useState('');const[cart,setCart]=useState([]);const[showCartModal,setShowCartModal]=useState(false);const[showOrderForm,setShowOrderForm]=useState(false);const[orderForm,setOrderForm]=useState({address:''});const[selectedMedia,setSelectedMedia]=useState(null);const[currentMediaIndex,setCurrentMediaIndex]=useState({});const[currentMediaType,setCurrentMediaType]=useState({});const[showAddedToCart,setShowAddedToCart]=useState(false);const[error,setError]=useState('');const[previousOrders,setPreviousOrders]=useState([]);const[isSubmitting,setIsSubmitting]=useState(false);const intervalRefs=useRef({});const navigate=useNavigate();// إضافات جديدة للرسائل\nconst[orders,setOrders]=useState([]);const[selectedOrderForMessages,setSelectedOrderForMessages]=useState(null);const[newMessage,setNewMessage]=useState('');const[newImage,setNewImage]=useState(null);const[newImagePreview,setNewImagePreview]=useState(null);const[showUnreadList,setShowUnreadList]=useState(false);// ليست منسدلة\nconst socketRef=useRef(null);const currentOrderIdRef=useRef(null);const messagesEndRef=useRef(null);// Image preview effect\nuseEffect(()=>{if(newImage){const reader=new FileReader();reader.onloadend=()=>{setNewImagePreview(reader.result);};reader.readAsDataURL(newImage);}else{setNewImagePreview(null);}},[newImage]);// Smooth scroll to bottom\nconst scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};// Socket authentication & connection management\nuseEffect(()=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول');navigate('/login');return;}try{const payload=JSON.parse(atob(token.split('.')[1]));socketRef.current=io(process.env.REACT_APP_API_URL,{autoConnect:false});const socket=socketRef.current;socket.connect();socket.emit('authenticate',{userId:payload.id,role:payload.role});socket.on('connect',()=>{console.log('Socket connected successfully');if(currentOrderIdRef.current){socket.emit('joinOrder',currentOrderIdRef.current);}});socket.on('error',err=>{console.error('Socket.IO error:',err);setError(\"\\u062E\\u0637\\u0623 \\u0641\\u064A \\u0627\\u0644\\u0627\\u062A\\u0635\\u0627\\u0644: \".concat(err.message||'غير معروف'));});socket.on('orderJoined',_ref=>{let{orderId}=_ref;console.log(\"Successfully joined order room: \".concat(orderId));});socket.on('disconnect',()=>{console.log('Socket disconnected');});return()=>{if(socket.connected){socket.disconnect();}};}catch(e){console.error('Token decode error:',e);setError('خطأ في التوثيق، يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}},[navigate]);// Fetch unread messages/orders\nconst fetchUnreadOrders=()=>{const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول لجلب الطلبات');navigate('/login');return;}axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders?unreadOnly=true\"),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(res.data.orders||[]);setError(null);}).catch(err=>{var _err$response,_err$response$data,_err$response2;console.error('Fetch orders error:',err);const errorMessage=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'خطأ في جلب الطلبات: '+err.message;setError(errorMessage);if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});};// Trigger fetch on mount\nuseEffect(()=>{fetchUnreadOrders();},[]);// Messages modal socket handling\nuseEffect(()=>{if(!selectedOrderForMessages||!socketRef.current){if(currentOrderIdRef.current&&socketRef.current){socketRef.current.emit('leaveOrder',currentOrderIdRef.current);currentOrderIdRef.current=null;}return;}const orderId=selectedOrderForMessages._id;currentOrderIdRef.current=orderId;socketRef.current.emit('joinOrder',orderId);const token=localStorage.getItem('token');axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(orderId,\"/markRead\"),{},{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(prevOrders=>prevOrders.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount:0}):o));setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:res.data.order.messages||[],unreadCount:0}));scrollToBottom();}).catch(err=>{console.error('Mark read error:',err);setError('خطأ في تحديث حالة القراءة');});const handleNewMessage=message=>{if(message.orderId!==orderId)return;setSelectedOrderForMessages(prev=>{var _prev$messages;const exists=(_prev$messages=prev.messages)===null||_prev$messages===void 0?void 0:_prev$messages.some(m=>m._id===message._id);if(exists)return prev;return _objectSpread(_objectSpread({},prev),{},{messages:[...(prev.messages||[]),message]});});if(message.from!==getUserRole()){setOrders(prevOrders=>prevOrders.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount:(o.unreadCount||0)+1}):o));}scrollToBottom();};const handleMessagesUpdated=data=>{if(data.orderId!==orderId)return;setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:data.messages||[],unreadCount:data.messages.filter(msg=>!msg.isRead&&msg.from!==getUserRole()).length}));scrollToBottom();};const handleUnreadUpdate=_ref2=>{let{orderId:updatedId,unreadCount}=_ref2;setOrders(prev=>prev.map(o=>o._id===updatedId?_objectSpread(_objectSpread({},o),{},{unreadCount}):o));if(updatedId===orderId){setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{unreadCount}));}};const socket=socketRef.current;socket.on('newMessage',handleNewMessage);socket.on('messagesUpdated',handleMessagesUpdated);socket.on('unreadUpdate',handleUnreadUpdate);scrollToBottom();return()=>{socket.off('newMessage',handleNewMessage);socket.off('messagesUpdated',handleMessagesUpdated);socket.off('unreadUpdate',handleUnreadUpdate);socket.emit('leaveOrder',orderId);currentOrderIdRef.current=null;};},[selectedOrderForMessages]);// Send message handler\nconst handleSendMessage=async e=>{e.preventDefault();e.stopPropagation();const token=localStorage.getItem('token');if(!token){setError('يرجى تسجيل الدخول');navigate('/login');return;}if(!newMessage.trim()&&!newImage){setError('يجب إدخال رسالة أو رفع صورة');return;}const formData=new FormData();if(newMessage.trim())formData.append('text',newMessage.trim());if(newImage)formData.append('image',newImage);try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(selectedOrderForMessages._id,\"/message\"),formData,{headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'multipart/form-data'}});setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:res.data.order.messages||[]}));setNewMessage('');setNewImage(null);setNewImagePreview(null);setError(null);scrollToBottom();}catch(err){var _err$response3,_err$response3$data;const errorMessage=((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'خطأ في إرسال الرسالة';setError(errorMessage);}};// Messages modal open/close\nconst openMessages=order=>{setSelectedOrderForMessages(order);setShowUnreadList(false);};const closeMessages=()=>{setSelectedOrderForMessages(null);setNewMessage('');setNewImage(null);setNewImagePreview(null);};// User role getter\nconst getUserRole=()=>{const token=localStorage.getItem('token');if(token){try{const payload=JSON.parse(atob(token.split('.')[1]));return payload.role||'user';}catch(e){console.error('Error decoding token:',e);setError('خطأ في فك تشفير التوكن، يرجى تسجيل الدخول مرة أخرى');localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');return'user';}}return'user';};const userRole=getUserRole();// فحص التوكن ودور المستخدم\nuseEffect(()=>{const token=localStorage.getItem('token');const role=localStorage.getItem('role');const userId=localStorage.getItem('userId');if(!token||!['admin','vendor','customer'].includes(role)){setError('غير مصرح: يرجى تسجيل الدخول كأدمن، تاجر، أو عميل');navigate('/login');return;}// جلب المنتجات\naxios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/products\"),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setProducts(res.data);setFilteredProducts(res.data);const initialIndexes=res.data.reduce((acc,product)=>_objectSpread(_objectSpread({},acc),{},{[product._id]:0}),{});const initialTypes=res.data.reduce((acc,product)=>_objectSpread(_objectSpread({},acc),{},{[product._id]:product.videos&&product.videos.length>0?'video':'image'}),{});setCurrentMediaIndex(initialIndexes);setCurrentMediaType(initialTypes);setError('');}).catch(err=>{var _err$response4,_err$response4$data,_err$response5;console.error('خطأ في جلب المنتجات:',err);setError(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.message)||'خطأ في جلب المنتجات');if(((_err$response5=err.response)===null||_err$response5===void 0?void 0:_err$response5.status)===401){localStorage.removeItem('token');localStorage.removeItem('role');localStorage.removeItem('userId');navigate('/login');}});// جلب السلة (للعملاء)\nif(role==='customer'){const savedCart=localStorage.getItem('cart');if(savedCart)setCart(JSON.parse(savedCart));}// جلب الطلبات السابقة\nif(role==='customer'&&userId){axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/user/\").concat(userId),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>setPreviousOrders(res.data)).catch(err=>console.error('خطأ في جلب الطلبات السابقة:',err));}},[navigate]);// تصفية المنتجات\nuseEffect(()=>{if(filterType===''){setFilteredProducts(products);}else{setFilteredProducts(products.filter(p=>p.type===filterType));}},[filterType,products]);// تدوير الصور تلقائيًا\nuseEffect(()=>{products.forEach(product=>{var _product$images;const totalImages=((_product$images=product.images)===null||_product$images===void 0?void 0:_product$images.length)||0;if(totalImages>1&&(!product.videos||product.videos.length===0)){clearInterval(intervalRefs.current[product._id]);intervalRefs.current[product._id]=setInterval(()=>{setCurrentMediaIndex(prev=>_objectSpread(_objectSpread({},prev),{},{[product._id]:(prev[product._id]+1)%totalImages}));setCurrentMediaType(prev=>_objectSpread(_objectSpread({},prev),{},{[product._id]:'image'}));},3000);}});return()=>Object.values(intervalRefs.current).forEach(clearInterval);},[products]);// حفظ السلة\nuseEffect(()=>{if(localStorage.getItem('role')==='customer'){localStorage.setItem('cart',JSON.stringify(cart));}},[cart]);const addToCart=product=>{var _product$videos;const currentIndex=currentMediaIndex[product._id]||0;const currentType=currentMediaType[product._id]||'image';if(currentType==='video'){alert('يرجى اختيار صورة لإضافتها إلى السلة');return;}const selectedImage=product.images[currentIndex-(((_product$videos=product.videos)===null||_product$videos===void 0?void 0:_product$videos.length)||0)]||'placeholder-image.jpg';setCart(prev=>{const existing=prev.find(i=>i.product._id===product._id&&i.selectedImage===selectedImage);if(existing){return prev.map(i=>i.product._id===product._id&&i.selectedImage===selectedImage?_objectSpread(_objectSpread({},i),{},{quantity:i.quantity+1}):i);}return[...prev,{product,quantity:1,selectedImage}];});setShowAddedToCart(true);setTimeout(()=>setShowAddedToCart(false),2000);};const updateCartQuantity=(productId,selectedImage,qty)=>{if(qty<1)return;setCart(prev=>prev.map(i=>i.product._id===productId&&i.selectedImage===selectedImage?_objectSpread(_objectSpread({},i),{},{quantity:qty}):i));};const removeFromCart=(productId,selectedImage)=>{setCart(prev=>prev.filter(i=>!(i.product._id===productId&&i.selectedImage===selectedImage)));};const handleOrderSubmit=()=>{if(isSubmitting||!orderForm.address)return;const token=localStorage.getItem('token');const userId=localStorage.getItem('userId');if(!token||!userId)return navigate('/login');let confirmSubmit=true;if(previousOrders.length>0){confirmSubmit=window.confirm('أنت طلبت الطلب مرة، هل تريد تأكيد طلبه مرة أخرى؟');}if(!confirmSubmit)return;setIsSubmitting(true);const promises=cart.map(item=>axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders\"),{product:item.product._id,vendor:item.product.vendor._id||item.product.vendor,quantity:item.quantity,user:userId,address:orderForm.address,selectedImage:item.selectedImage},{headers:{Authorization:\"Bearer \".concat(token)}}));Promise.all(promises).then(()=>{alert('تم إنشاء الطلبات بنجاح!');setCart([]);setShowOrderForm(false);setOrderForm({address:''});axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/user/\").concat(userId),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>setPreviousOrders(res.data));}).catch(err=>{var _err$response6,_err$response6$data,_err$response7;setError(((_err$response6=err.response)===null||_err$response6===void 0?void 0:(_err$response6$data=_err$response6.data)===null||_err$response6$data===void 0?void 0:_err$response6$data.message)||'خطأ في تقديم الطلب');if(((_err$response7=err.response)===null||_err$response7===void 0?void 0:_err$response7.status)===401){localStorage.clear();navigate('/login');}}).finally(()=>setIsSubmitting(false));};const openMedia=(media,type)=>{setSelectedMedia({url:\"\".concat(process.env.REACT_APP_API_URL,\"/uploads/\").concat(media),type});};const closeMedia=()=>setSelectedMedia(null);const handlePrevMedia=(id,p)=>{var _p$videos,_p$images;const total=(((_p$videos=p.videos)===null||_p$videos===void 0?void 0:_p$videos.length)||0)+(((_p$images=p.images)===null||_p$images===void 0?void 0:_p$images.length)||0);setCurrentMediaIndex(prev=>{const next=(prev[id]-1+total)%total;setCurrentMediaType(t=>{var _p$videos2;return _objectSpread(_objectSpread({},t),{},{[id]:next<(((_p$videos2=p.videos)===null||_p$videos2===void 0?void 0:_p$videos2.length)||0)?'video':'image'});});return _objectSpread(_objectSpread({},prev),{},{[id]:next});});clearInterval(intervalRefs.current[id]);};const handleNextMedia=(id,p)=>{var _p$videos3,_p$images2;const total=(((_p$videos3=p.videos)===null||_p$videos3===void 0?void 0:_p$videos3.length)||0)+(((_p$images2=p.images)===null||_p$images2===void 0?void 0:_p$images2.length)||0);setCurrentMediaIndex(prev=>{const next=(prev[id]+1)%total;setCurrentMediaType(t=>{var _p$videos4;return _objectSpread(_objectSpread({},t),{},{[id]:next<(((_p$videos4=p.videos)===null||_p$videos4===void 0?void 0:_p$videos4.length)||0)?'video':'image'});});return _objectSpread(_objectSpread({},prev),{},{[id]:next});});clearInterval(intervalRefs.current[id]);};// === الأنيميشن ===\nconst cardVariants={hidden:{opacity:0,y:30,scale:0.95},visible:{opacity:1,y:0,scale:1,transition:{duration:0.7,ease:[0.22,1,0.36,1]}},hover:{scale:1.03,boxShadow:'0 12px 24px rgba(0, 0, 0, 0.2)',transition:{duration:0.2}}};const buttonVariants={hover:{scale:1.05,boxShadow:'0 8px 16px rgba(239, 68, 68, 0.3)'},tap:{scale:0.95}};const modalVariants={hidden:{opacity:0,scale:0.85},visible:{opacity:1,scale:1}};const toastVariants={hidden:{opacity:0,x:50},visible:{opacity:1,x:0}};const listVariants={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0},exit:{opacity:0,y:-10}};const role=localStorage.getItem('role');const isCustomer=role==='customer';const totalUnread=orders.reduce((acc,o)=>acc+(o.unreadCount||0),0);return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-[#18191a] text-white p-4 relative overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative z-10 w-full max-w-7xl mx-auto\",children:[/*#__PURE__*/_jsxs(motion.div,{className:\"flex flex-col items-center mb-8\",initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:0.8},children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mt-3\",children:\"\\u0645\\u062A\\u062C\\u0631 SHOSE NET\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-300 text-lg mt-1\",children:\"\\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\\u0627\\u062A \\u0627\\u0644\\u0645\\u062A\\u0627\\u062D\\u0629\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4\",children:[/*#__PURE__*/_jsxs(motion.select,{value:filterType,onChange:e=>setFilterType(e.target.value),className:\"p-3 rounded-xl bg-slate-800/60 backdrop-blur-md border border-slate-600 text-white focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\",whileHover:{scale:1.03},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0627\\u0644\\u0643\\u0644\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u0631\\u062C\\u0627\\u0644\\u064A\",children:\"\\u0631\\u062C\\u0627\\u0644\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u062D\\u0631\\u064A\\u0645\\u064A\",children:\"\\u062D\\u0631\\u064A\\u0645\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u0623\\u0637\\u0641\\u0627\\u0644\",children:\"\\u0623\\u0637\\u0641\\u0627\\u0644\"})]}),isCustomer&&/*#__PURE__*/_jsxs(motion.button,{onClick:()=>setShowCartModal(true),className:\"px-6 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-700 shadow-lg hover:from-red-700 hover:to-red-800\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:[\"\\u0627\\u0644\\u0633\\u0644\\u0629 (\",cart.reduce((a,i)=>a+i.quantity,0),\")\"]}),(userRole==='customer'||userRole==='vendor')&&totalUnread>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsxs(motion.button,{onClick:()=>setShowUnreadList(prev=>!prev),className:\"px-6 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-700 shadow-lg hover:from-blue-700 hover:to-blue-800 flex items-center gap-2\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:[\"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644 \\u063A\\u064A\\u0631 \\u0627\\u0644\\u0645\\u0642\\u0631\\u0648\\u0621\\u0629 (\",totalUnread,\")\",/*#__PURE__*/_jsx(\"span\",{className:\"transition-transform duration-200 \".concat(showUnreadList?'rotate-180':''),children:\"Down Arrow\"})]}),/*#__PURE__*/_jsx(AnimatePresence,{children:showUnreadList&&/*#__PURE__*/_jsx(motion.div,{variants:listVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",className:\"absolute top-full mt-2 w-72 bg-[#242526] backdrop-blur-xl rounded-xl shadow-2xl border border-gray-700 z-50 max-h-64 overflow-y-auto\",children:orders.map(order=>{var _order$product;return/*#__PURE__*/_jsxs(\"div\",{onClick:()=>openMessages(order),className:\"p-4 border-b border-gray-700 hover:bg-gray-800/60 cursor-pointer transition-colors duration-200\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold text-red-400\",children:[\"\\u0637\\u0644\\u0628 #\",order.orderNumber]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-300\",children:[\"\\u0627\\u0644\\u0645\\u0646\\u062A\\u062C: \",(_order$product=order.product)===null||_order$product===void 0?void 0:_order$product.name]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-red-400 mt-1\",children:[\"\\u063A\\u064A\\u0631 \\u0645\\u0642\\u0631\\u0648\\u0621: \",order.unreadCount]})]},order._id);})})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",children:filteredProducts.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"col-span-full text-center text-slate-400 text-xl\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0645\\u0646\\u062A\\u062C\\u0627\\u062A...\"}):filteredProducts.map(product=>{var _product$videos2,_product$images2,_product$videos3,_product$videos5,_product$images3,_product$vendor,_product$vendor2;return/*#__PURE__*/_jsxs(motion.div,{className:\"bg-slate-900/60 backdrop-blur-xl rounded-2xl shadow-2xl border border-slate-700/50 overflow-hidden\",variants:cardVariants,initial:\"hidden\",whileInView:\"visible\",viewport:{once:true},whileHover:\"hover\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative aspect-[4/3] bg-slate-800\",children:[currentMediaType[product._id]==='video'&&((_product$videos2=product.videos)===null||_product$videos2===void 0?void 0:_product$videos2.length)>0?/*#__PURE__*/_jsx(\"video\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/uploads/\").concat(product.videos[currentMediaIndex[product._id]]),controls:true,className:\"w-full h-full object-cover\",onClick:()=>openMedia(product.videos[currentMediaIndex[product._id]],'video')}):((_product$images2=product.images)===null||_product$images2===void 0?void 0:_product$images2.length)>0?/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/uploads/\").concat(product.images[(currentMediaIndex[product._id]||0)-(((_product$videos3=product.videos)===null||_product$videos3===void 0?void 0:_product$videos3.length)||0)]),alt:product.name,className:\"w-full h-full object-cover\",onClick:()=>{var _product$videos4;return openMedia(product.images[(currentMediaIndex[product._id]||0)-(((_product$videos4=product.videos)===null||_product$videos4===void 0?void 0:_product$videos4.length)||0)],'image');}}):/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-full bg-slate-700 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-slate-500\",children:\"\\u0628\\u062F\\u0648\\u0646 \\u0635\\u0648\\u0631\\u0629\"})}),(((_product$videos5=product.videos)===null||_product$videos5===void 0?void 0:_product$videos5.length)||0)+(((_product$images3=product.images)===null||_product$images3===void 0?void 0:_product$images3.length)||0)>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute inset-x-0 bottom-3 flex justify-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePrevMedia(product._id,product),className:\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\",children:\"Left Arrow\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleNextMedia(product._id,product),className:\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\",children:\"Right Arrow\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-5 space-y-2 text-right\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600\",children:product.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-slate-300 space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0627\\u0644\\u062A\\u0627\\u062C\\u0631: \",/*#__PURE__*/_jsx(Link,{to:\"/vendors/\".concat((_product$vendor=product.vendor)===null||_product$vendor===void 0?void 0:_product$vendor._id,\"/products\"),className:\"text-red-400 hover:text-red-300\",children:(_product$vendor2=product.vendor)===null||_product$vendor2===void 0?void 0:_product$vendor2.name})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0627\\u0644\\u0646\\u0648\\u0639: \",product.type]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0643\\u0631\\u062A\\u0648\\u0646\\u0629: \",product.price,\" \\u062C\\u0646\\u064A\\u0647\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u062C\\u0648\\u0632: \",(product.price/product.quantityPerCarton).toFixed(2),\" \\u062C\\u0646\\u064A\\u0647\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0627\\u0644\\u0643\\u0631\\u062A\\u0648\\u0646\\u0629: \",product.quantityPerCarton,\" \\u062C\\u0648\\u0632\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0627\\u0644\\u0645\\u0635\\u0646\\u0639: \",product.manufacturer]})]}),isCustomer&&/*#__PURE__*/_jsx(motion.button,{onClick:()=>addToCart(product),className:\"w-full mt-4 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0625\\u0644\\u0649 \\u0627\\u0644\\u0633\\u0644\\u0629\"})]})]},product._id);})})]}),/*#__PURE__*/_jsx(AnimatePresence,{children:showAddedToCart&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed top-6 right-6 bg-green-600 text-white px-5 py-3 rounded-full shadow-xl flex items-center gap-2 z-50\",variants:toastVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",children:/*#__PURE__*/_jsx(\"span\",{children:\"\\u062A\\u0645\\u062A \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0629\"})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:showCartModal&&isCustomer&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",onClick:()=>setShowCartModal(false),children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-lg\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\",children:\"\\u0627\\u0644\\u0633\\u0644\\u0629\"}),cart.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-slate-400\",children:\"\\u0627\\u0644\\u0633\\u0644\\u0629 \\u0641\\u0627\\u0631\\u063A\\u0629\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4 max-h-96 overflow-y-auto\",children:cart.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between gap-4 p-3 bg-slate-800/50 rounded-xl\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/uploads/\").concat(item.selectedImage),alt:\"\",className:\"w-16 h-16 object-cover rounded-lg\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right flex-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:item.product.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-slate-400\",children:[\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0643\\u0631\\u062A\\u0648\\u0646\\u0629: \",item.product.price,\" \\u062C\\u0646\\u064A\\u0647\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",value:item.quantity,onChange:e=>updateCartQuantity(item.product._id,item.selectedImage,parseInt(e.target.value)),className:\"w-16 p-2 bg-slate-700 rounded text-center\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFromCart(item.product._id,item.selectedImage),className:\"text-red-400 hover:text-red-300\",children:\"\\xD7\"})]})]},\"\".concat(item.product._id,\"-\").concat(item.selectedImage)))}),cart.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowCartModal(false);setShowOrderForm(true);},className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-green-600 to-green-700 text-white font-bold\",children:\"\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCartModal(false),className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold\",children:\"\\u0625\\u063A\\u0644\\u0627\\u0642\"})]})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:showOrderForm&&isCustomer&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",onClick:()=>setShowOrderForm(false),children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-md\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\",children:\"\\u0625\\u062F\\u062E\\u0627\\u0644 \\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\",value:orderForm.address,onChange:e=>setOrderForm({address:e.target.value}),className:\"w-full p-4 mb-6 bg-slate-800/60 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleOrderSubmit,disabled:isSubmitting,className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-green-600 to-green-700 text-white font-bold disabled:opacity-70\",children:isSubmitting?'جاري...':'إرسال'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowOrderForm(false),className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold\",children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedMedia&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/90 flex items-center justify-center z-50\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",onClick:closeMedia,children:/*#__PURE__*/_jsxs(motion.div,{className:\"relative max-w-4xl max-h-screen p-4\",onClick:e=>e.stopPropagation(),children:[selectedMedia.type==='image'?/*#__PURE__*/_jsx(\"img\",{src:selectedMedia.url,alt:\"\",className:\"max-w-full max-h-screen rounded-2xl shadow-2xl\"}):/*#__PURE__*/_jsx(\"video\",{src:selectedMedia.url,controls:true,autoPlay:true,className:\"max-w-full max-h-screen rounded-2xl shadow-2xl\"}),/*#__PURE__*/_jsx(\"button\",{onClick:closeMedia,className:\"absolute top-4 right-4 bg-red-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg hover:bg-red-700\",children:\"\\xD7\"})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedOrderForMessages&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",onClick:closeMessages,children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\",children:[\"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644 \\u0644\\u0644\\u0637\\u0644\\u0628 #\",selectedOrderForMessages.orderNumber]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\",children:[selectedOrderForMessages.messages&&selectedOrderForMessages.messages.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:selectedOrderForMessages.messages.map((msg,index)=>{var _selectedOrderForMess,_selectedOrderForMess2,_selectedOrderForMess3;const isMyMessage=msg.from===userRole;const senderName=msg.from==='vendor'?(_selectedOrderForMess=selectedOrderForMessages.product)===null||_selectedOrderForMess===void 0?void 0:(_selectedOrderForMess2=_selectedOrderForMess.vendor)===null||_selectedOrderForMess2===void 0?void 0:_selectedOrderForMess2.name:((_selectedOrderForMess3=selectedOrderForMessages.user)===null||_selectedOrderForMess3===void 0?void 0:_selectedOrderForMess3.name)||'غير معروف';return/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(isMyMessage?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md \".concat(isMyMessage?'bg-gradient-to-r from-red-600 to-red-800 text-white':'bg-gray-700 text-white'),children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold text-sm opacity-90\",children:[msg.from==='vendor'?'التاجر':'العميل',\": \",senderName]}),msg.text&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-lg\",children:msg.text}),msg.image&&/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(msg.image),alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\",className:\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\",onClick:e=>{e.stopPropagation();openMedia(msg.image,'image');},onError:e=>{e.target.onerror=null;e.target.src=\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/placeholder-image.jpg\");}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-3 text-xs opacity-70\",children:[/*#__PURE__*/_jsx(\"p\",{children:new Date(msg.timestamp).toLocaleString('ar-EG')}),isMyMessage&&/*#__PURE__*/_jsx(\"span\",{children:msg.isRead?'Seen':msg.isDelivered?'Delivered':'Sent'})]})]})},msg._id||index);})}):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-400 text-lg\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0631\\u0633\\u0627\\u0626\\u0644 \\u0628\\u0639\\u062F.\"}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),(userRole==='vendor'||userRole==='customer')&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"\\u0627\\u0643\\u062A\\u0628 \\u0631\\u0633\\u0627\\u0644\\u062A\\u0643 \\u0647\\u0646\\u0627...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\",rows:\"4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:e=>setNewImage(e.target.files[0]||null),className:\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\"}),newImagePreview&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:newImagePreview,alt:\"\\u0645\\u0639\\u0627\\u064A\\u0646\\u0629\",className:\"w-24 h-24 object-cover rounded-xl shadow-lg\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setNewImage(null);setNewImagePreview(null);},className:\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\",children:\"\\xD7\"})]})]}),/*#__PURE__*/_jsx(motion.button,{type:\"submit\",className:\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\"})]}),/*#__PURE__*/_jsx(motion.button,{onClick:closeMessages,className:\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u063A\\u0644\\u0627\\u0642\"})]})})})]});};export default Home;","map":{"version":3,"names":["useState","useEffect","useRef","motion","AnimatePresence","Link","useNavigate","axios","io","jsx","_jsx","jsxs","_jsxs","Home","products","setProducts","filteredProducts","setFilteredProducts","filterType","setFilterType","cart","setCart","showCartModal","setShowCartModal","showOrderForm","setShowOrderForm","orderForm","setOrderForm","address","selectedMedia","setSelectedMedia","currentMediaIndex","setCurrentMediaIndex","currentMediaType","setCurrentMediaType","showAddedToCart","setShowAddedToCart","error","setError","previousOrders","setPreviousOrders","isSubmitting","setIsSubmitting","intervalRefs","navigate","orders","setOrders","selectedOrderForMessages","setSelectedOrderForMessages","newMessage","setNewMessage","newImage","setNewImage","newImagePreview","setNewImagePreview","showUnreadList","setShowUnreadList","socketRef","currentOrderIdRef","messagesEndRef","reader","FileReader","onloadend","result","readAsDataURL","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","token","localStorage","getItem","payload","JSON","parse","atob","split","process","env","REACT_APP_API_URL","autoConnect","socket","connect","emit","userId","id","role","on","console","log","err","concat","message","_ref","orderId","connected","disconnect","e","removeItem","fetchUnreadOrders","get","headers","Authorization","then","res","data","catch","_err$response","_err$response$data","_err$response2","errorMessage","response","status","_id","post","prevOrders","map","o","_objectSpread","unreadCount","prev","messages","order","handleNewMessage","_prev$messages","exists","some","m","from","getUserRole","handleMessagesUpdated","filter","msg","isRead","length","handleUnreadUpdate","_ref2","updatedId","off","handleSendMessage","preventDefault","stopPropagation","trim","formData","FormData","append","_err$response3","_err$response3$data","openMessages","closeMessages","userRole","includes","initialIndexes","reduce","acc","product","initialTypes","videos","_err$response4","_err$response4$data","_err$response5","savedCart","p","type","forEach","_product$images","totalImages","images","clearInterval","setInterval","Object","values","setItem","stringify","addToCart","_product$videos","currentIndex","currentType","alert","selectedImage","existing","find","i","quantity","setTimeout","updateCartQuantity","productId","qty","removeFromCart","handleOrderSubmit","confirmSubmit","window","confirm","promises","item","vendor","user","Promise","all","_err$response6","_err$response6$data","_err$response7","clear","finally","openMedia","media","url","closeMedia","handlePrevMedia","_p$videos","_p$images","total","next","t","_p$videos2","handleNextMedia","_p$videos3","_p$images2","_p$videos4","cardVariants","hidden","opacity","y","scale","visible","transition","duration","ease","hover","boxShadow","buttonVariants","tap","modalVariants","toastVariants","x","listVariants","exit","isCustomer","totalUnread","className","children","div","initial","animate","select","value","onChange","target","whileHover","button","onClick","variants","whileTap","a","_order$product","orderNumber","name","_product$videos2","_product$images2","_product$videos3","_product$videos5","_product$images3","_product$vendor","_product$vendor2","whileInView","viewport","once","src","controls","alt","_product$videos4","to","price","quantityPerCarton","toFixed","manufacturer","min","parseInt","placeholder","disabled","autoPlay","index","_selectedOrderForMess","_selectedOrderForMess2","_selectedOrderForMess3","isMyMessage","senderName","text","image","onError","onerror","Date","timestamp","toLocaleString","isDelivered","ref","onSubmit","rows","accept","files"],"sources":["/root/shose/app-shose/frontend/src/pages/Home.js"],"sourcesContent":["// frontend/src/pages/Home.js\nimport { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Link, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { io } from 'socket.io-client';\n\nconst Home = () => {\n  const [products, setProducts] = useState([]);\n  const [filteredProducts, setFilteredProducts] = useState([]);\n  const [filterType, setFilterType] = useState('');\n  const [cart, setCart] = useState([]);\n  const [showCartModal, setShowCartModal] = useState(false);\n  const [showOrderForm, setShowOrderForm] = useState(false);\n  const [orderForm, setOrderForm] = useState({ address: '' });\n  const [selectedMedia, setSelectedMedia] = useState(null);\n  const [currentMediaIndex, setCurrentMediaIndex] = useState({});\n  const [currentMediaType, setCurrentMediaType] = useState({});\n  const [showAddedToCart, setShowAddedToCart] = useState(false);\n  const [error, setError] = useState('');\n  const [previousOrders, setPreviousOrders] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const intervalRefs = useRef({});\n  const navigate = useNavigate();\n\n  // إضافات جديدة للرسائل\n  const [orders, setOrders] = useState([]);\n  const [selectedOrderForMessages, setSelectedOrderForMessages] = useState(null);\n  const [newMessage, setNewMessage] = useState('');\n  const [newImage, setNewImage] = useState(null);\n  const [newImagePreview, setNewImagePreview] = useState(null);\n  const [showUnreadList, setShowUnreadList] = useState(false); // ليست منسدلة\n  const socketRef = useRef(null);\n  const currentOrderIdRef = useRef(null);\n  const messagesEndRef = useRef(null);\n\n  // Image preview effect\n  useEffect(() => {\n    if (newImage) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setNewImagePreview(reader.result);\n      };\n      reader.readAsDataURL(newImage);\n    } else {\n      setNewImagePreview(null);\n    }\n  }, [newImage]);\n\n  // Smooth scroll to bottom\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  // Socket authentication & connection management\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول');\n      navigate('/login');\n      return;\n    }\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      socketRef.current = io(process.env.REACT_APP_API_URL, { autoConnect: false });\n      const socket = socketRef.current;\n      socket.connect();\n      socket.emit('authenticate', { userId: payload.id, role: payload.role });\n      socket.on('connect', () => {\n        console.log('Socket connected successfully');\n        if (currentOrderIdRef.current) {\n          socket.emit('joinOrder', currentOrderIdRef.current);\n        }\n      });\n      socket.on('error', (err) => {\n        console.error('Socket.IO error:', err);\n        setError(`خطأ في الاتصال: ${err.message || 'غير معروف'}`);\n      });\n      socket.on('orderJoined', ({ orderId }) => {\n        console.log(`Successfully joined order room: ${orderId}`);\n      });\n      socket.on('disconnect', () => {\n        console.log('Socket disconnected');\n      });\n      return () => {\n        if (socket.connected) {\n          socket.disconnect();\n        }\n      };\n    } catch (e) {\n      console.error('Token decode error:', e);\n      setError('خطأ في التوثيق، يرجى تسجيل الدخول مرة أخرى');\n      localStorage.removeItem('token');\n      localStorage.removeItem('role');\n      localStorage.removeItem('userId');\n      navigate('/login');\n    }\n  }, [navigate]);\n\n  // Fetch unread messages/orders\n  const fetchUnreadOrders = () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول لجلب الطلبات');\n      navigate('/login');\n      return;\n    }\n    axios\n      .get(`${process.env.REACT_APP_API_URL}/api/orders?unreadOnly=true`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(res => {\n        setOrders(res.data.orders || []);\n        setError(null);\n      })\n      .catch(err => {\n        console.error('Fetch orders error:', err);\n        const errorMessage = err.response?.data?.message || 'خطأ في جلب الطلبات: ' + err.message;\n        setError(errorMessage);\n        if (err.response?.status === 401) {\n          setError('غير مصرح: يرجى تسجيل الدخول مرة أخرى');\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n  };\n\n  // Trigger fetch on mount\n  useEffect(() => {\n    fetchUnreadOrders();\n  }, []);\n\n  // Messages modal socket handling\n  useEffect(() => {\n    if (!selectedOrderForMessages || !socketRef.current) {\n      if (currentOrderIdRef.current && socketRef.current) {\n        socketRef.current.emit('leaveOrder', currentOrderIdRef.current);\n        currentOrderIdRef.current = null;\n      }\n      return;\n    }\n    const orderId = selectedOrderForMessages._id;\n    currentOrderIdRef.current = orderId;\n    socketRef.current.emit('joinOrder', orderId);\n    const token = localStorage.getItem('token');\n    axios\n      .post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${orderId}/markRead`,\n        {},\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      )\n      .then(res => {\n        setOrders(prevOrders =>\n          prevOrders.map(o => (o._id === orderId ? { ...o, unreadCount: 0 } : o))\n        );\n        setSelectedOrderForMessages(prev => ({\n          ...prev,\n          messages: res.data.order.messages || [],\n          unreadCount: 0,\n        }));\n        scrollToBottom();\n      })\n      .catch(err => {\n        console.error('Mark read error:', err);\n        setError('خطأ في تحديث حالة القراءة');\n      });\n    const handleNewMessage = (message) => {\n      if (message.orderId !== orderId) return;\n      setSelectedOrderForMessages(prev => {\n        const exists = prev.messages?.some(m => m._id === message._id);\n        if (exists) return prev;\n        return {\n          ...prev,\n          messages: [...(prev.messages || []), message],\n        };\n      });\n      if (message.from !== getUserRole()) {\n        setOrders(prevOrders =>\n          prevOrders.map(o =>\n            o._id === orderId\n              ? { ...o, unreadCount: (o.unreadCount || 0) + 1 }\n              : o\n          )\n        );\n      }\n      scrollToBottom();\n    };\n    const handleMessagesUpdated = (data) => {\n      if (data.orderId !== orderId) return;\n      setSelectedOrderForMessages(prev => ({\n        ...prev,\n        messages: data.messages || [],\n        unreadCount: data.messages.filter(msg => !msg.isRead && msg.from !== getUserRole()).length,\n      }));\n      scrollToBottom();\n    };\n    const handleUnreadUpdate = ({ orderId: updatedId, unreadCount }) => {\n      setOrders(prev =>\n        prev.map(o => (o._id === updatedId ? { ...o, unreadCount } : o))\n      );\n      if (updatedId === orderId) {\n        setSelectedOrderForMessages(prev => ({ ...prev, unreadCount }));\n      }\n    };\n    const socket = socketRef.current;\n    socket.on('newMessage', handleNewMessage);\n    socket.on('messagesUpdated', handleMessagesUpdated);\n    socket.on('unreadUpdate', handleUnreadUpdate);\n    scrollToBottom();\n    return () => {\n      socket.off('newMessage', handleNewMessage);\n      socket.off('messagesUpdated', handleMessagesUpdated);\n      socket.off('unreadUpdate', handleUnreadUpdate);\n      socket.emit('leaveOrder', orderId);\n      currentOrderIdRef.current = null;\n    };\n  }, [selectedOrderForMessages]);\n\n  // Send message handler\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setError('يرجى تسجيل الدخول');\n      navigate('/login');\n      return;\n    }\n    if (!newMessage.trim() && !newImage) {\n      setError('يجب إدخال رسالة أو رفع صورة');\n      return;\n    }\n    const formData = new FormData();\n    if (newMessage.trim()) formData.append('text', newMessage.trim());\n    if (newImage) formData.append('image', newImage);\n    try {\n      const res = await axios.post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${selectedOrderForMessages._id}/message`,\n        formData,\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data',\n          },\n        }\n      );\n      setSelectedOrderForMessages(prev => ({\n        ...prev,\n        messages: res.data.order.messages || [],\n      }));\n      setNewMessage('');\n      setNewImage(null);\n      setNewImagePreview(null);\n      setError(null);\n      scrollToBottom();\n    } catch (err) {\n      const errorMessage = err.response?.data?.message || 'خطأ في إرسال الرسالة';\n      setError(errorMessage);\n    }\n  };\n\n  // Messages modal open/close\n  const openMessages = (order) => {\n    setSelectedOrderForMessages(order);\n    setShowUnreadList(false);\n  };\n  const closeMessages = () => {\n    setSelectedOrderForMessages(null);\n    setNewMessage('');\n    setNewImage(null);\n    setNewImagePreview(null);\n  };\n\n  // User role getter\n  const getUserRole = () => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        return payload.role || 'user';\n      } catch (e) {\n        console.error('Error decoding token:', e);\n        setError('خطأ في فك تشفير التوكن، يرجى تسجيل الدخول مرة أخرى');\n        localStorage.removeItem('token');\n        localStorage.removeItem('role');\n        localStorage.removeItem('userId');\n        navigate('/login');\n        return 'user';\n      }\n    }\n    return 'user';\n  };\n  const userRole = getUserRole();\n\n  // فحص التوكن ودور المستخدم\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    const role = localStorage.getItem('role');\n    const userId = localStorage.getItem('userId');\n    if (!token || !['admin', 'vendor', 'customer'].includes(role)) {\n      setError('غير مصرح: يرجى تسجيل الدخول كأدمن، تاجر، أو عميل');\n      navigate('/login');\n      return;\n    }\n    // جلب المنتجات\n    axios\n      .get(`${process.env.REACT_APP_API_URL}/api/products`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(res => {\n        setProducts(res.data);\n        setFilteredProducts(res.data);\n        const initialIndexes = res.data.reduce((acc, product) => ({\n          ...acc,\n          [product._id]: 0\n        }), {});\n        const initialTypes = res.data.reduce((acc, product) => ({\n          ...acc,\n          [product._id]: product.videos && product.videos.length > 0 ? 'video' : 'image'\n        }), {});\n        setCurrentMediaIndex(initialIndexes);\n        setCurrentMediaType(initialTypes);\n        setError('');\n      })\n      .catch(err => {\n        console.error('خطأ في جلب المنتجات:', err);\n        setError(err.response?.data?.message || 'خطأ في جلب المنتجات');\n        if (err.response?.status === 401) {\n          localStorage.removeItem('token');\n          localStorage.removeItem('role');\n          localStorage.removeItem('userId');\n          navigate('/login');\n        }\n      });\n    // جلب السلة (للعملاء)\n    if (role === 'customer') {\n      const savedCart = localStorage.getItem('cart');\n      if (savedCart) setCart(JSON.parse(savedCart));\n    }\n    // جلب الطلبات السابقة\n    if (role === 'customer' && userId) {\n      axios\n        .get(`${process.env.REACT_APP_API_URL}/api/orders/user/${userId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        })\n        .then(res => setPreviousOrders(res.data))\n        .catch(err => console.error('خطأ في جلب الطلبات السابقة:', err));\n    }\n  }, [navigate]);\n\n  // تصفية المنتجات\n  useEffect(() => {\n    if (filterType === '') {\n      setFilteredProducts(products);\n    } else {\n      setFilteredProducts(products.filter(p => p.type === filterType));\n    }\n  }, [filterType, products]);\n\n  // تدوير الصور تلقائيًا\n  useEffect(() => {\n    products.forEach(product => {\n      const totalImages = product.images?.length || 0;\n      if (totalImages > 1 && (!product.videos || product.videos.length === 0)) {\n        clearInterval(intervalRefs.current[product._id]);\n        intervalRefs.current[product._id] = setInterval(() => {\n          setCurrentMediaIndex(prev => ({\n            ...prev,\n            [product._id]: (prev[product._id] + 1) % totalImages\n          }));\n          setCurrentMediaType(prev => ({ ...prev, [product._id]: 'image' }));\n        }, 3000);\n      }\n    });\n    return () => Object.values(intervalRefs.current).forEach(clearInterval);\n  }, [products]);\n\n  // حفظ السلة\n  useEffect(() => {\n    if (localStorage.getItem('role') === 'customer') {\n      localStorage.setItem('cart', JSON.stringify(cart));\n    }\n  }, [cart]);\n\n  const addToCart = (product) => {\n    const currentIndex = currentMediaIndex[product._id] || 0;\n    const currentType = currentMediaType[product._id] || 'image';\n    if (currentType === 'video') {\n      alert('يرجى اختيار صورة لإضافتها إلى السلة');\n      return;\n    }\n    const selectedImage = product.images[currentIndex - (product.videos?.length || 0)] || 'placeholder-image.jpg';\n    setCart(prev => {\n      const existing = prev.find(i => i.product._id === product._id && i.selectedImage === selectedImage);\n      if (existing) {\n        return prev.map(i =>\n          i.product._id === product._id && i.selectedImage === selectedImage\n            ? { ...i, quantity: i.quantity + 1 }\n            : i\n        );\n      }\n      return [...prev, { product, quantity: 1, selectedImage }];\n    });\n    setShowAddedToCart(true);\n    setTimeout(() => setShowAddedToCart(false), 2000);\n  };\n\n  const updateCartQuantity = (productId, selectedImage, qty) => {\n    if (qty < 1) return;\n    setCart(prev => prev.map(i =>\n      i.product._id === productId && i.selectedImage === selectedImage\n        ? { ...i, quantity: qty }\n        : i\n    ));\n  };\n\n  const removeFromCart = (productId, selectedImage) => {\n    setCart(prev => prev.filter(i => !(i.product._id === productId && i.selectedImage === selectedImage)));\n  };\n\n  const handleOrderSubmit = () => {\n    if (isSubmitting || !orderForm.address) return;\n    const token = localStorage.getItem('token');\n    const userId = localStorage.getItem('userId');\n    if (!token || !userId) return navigate('/login');\n    let confirmSubmit = true;\n    if (previousOrders.length > 0) {\n      confirmSubmit = window.confirm('أنت طلبت الطلب مرة، هل تريد تأكيد طلبه مرة أخرى؟');\n    }\n    if (!confirmSubmit) return;\n    setIsSubmitting(true);\n    const promises = cart.map(item =>\n      axios.post(\n        `${process.env.REACT_APP_API_URL}/api/orders`,\n        {\n          product: item.product._id,\n          vendor: item.product.vendor._id || item.product.vendor,\n          quantity: item.quantity,\n          user: userId,\n          address: orderForm.address,\n          selectedImage: item.selectedImage\n        },\n        { headers: { Authorization: `Bearer ${token}` } }\n      )\n    );\n    Promise.all(promises)\n      .then(() => {\n        alert('تم إنشاء الطلبات بنجاح!');\n        setCart([]);\n        setShowOrderForm(false);\n        setOrderForm({ address: '' });\n        axios.get(`${process.env.REACT_APP_API_URL}/api/orders/user/${userId}`, {\n          headers: { Authorization: `Bearer ${token}` }\n        }).then(res => setPreviousOrders(res.data));\n      })\n      .catch(err => {\n        setError(err.response?.data?.message || 'خطأ في تقديم الطلب');\n        if (err.response?.status === 401) {\n          localStorage.clear();\n          navigate('/login');\n        }\n      })\n      .finally(() => setIsSubmitting(false));\n  };\n\n  const openMedia = (media, type) => {\n    setSelectedMedia({ url: `${process.env.REACT_APP_API_URL}/uploads/${media}`, type });\n  };\n  const closeMedia = () => setSelectedMedia(null);\n\n  const handlePrevMedia = (id, p) => {\n    const total = (p.videos?.length || 0) + (p.images?.length || 0);\n    setCurrentMediaIndex(prev => {\n      const next = (prev[id] - 1 + total) % total;\n      setCurrentMediaType(t => ({ ...t, [id]: next < (p.videos?.length || 0) ? 'video' : 'image' }));\n      return { ...prev, [id]: next };\n    });\n    clearInterval(intervalRefs.current[id]);\n  };\n\n  const handleNextMedia = (id, p) => {\n    const total = (p.videos?.length || 0) + (p.images?.length || 0);\n    setCurrentMediaIndex(prev => {\n      const next = (prev[id] + 1) % total;\n      setCurrentMediaType(t => ({ ...t, [id]: next < (p.videos?.length || 0) ? 'video' : 'image' }));\n      return { ...prev, [id]: next };\n    });\n    clearInterval(intervalRefs.current[id]);\n  };\n\n  // === الأنيميشن ===\n  const cardVariants = {\n    hidden: { opacity: 0, y: 30, scale: 0.95 },\n    visible: { opacity: 1, y: 0, scale: 1, transition: { duration: 0.7, ease: [0.22, 1, 0.36, 1] } },\n    hover: { scale: 1.03, boxShadow: '0 12px 24px rgba(0, 0, 0, 0.2)', transition: { duration: 0.2 } }\n  };\n  const buttonVariants = {\n    hover: { scale: 1.05, boxShadow: '0 8px 16px rgba(239, 68, 68, 0.3)' },\n    tap: { scale: 0.95 }\n  };\n  const modalVariants = { hidden: { opacity: 0, scale: 0.85 }, visible: { opacity: 1, scale: 1 } };\n  const toastVariants = { hidden: { opacity: 0, x: 50 }, visible: { opacity: 1, x: 0 } };\n  const listVariants = { hidden: { opacity: 0, y: -10 }, visible: { opacity: 1, y: 0 }, exit: { opacity: 0, y: -10 } };\n\n  const role = localStorage.getItem('role');\n  const isCustomer = role === 'customer';\n  const totalUnread = orders.reduce((acc, o) => acc + (o.unreadCount || 0), 0);\n\n  return (\n    <div\n      className=\"min-h-screen bg-[#18191a] text-white p-4 relative overflow-hidden\"\n    >\n      <div className=\"relative z-10 w-full max-w-7xl mx-auto\">\n\n        {/* === اللوجو + العنوان === */}\n        <motion.div\n          className=\"flex flex-col items-center mb-8\"\n          initial={{ opacity: 0, y: -30 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.8 }}\n        >\n          <h1 className=\"text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mt-3\">\n            متجر SHOSE NET\n          </h1>\n          <p className=\"text-red-300 text-lg mt-1\">المنتجات المتاحة</p>\n        </motion.div>\n\n        {/* === الفلتر + السلة + الرسائل === */}\n        <div className=\"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4\">\n          <motion.select\n            value={filterType}\n            onChange={e => setFilterType(e.target.value)}\n            className=\"p-3 rounded-xl bg-slate-800/60 backdrop-blur-md border border-slate-600 text-white focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\"\n            whileHover={{ scale: 1.03 }}\n          >\n            <option value=\"\">الكل</option>\n            <option value=\"رجالي\">رجالي</option>\n            <option value=\"حريمي\">حريمي</option>\n            <option value=\"أطفال\">أطفال</option>\n          </motion.select>\n\n          {isCustomer && (\n            <motion.button\n              onClick={() => setShowCartModal(true)}\n              className=\"px-6 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-700 shadow-lg hover:from-red-700 hover:to-red-800\"\n              variants={buttonVariants}\n              whileHover=\"hover\"\n              whileTap=\"tap\"\n            >\n              السلة ({cart.reduce((a, i) => a + i.quantity, 0)})\n            </motion.button>\n          )}\n\n          {(userRole === 'customer' || userRole === 'vendor') && totalUnread > 0 && (\n            <div className=\"relative\">\n              <motion.button\n                onClick={() => setShowUnreadList(prev => !prev)}\n                className=\"px-6 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-blue-700 shadow-lg hover:from-blue-700 hover:to-blue-800 flex items-center gap-2\"\n                variants={buttonVariants}\n                whileHover=\"hover\"\n                whileTap=\"tap\"\n              >\n                الرسائل غير المقروءة ({totalUnread})\n                <span className={`transition-transform duration-200 ${showUnreadList ? 'rotate-180' : ''}`}>Down Arrow</span>\n              </motion.button>\n\n              <AnimatePresence>\n                {showUnreadList && (\n                  <motion.div\n                    variants={listVariants}\n                    initial=\"hidden\"\n                    animate=\"visible\"\n                    exit=\"exit\"\n                    className=\"absolute top-full mt-2 w-72 bg-[#242526] backdrop-blur-xl rounded-xl shadow-2xl border border-gray-700 z-50 max-h-64 overflow-y-auto\"\n                  >\n                    {orders.map(order => (\n                      <div\n                        key={order._id}\n                        onClick={() => openMessages(order)}\n                        className=\"p-4 border-b border-gray-700 hover:bg-gray-800/60 cursor-pointer transition-colors duration-200\"\n                      >\n                        <p className=\"font-bold text-red-400\">طلب #{order.orderNumber}</p>\n                        <p className=\"text-sm text-gray-300\">المنتج: {order.product?.name}</p>\n                        <p className=\"text-xs text-red-400 mt-1\">غير مقروء: {order.unreadCount}</p>\n                      </div>\n                    ))}\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n          )}\n        </div>\n\n        {/* === المنتجات === */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n          {filteredProducts.length === 0 ? (\n            <p className=\"col-span-full text-center text-slate-400 text-xl\">لا توجد منتجات...</p>\n          ) : (\n            filteredProducts.map(product => (\n              <motion.div\n                key={product._id}\n                className=\"bg-slate-900/60 backdrop-blur-xl rounded-2xl shadow-2xl border border-slate-700/50 overflow-hidden\"\n                variants={cardVariants}\n                initial=\"hidden\"\n                whileInView=\"visible\"\n                viewport={{ once: true }}\n                whileHover=\"hover\"\n              >\n                <div className=\"relative aspect-[4/3] bg-slate-800\">\n                  {currentMediaType[product._id] === 'video' && product.videos?.length > 0 ? (\n                    <video\n                      src={`${process.env.REACT_APP_API_URL}/uploads/${product.videos[currentMediaIndex[product._id]]}`}\n                      controls\n                      className=\"w-full h-full object-cover\"\n                      onClick={() => openMedia(product.videos[currentMediaIndex[product._id]], 'video')}\n                    />\n                  ) : product.images?.length > 0 ? (\n                    <img\n                      src={`${process.env.REACT_APP_API_URL}/uploads/${product.images[(currentMediaIndex[product._id] || 0) - (product.videos?.length || 0)]}`}\n                      alt={product.name}\n                      className=\"w-full h-full object-cover\"\n                      onClick={() => openMedia(product.images[(currentMediaIndex[product._id] || 0) - (product.videos?.length || 0)], 'image')}\n                    />\n                  ) : (\n                    <div className=\"w-full h-full bg-slate-700 flex items-center justify-center\">\n                      <span className=\"text-slate-500\">بدون صورة</span>\n                    </div>\n                  )}\n                  {/* أزرار التنقل */}\n                  {(product.videos?.length || 0) + (product.images?.length || 0) > 1 && (\n                    <div className=\"absolute inset-x-0 bottom-3 flex justify-center gap-3\">\n                      <button onClick={() => handlePrevMedia(product._id, product)} className=\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\">Left Arrow</button>\n                      <button onClick={() => handleNextMedia(product._id, product)} className=\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\">Right Arrow</button>\n                    </div>\n                  )}\n                </div>\n                <div className=\"p-5 space-y-2 text-right\">\n                  <h2 className=\"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600\">\n                    {product.name}\n                  </h2>\n                  <div className=\"text-sm text-slate-300 space-y-1\">\n                    <p>التاجر: <Link to={`/vendors/${product.vendor?._id}/products`} className=\"text-red-400 hover:text-red-300\">{product.vendor?.name}</Link></p>\n                    <p>النوع: {product.type}</p>\n                    <p>سعر الكرتونة: {product.price} جنيه</p>\n                    <p>سعر الجوز: {(product.price / product.quantityPerCarton).toFixed(2)} جنيه</p>\n                    <p>الكرتونة: {product.quantityPerCarton} جوز</p>\n                    <p>المصنع: {product.manufacturer}</p>\n                  </div>\n                  {isCustomer && (\n                    <motion.button\n                      onClick={() => addToCart(product)}\n                      className=\"w-full mt-4 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-lg\"\n                      variants={buttonVariants}\n                      whileHover=\"hover\"\n                      whileTap=\"tap\"\n                    >\n                      إضافة إلى السلة\n                    </motion.button>\n                  )}\n                </div>\n              </motion.div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* === Toast === */}\n      <AnimatePresence>\n        {showAddedToCart && (\n          <motion.div\n            className=\"fixed top-6 right-6 bg-green-600 text-white px-5 py-3 rounded-full shadow-xl flex items-center gap-2 z-50\"\n            variants={toastVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n            exit=\"hidden\"\n          >\n            <span>تمت الإضافة</span>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* === مودال السلة + الطلب + الصورة === */}\n      {/* Cart Modal */}\n      <AnimatePresence>\n        {showCartModal && isCustomer && (\n          <motion.div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"hidden\" onClick={() => setShowCartModal(false)}>\n            <motion.div className=\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-lg\" onClick={e => e.stopPropagation()}>\n              <h2 className=\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\">السلة</h2>\n              {cart.length === 0 ? <p className=\"text-center text-slate-400\">السلة فارغة</p> : (\n                <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                  {cart.map(item => (\n                    <div key={`${item.product._id}-${item.selectedImage}`} className=\"flex items-center justify-between gap-4 p-3 bg-slate-800/50 rounded-xl\">\n                      <img src={`${process.env.REACT_APP_API_URL}/uploads/${item.selectedImage}`} alt=\"\" className=\"w-16 h-16 object-cover rounded-lg\" />\n                      <div className=\"text-right flex-1\">\n                        <p className=\"font-semibold\">{item.product.name}</p>\n                        <p className=\"text-sm text-slate-400\">سعر الكرتونة: {item.product.price} جنيه</p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <input type=\"number\" min=\"1\" value={item.quantity} onChange={e => updateCartQuantity(item.product._id, item.selectedImage, parseInt(e.target.value))} className=\"w-16 p-2 bg-slate-700 rounded text-center\" />\n                        <button onClick={() => removeFromCart(item.product._id, item.selectedImage)} className=\"text-red-400 hover:text-red-300\">×</button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n              {cart.length > 0 && (\n                <div className=\"flex gap-3 mt-6\">\n                  <button onClick={() => { setShowCartModal(false); setShowOrderForm(true); }} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-green-600 to-green-700 text-white font-bold\">طلب</button>\n                  <button onClick={() => setShowCartModal(false)} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold\">إغلاق</button>\n                </div>\n              )}\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Order Modal */}\n      <AnimatePresence>\n        {showOrderForm && isCustomer && (\n          <motion.div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"hidden\" onClick={() => setShowOrderForm(false)}>\n            <motion.div className=\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-md\" onClick={e => e.stopPropagation()}>\n              <h2 className=\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\">إدخال العنوان</h2>\n              <input type=\"text\" placeholder=\"العنوان\" value={orderForm.address} onChange={e => setOrderForm({ address: e.target.value })} className=\"w-full p-4 mb-6 bg-slate-800/60 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\" />\n              <div className=\"flex gap-3\">\n                <button onClick={handleOrderSubmit} disabled={isSubmitting} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-green-600 to-green-700 text-white font-bold disabled:opacity-70\">\n                  {isSubmitting ? 'جاري...' : 'إرسال'}\n                </button>\n                <button onClick={() => setShowOrderForm(false)} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold\">إلغاء</button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Media Modal */}\n      <AnimatePresence>\n        {selectedMedia && (\n          <motion.div className=\"fixed inset-0 bg-black/90 flex items-center justify-center z-50\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"hidden\" onClick={closeMedia}>\n            <motion.div className=\"relative max-w-4xl max-h-screen p-4\" onClick={e => e.stopPropagation()}>\n              {selectedMedia.type === 'image' ? (\n                <img src={selectedMedia.url} alt=\"\" className=\"max-w-full max-h-screen rounded-2xl shadow-2xl\" />\n              ) : (\n                <video src={selectedMedia.url} controls autoPlay className=\"max-w-full max-h-screen rounded-2xl shadow-2xl\" />\n              )}\n              <button onClick={closeMedia} className=\"absolute top-4 right-4 bg-red-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg hover:bg-red-700\">×</button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Messages Modal */}\n      <AnimatePresence>\n        {selectedOrderForMessages && (\n          <motion.div\n            className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\n            variants={modalVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n            exit=\"exit\"\n            onClick={closeMessages}\n          >\n            <motion.div\n              className=\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <h2 className=\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700\">\n                الرسائل للطلب #{selectedOrderForMessages.orderNumber}\n              </h2>\n              <div className=\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\">\n                {selectedOrderForMessages.messages && selectedOrderForMessages.messages.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {selectedOrderForMessages.messages.map((msg, index) => {\n                      const isMyMessage = msg.from === userRole;\n                      const senderName = msg.from === 'vendor' ? selectedOrderForMessages.product?.vendor?.name : selectedOrderForMessages.user?.name || 'غير معروف';\n                      return (\n                        <div\n                          key={msg._id || index}\n                          className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}\n                        >\n                          <div\n                            className={`max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md ${\n                              isMyMessage ? 'bg-gradient-to-r from-red-600 to-red-800 text-white' : 'bg-gray-700 text-white'\n                            }`}\n                          >\n                            <p className=\"font-bold text-sm opacity-90\">\n                              {msg.from === 'vendor' ? 'التاجر' : 'العميل'}: {senderName}\n                            </p>\n                            {msg.text && <p className=\"mt-2 text-lg\">{msg.text}</p>}\n                            {msg.image && (\n                              <img\n                                src={`${process.env.REACT_APP_API_URL}/Uploads/${msg.image}`}\n                                alt=\"صورة الرسالة\"\n                                className=\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  openMedia(msg.image, 'image');\n                                }}\n                                onError={(e) => {\n                                  e.target.onerror = null;\n                                  e.target.src = `${process.env.REACT_APP_API_URL}/Uploads/placeholder-image.jpg`;\n                                }}\n                              />\n                            )}\n                            <div className=\"flex items-center justify-between mt-3 text-xs opacity-70\">\n                              <p>{new Date(msg.timestamp).toLocaleString('ar-EG')}</p>\n                              {isMyMessage && (\n                                <span>\n                                  {msg.isRead ? 'Seen' : msg.isDelivered ? 'Delivered' : 'Sent'}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-gray-400 text-lg\">لا توجد رسائل بعد.</p>\n                )}\n                <div ref={messagesEndRef} />\n              </div>\n              {(userRole === 'vendor' || userRole === 'customer') && (\n                <form onSubmit={handleSendMessage} className=\"space-y-4\">\n                  <textarea\n                    placeholder=\"اكتب رسالتك هنا...\"\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\"\n                    rows=\"4\"\n                  />\n                  <div className=\"flex items-center gap-4\">\n                    <input\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={(e) => setNewImage(e.target.files[0] || null)}\n                      className=\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\"\n                    />\n                    {newImagePreview && (\n                      <div className=\"relative\">\n                        <img src={newImagePreview} alt=\"معاينة\" className=\"w-24 h-24 object-cover rounded-xl shadow-lg\" />\n                        <button\n                          type=\"button\"\n                          onClick={() => {\n                            setNewImage(null);\n                            setNewImagePreview(null);\n                          }}\n                          className=\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\"\n                        >\n                          ×\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                  <motion.button\n                    type=\"submit\"\n                    className=\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\"\n                    variants={buttonVariants}\n                    whileHover=\"hover\"\n                    whileTap=\"tap\"\n                  >\n                    إرسال الرسالة\n                  </motion.button>\n                </form>\n              )}\n              <motion.button\n                onClick={closeMessages}\n                className=\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\"\n                variants={buttonVariants}\n                whileHover=\"hover\"\n                whileTap=\"tap\"\n              >\n                إغلاق\n              </motion.button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\nexport default Home;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}