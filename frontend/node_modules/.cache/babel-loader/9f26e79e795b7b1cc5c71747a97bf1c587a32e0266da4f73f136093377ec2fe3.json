{"ast":null,"code":"import _objectSpread from\"/root/shose/app-shose/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// frontend/src/pages/VendorProducts.js\nimport{useState,useEffect,useRef,useCallback}from'react';import{motion,AnimatePresence}from'framer-motion';import{useParams,Link,useNavigate}from'react-router-dom';import axios from'axios';import{io}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const VendorProducts=()=>{const{vendorId}=useParams();const[products,setProducts]=useState([]);const[filteredProducts,setFilteredProducts]=useState([]);const[filterType,setFilterType]=useState('');const[priceRange,setPriceRange]=useState({min:'',max:''});const[vendorName,setVendorName]=useState('');const[cart,setCart]=useState([]);const[showCartModal,setShowCartModal]=useState(false);const[showOrderForm,setShowOrderForm]=useState(false);const[orderForm,setOrderForm]=useState({address:''});const[selectedMedia,setSelectedMedia]=useState(null);const[currentMediaIndex,setCurrentMediaIndex]=useState({});const[currentMediaType,setCurrentMediaType]=useState({});const[showAddedToCart,setShowAddedToCart]=useState(false);const[error,setError]=useState('');const[previousOrders,setPreviousOrders]=useState([]);const[isSubmitting,setIsSubmitting]=useState(false);const intervalRefs=useRef({});const navigate=useNavigate();// === إضافات الشات (مطابقة Home.js) ===\nconst[orders,setOrders]=useState([]);const[selectedOrderForMessages,setSelectedOrderForMessages]=useState(null);const[newMessage,setNewMessage]=useState('');const[newImage,setNewImage]=useState(null);const[newImagePreview,setNewImagePreview]=useState(null);const[isChatManuallyOpened,setIsChatManuallyOpened]=useState(false);const[showFloatingChatButton,setShowFloatingChatButton]=useState(true);const socketRef=useRef(null);const currentOrderIdRef=useRef(null);const chatContainerRef=useRef(null);const isFirstOpenRef=useRef(true);// Image preview effect\nuseEffect(()=>{if(newImage){const reader=new FileReader();reader.onloadend=()=>setNewImagePreview(reader.result);reader.readAsDataURL(newImage);}else{setNewImagePreview(null);}},[newImage]);// Scroll to bottom\nconst scrollToBottom=useCallback(()=>{if(chatContainerRef.current){chatContainerRef.current.scrollTop=chatContainerRef.current.scrollHeight;}},[]);// Reset first open flag when chat closes\nuseEffect(()=>{if(!isChatManuallyOpened)isFirstOpenRef.current=true;},[isChatManuallyOpened]);// === جلب المنتجات ===\nconst fetchProducts=useCallback(()=>{const token=localStorage.getItem('token');if(!token)return;axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/products/vendor/\").concat(vendorId),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{var _sortedProducts$,_sortedProducts$$vend;const approvedProducts=res.data.filter(p=>p.approved);const sortedProducts=[...approvedProducts].sort((a,b)=>new Date(b.updatedAt)-new Date(a.updatedAt));setProducts(sortedProducts);setFilteredProducts(sortedProducts);setVendorName(((_sortedProducts$=sortedProducts[0])===null||_sortedProducts$===void 0?void 0:(_sortedProducts$$vend=_sortedProducts$.vendor)===null||_sortedProducts$$vend===void 0?void 0:_sortedProducts$$vend.name)||'تاجر غير معروف');const initialIndexes={};const initialTypes={};sortedProducts.forEach(p=>{initialIndexes[p._id]=0;const hasVideos=p.videos&&p.videos.length>0;initialTypes[p._id]=hasVideos?'video':'image';});setCurrentMediaIndex(initialIndexes);setCurrentMediaType(initialTypes);setError('');}).catch(err=>{var _err$response;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){localStorage.clear();navigate('/login');}});},[vendorId,navigate]);// === جلب المنتجات + السلة + الطلبات السابقة ===\nuseEffect(()=>{const token=localStorage.getItem('token');const role=localStorage.getItem('role');const userId=localStorage.getItem('userId');if(!token||!['admin','vendor','customer'].includes(role)){setError('غير مصرح: يرجى تسجيل الدخول');navigate('/login');return;}fetchProducts();if(role==='customer'){const savedCart=localStorage.getItem('cart');if(savedCart)setCart(JSON.parse(savedCart));}if(role==='customer'&&userId){axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/user/\").concat(userId),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>setPreviousOrders(res.data)).catch(()=>{});}},[navigate,fetchProducts]);// === Socket.IO Authentication & Real-time Updates ===\nuseEffect(()=>{const token=localStorage.getItem('token');if(!token)return;try{const payload=JSON.parse(atob(token.split('.')[1]));socketRef.current=io(process.env.REACT_APP_API_URL,{autoConnect:false});const socket=socketRef.current;socket.connect();socket.emit('authenticate',{userId:payload.id,role:payload.role});socket.on('connect',()=>{console.log('Socket connected in VendorProducts');fetchProducts();if(currentOrderIdRef.current){socket.emit('joinOrder',currentOrderIdRef.current);}});socket.on('productUpdated',updatedProduct=>{if(updatedProduct.vendor._id!==vendorId&&updatedProduct.vendor!==vendorId)return;setProducts(prev=>{const exists=prev.some(p=>p._id===updatedProduct._id);const newList=exists?prev.map(p=>p._id===updatedProduct._id?updatedProduct:p):[updatedProduct,...prev];return newList.sort((a,b)=>new Date(b.updatedAt)-new Date(a.updatedAt));});setFilteredProducts(prev=>{const exists=prev.some(p=>p._id===updatedProduct._id);const newList=exists?prev.map(p=>p._id===updatedProduct._id?updatedProduct:p):[updatedProduct,...prev];let filtered=newList.filter(p=>p.approved&&(p.vendor._id===vendorId||p.vendor===vendorId));if(filterType)filtered=filtered.filter(p=>p.type===filterType);if(priceRange.min||priceRange.max){const min=parseFloat(priceRange.min)||0;const max=parseFloat(priceRange.max)||Infinity;filtered=filtered.filter(p=>{const pairPrice=p.price/p.quantityPerCarton;return pairPrice>=min&&pairPrice<=max;});}return filtered.sort((a,b)=>new Date(b.updatedAt)-new Date(a.updatedAt));});});socket.on('productDeleted',_ref=>{let{_id}=_ref;setProducts(prev=>prev.filter(p=>p._id!==_id));setFilteredProducts(prev=>prev.filter(p=>p._id!==_id));});return()=>{if(socket.connected)socket.disconnect();};}catch(e){localStorage.clear();navigate('/login');}},[navigate,vendorId,fetchProducts,filterType,priceRange]);// === جلب الطلبات التي بها رسائل غير مقروءة ===\nconst fetchUnreadOrders=useCallback(()=>{const token=localStorage.getItem('token');if(!token)return;axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders?unreadOnly=true\"),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{setOrders(res.data.orders||[]);}).catch(err=>{var _err$response2;if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){localStorage.clear();navigate('/login');}});},[navigate]);useEffect(()=>{fetchUnreadOrders();},[fetchUnreadOrders]);// === Global Socket Listeners for Messages ===\nuseEffect(()=>{const socket=socketRef.current;if(!socket)return;const userRole=getUserRole();const handleNewMessage=message=>{const orderId=message.orderId;if(message.from!==userRole){setOrders(prev=>prev.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount:(o.unreadCount||0)+1}):o));}if(isChatManuallyOpened&&(selectedOrderForMessages===null||selectedOrderForMessages===void 0?void 0:selectedOrderForMessages._id)===orderId){setSelectedOrderForMessages(prev=>{var _prev$messages;const exists=(_prev$messages=prev.messages)===null||_prev$messages===void 0?void 0:_prev$messages.some(m=>m._id===message._id);if(exists)return prev;return _objectSpread(_objectSpread({},prev),{},{messages:[...(prev.messages||[]),message]});});setTimeout(scrollToBottom,100);}if(!isChatManuallyOpened&&message.from!==userRole){setShowFloatingChatButton(true);}};const handleMessagesUpdated=data=>{const{orderId,messages}=data;const unreadCount=messages.filter(msg=>!msg.isRead&&msg.from!==userRole).length;setOrders(prev=>prev.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount,messages}):o));if(isChatManuallyOpened&&(selectedOrderForMessages===null||selectedOrderForMessages===void 0?void 0:selectedOrderForMessages._id)===orderId){setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:messages||[],unreadCount}));setTimeout(scrollToBottom,100);}};const handleUnreadUpdate=_ref2=>{let{orderId,unreadCount}=_ref2;setOrders(prev=>prev.map(o=>o._id===orderId?_objectSpread(_objectSpread({},o),{},{unreadCount}):o));if((selectedOrderForMessages===null||selectedOrderForMessages===void 0?void 0:selectedOrderForMessages._id)===orderId){setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{unreadCount}));}if(unreadCount>0&&!isChatManuallyOpened){setShowFloatingChatButton(true);}};socket.on('newMessage',handleNewMessage);socket.on('messagesUpdated',handleMessagesUpdated);socket.on('unreadUpdate',handleUnreadUpdate);return()=>{socket.off('newMessage',handleNewMessage);socket.off('messagesUpdated',handleMessagesUpdated);socket.off('unreadUpdate',handleUnreadUpdate);};},[isChatManuallyOpened,selectedOrderForMessages,scrollToBottom]);// === Chat-specific Socket Handling ===\nuseEffect(()=>{if(!isChatManuallyOpened||!selectedOrderForMessages||!socketRef.current){if(currentOrderIdRef.current&&socketRef.current){socketRef.current.emit('leaveOrder',currentOrderIdRef.current);currentOrderIdRef.current=null;}return;}const orderId=selectedOrderForMessages._id;currentOrderIdRef.current=orderId;socketRef.current.emit('joinOrder',orderId);const token=localStorage.getItem('token');axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(orderId,\"/markRead\"),{},{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>{const updatedOrder=res.data.order;setOrders(prev=>prev.map(o=>o._id===orderId?updatedOrder:o));setSelectedOrderForMessages(_objectSpread(_objectSpread({},updatedOrder),{},{messages:updatedOrder.messages||[],unreadCount:0}));}).catch(console.error);if(isFirstOpenRef.current){setTimeout(scrollToBottom,100);isFirstOpenRef.current=false;}return()=>{socketRef.current.emit('leaveOrder',orderId);currentOrderIdRef.current=null;};},[isChatManuallyOpened,selectedOrderForMessages,scrollToBottom]);// === Send Message ===\nconst handleSendMessage=async e=>{e.preventDefault();e.stopPropagation();const token=localStorage.getItem('token');if(!token||!newMessage.trim()&&!newImage)return;const formData=new FormData();if(newMessage.trim())formData.append('text',newMessage.trim());if(newImage)formData.append('image',newImage);try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/\").concat(selectedOrderForMessages._id,\"/message\"),formData,{headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'multipart/form-data'}});setSelectedOrderForMessages(prev=>_objectSpread(_objectSpread({},prev),{},{messages:res.data.order.messages||[]}));setNewMessage('');setNewImage(null);setNewImagePreview(null);setTimeout(scrollToBottom,100);}catch(err){var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'خطأ في إرسال الرسالة');}};// === Open / Close Messages ===\nconst openMessages=order=>{if(order.isGrouped){alert('الشات متاح فقط للطلبات الفردية');return;}const originalOrder=orders.find(o=>o._id===order._id);if(!originalOrder)return;setSelectedOrderForMessages(_objectSpread(_objectSpread({},originalOrder),{},{messages:originalOrder.messages||[],unreadCount:originalOrder.unreadCount||0}));setShowFloatingChatButton(false);setIsChatManuallyOpened(true);isFirstOpenRef.current=true;};const closeMessages=()=>{setSelectedOrderForMessages(null);setNewMessage('');setNewImage(null);setNewImagePreview(null);setShowFloatingChatButton(true);setIsChatManuallyOpened(false);};// === User Role ===\nconst getUserRole=()=>{const token=localStorage.getItem('token');if(token){try{const payload=JSON.parse(atob(token.split('.')[1]));return payload.role||'user';}catch(e){localStorage.clear();navigate('/login');return'user';}}return'user';};const userRole=getUserRole();// === تصفية المنتجات ===\nuseEffect(()=>{let filtered=products.filter(p=>p.vendor._id===vendorId||p.vendor===vendorId);if(filterType)filtered=filtered.filter(p=>p.type===filterType);if(priceRange.min||priceRange.max){const min=parseFloat(priceRange.min)||0;const max=parseFloat(priceRange.max)||Infinity;filtered=filtered.filter(p=>{const pairPrice=p.price/p.quantityPerCarton;return pairPrice>=min&&pairPrice<=max;});}setFilteredProducts(filtered.sort((a,b)=>new Date(b.updatedAt)-new Date(a.updatedAt)));},[filterType,priceRange,products,vendorId]);// === تدوير الصور تلقائيًا (للصور فقط) ===\nuseEffect(()=>{products.forEach(product=>{const images=product.images||[];const videos=product.videos||[];if(images.length>1&&videos.length===0){clearInterval(intervalRefs.current[product._id]);intervalRefs.current[product._id]=setInterval(()=>{setCurrentMediaIndex(prev=>{const current=prev[product._id]||0;const next=(current+1)%images.length;return _objectSpread(_objectSpread({},prev),{},{[product._id]:next});});},3000);}});return()=>Object.values(intervalRefs.current).forEach(clearInterval);},[products]);// === حفظ السلة ===\nuseEffect(()=>{if(localStorage.getItem('role')==='customer'){localStorage.setItem('cart',JSON.stringify(cart));}},[cart]);// === إضافة إلى السلة ===\nconst addToCart=product=>{var _product$videos;const currentType=currentMediaType[product._id]||'image';if(currentType==='video'){alert('يرجى اختيار صورة لإضافتها إلى السلة');return;}const videosLength=((_product$videos=product.videos)===null||_product$videos===void 0?void 0:_product$videos.length)||0;const imgIndex=(currentMediaIndex[product._id]||0)-videosLength;const selectedImage=product.images[imgIndex]||'placeholder-image.jpg';setCart(prev=>{const existing=prev.find(i=>i.product._id===product._id&&i.selectedImage===selectedImage);if(existing){return prev.map(i=>i.product._id===product._id&&i.selectedImage===selectedImage?_objectSpread(_objectSpread({},i),{},{quantity:i.quantity+1}):i);}return[...prev,{product,quantity:1,selectedImage}];});setShowAddedToCart(true);setTimeout(()=>setShowAddedToCart(false),2000);};const updateCartQuantity=(productId,selectedImage,qty)=>{if(qty<1)return;setCart(prev=>prev.map(i=>i.product._id===productId&&i.selectedImage===selectedImage?_objectSpread(_objectSpread({},i),{},{quantity:qty}):i));};const removeFromCart=(productId,selectedImage)=>{setCart(prev=>prev.filter(i=>!(i.product._id===productId&&i.selectedImage===selectedImage)));};// === تقديم الطلب ===\nconst handleOrderSubmit=()=>{if(isSubmitting||!orderForm.address)return;const token=localStorage.getItem('token');const userId=localStorage.getItem('userId');if(!token||!userId)return navigate('/login');let confirmSubmit=true;if(previousOrders.length>0){confirmSubmit=window.confirm('أنت طلبت الطلب مرة، هل تريد تأكيد طلبه مرة أخرى؟');}if(!confirmSubmit)return;setIsSubmitting(true);const promises=cart.map(item=>axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders\"),{product:item.product._id,vendor:item.product.vendor._id||item.product.vendor,quantity:item.quantity,user:userId,address:orderForm.address,selectedImage:item.selectedImage},{headers:{Authorization:\"Bearer \".concat(token)}}));Promise.all(promises).then(()=>{alert('تم إنشاء الطلبات بنجاح!');setCart([]);setShowOrderForm(false);setOrderForm({address:''});axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/orders/user/\").concat(userId),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>setPreviousOrders(res.data));}).catch(err=>{var _err$response4,_err$response4$data,_err$response5;setError(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.message)||'خطأ في تقديم الطلب');if(((_err$response5=err.response)===null||_err$response5===void 0?void 0:_err$response5.status)===401){localStorage.clear();navigate('/login');}}).finally(()=>setIsSubmitting(false));};// === Media Viewer ===\nconst openMedia=(media,type)=>setSelectedMedia({url:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(media),type});const closeMedia=()=>setSelectedMedia(null);const handlePrevMedia=(id,p)=>{var _p$videos,_p$images;const total=(((_p$videos=p.videos)===null||_p$videos===void 0?void 0:_p$videos.length)||0)+(((_p$images=p.images)===null||_p$images===void 0?void 0:_p$images.length)||0);setCurrentMediaIndex(prev=>{const next=(prev[id]-1+total)%total;setCurrentMediaType(t=>{var _p$videos2;return _objectSpread(_objectSpread({},t),{},{[id]:next<(((_p$videos2=p.videos)===null||_p$videos2===void 0?void 0:_p$videos2.length)||0)?'video':'image'});});return _objectSpread(_objectSpread({},prev),{},{[id]:next});});clearInterval(intervalRefs.current[id]);};const handleNextMedia=(id,p)=>{var _p$videos3,_p$images2;const total=(((_p$videos3=p.videos)===null||_p$videos3===void 0?void 0:_p$videos3.length)||0)+(((_p$images2=p.images)===null||_p$images2===void 0?void 0:_p$images2.length)||0);setCurrentMediaIndex(prev=>{const next=(prev[id]+1)%total;setCurrentMediaType(t=>{var _p$videos4;return _objectSpread(_objectSpread({},t),{},{[id]:next<(((_p$videos4=p.videos)===null||_p$videos4===void 0?void 0:_p$videos4.length)||0)?'video':'image'});});return _objectSpread(_objectSpread({},prev),{},{[id]:next});});clearInterval(intervalRefs.current[id]);};const selectMediaIndex=(productId,index)=>{setCurrentMediaIndex(prev=>_objectSpread(_objectSpread({},prev),{},{[productId]:index}));setCurrentMediaType(prev=>{var _products$find,_products$find$videos;return _objectSpread(_objectSpread({},prev),{},{[productId]:index<(((_products$find=products.find(p=>p._id===productId))===null||_products$find===void 0?void 0:(_products$find$videos=_products$find.videos)===null||_products$find$videos===void 0?void 0:_products$find$videos.length)||0)?'video':'image'});});clearInterval(intervalRefs.current[productId]);};const getCurrentMedia=product=>{const videos=product.videos||[];const images=product.images||[];const idx=currentMediaIndex[product._id]||0;if(idx<videos.length){return{type:'video',file:videos[idx]};}else{return{type:'image',file:images[idx-videos.length]};}};// === Animation Variants ===\nconst cardVariants={hidden:{opacity:0,y:30,scale:0.95},visible:{opacity:1,y:0,scale:1,transition:{duration:0.7,ease:[0.22,1,0.36,1]}},hover:{scale:1.03,boxShadow:'0 12px 24px rgba(0, 0, 0, 0.2)',transition:{duration:0.2}}};const buttonVariants={hover:{scale:1.05,boxShadow:'0 8px 16px rgba(239, 68, 68, 0.3)'},tap:{scale:0.95}};const modalVariants={hidden:{opacity:0,scale:0.85},visible:{opacity:1,scale:1}};const toastVariants={hidden:{opacity:0,x:50},visible:{opacity:1,x:0}};// === Floating Chat Button ===\nconst totalUnread=orders.reduce((acc,o)=>acc+(o.unreadCount||0),0);const openMessagesFromFloating=()=>{const orderWithUnread=orders.find(o=>!o.isGrouped&&o.unreadCount>0);if(orderWithUnread)openMessages(orderWithUnread);};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-[#18191a] text-white p-4 relative overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"absolute inset-0 opacity-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 left-0 w-96 h-96 bg-red-900 rounded-full blur-3xl animate-pulse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-0 right-0 w-80 h-80 bg-red-800 rounded-full blur-3xl animate-pulse delay-700\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative z-10 w-full max-w-7xl mx-auto\",children:[/*#__PURE__*/_jsxs(motion.div,{className:\"flex flex-col items-center mb-8\",initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:0.8},children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mt-3\",children:[\"\\u0645\\u0646\\u062A\\u062C\\u0627\\u062A \\u0627\\u0644\\u062A\\u0627\\u062C\\u0631: \",vendorName]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-300 text-lg mt-1\",children:\"\\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\\u0627\\u062A \\u0627\\u0644\\u0645\\u062A\\u0627\\u062D\\u0629\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4\",children:[/*#__PURE__*/_jsxs(motion.select,{value:filterType,onChange:e=>setFilterType(e.target.value),className:\"p-3 rounded-xl bg-slate-800/60 backdrop-blur-md border border-slate-600 text-white focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\",whileHover:{scale:1.03},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0627\\u0644\\u0643\\u0644\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u0631\\u062C\\u0627\\u0644\\u064A\",children:\"\\u0631\\u062C\\u0627\\u0644\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u062D\\u0631\\u064A\\u0645\\u064A\",children:\"\\u062D\\u0631\\u064A\\u0645\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u0623\\u0637\\u0641\\u0627\\u0644\",children:\"\\u0623\\u0637\\u0641\\u0627\\u0644\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"\\u0645\\u0646 (\\u062C\\u0648\\u0632)\",value:priceRange.min,onChange:e=>setPriceRange(prev=>_objectSpread(_objectSpread({},prev),{},{min:e.target.value})),className:\"p-3 w-24 rounded-xl bg-slate-800/60 border border-slate-600 text-white placeholder:text-slate-400 focus:outline-none focus:border-red-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-slate-400\",children:\"\\u0625\\u0644\\u0649\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"\\u0625\\u0644\\u0649 (\\u062C\\u0648\\u0632)\",value:priceRange.max,onChange:e=>setPriceRange(prev=>_objectSpread(_objectSpread({},prev),{},{max:e.target.value})),className:\"p-3 w-24 rounded-xl bg-slate-800/60 border border-slate-600 text-white placeholder:text-slate-400 focus:outline-none focus:border-red-500\"})]}),userRole==='customer'&&/*#__PURE__*/_jsxs(motion.button,{onClick:()=>setShowCartModal(true),className:\"relative px-4 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 shadow-lg hover:from-red-700 hover:to-red-800 flex items-center gap-2\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"})}),cart.reduce((a,i)=>a+i.quantity,0)>0&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center\",children:cart.reduce((a,i)=>a+i.quantity,0)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",children:filteredProducts.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"col-span-full text-center text-slate-400 text-xl\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0645\\u0646\\u062A\\u062C\\u0627\\u062A \\u0644\\u0647\\u0630\\u0627 \\u0627\\u0644\\u062A\\u0627\\u062C\\u0631...\"}):filteredProducts.map(product=>{const videos=product.videos||[];const images=product.images||[];const allMedia=[...videos,...images];const currentIdx=currentMediaIndex[product._id]||0;const current=getCurrentMedia(product);return/*#__PURE__*/_jsxs(motion.div,{className:\"bg-slate-900/60 backdrop-blur-xl rounded-2xl shadow-2xl border border-slate-700/50 overflow-hidden\",variants:cardVariants,initial:\"hidden\",whileInView:\"visible\",viewport:{once:true},whileHover:\"hover\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative aspect-square bg-slate-800 cursor-pointer\",onClick:()=>openMedia(current.file,current.type),children:[current.type==='video'?/*#__PURE__*/_jsx(\"video\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(current.file),className:\"w-full h-full object-contain\",poster:images[0]?\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(images[0]):undefined,muted:true}):/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(current.file),alt:product.name,className:\"w-full h-full object-contain\"}),allMedia.length>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-3 left-1/2 transform -translate-x-1/2 flex gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();handlePrevMedia(product._id,product);},className:\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 19l-7-7 7-7\"})})}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();handleNextMedia(product._id,product);},className:\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 5l7 7-7 7\"})})})]})]}),allMedia.length>1&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-slate-800/50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center gap-2 flex-wrap\",children:allMedia.map((media,idx)=>{const isVideo=idx<videos.length;const thumbnailUrl=isVideo?images[0]?\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(images[0]):null:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(media);return/*#__PURE__*/_jsxs(\"button\",{onClick:e=>{e.stopPropagation();selectMediaIndex(product._id,idx);},className:\"relative w-16 h-16 rounded-lg overflow-hidden border-2 transition-all \".concat(currentIdx===idx?'border-red-500 shadow-lg shadow-red-500/50 scale-110':'border-slate-600 opacity-75 hover:opacity-100'),children:[thumbnailUrl?/*#__PURE__*/_jsx(\"img\",{src:thumbnailUrl,alt:\"\",className:\"w-full h-full object-cover\"}):/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-full bg-slate-700 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-8 h-8 text-slate-400\",fill:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M8 5v14l11-7L8 5z\"})})}),isVideo&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black/40 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-10 h-10 text-white\",fill:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M8 5v14l11-7L8 5z\"})})})]},idx);})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-5 space-y-2 text-right\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600\",children:product.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-slate-300 space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0627\\u0644\\u0646\\u0648\\u0639: \",product.type]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0643\\u0631\\u062A\\u0648\\u0646\\u0629: \",product.price,\" \\u062C\\u0646\\u064A\\u0647\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u062C\\u0648\\u0632: \",(product.price/product.quantityPerCarton).toFixed(2),\" \\u062C\\u0646\\u064A\\u0647\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0627\\u0644\\u0643\\u0631\\u062A\\u0648\\u0646\\u0629: \",product.quantityPerCarton,\" \\u062C\\u0648\\u0632\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0627\\u0644\\u0645\\u0635\\u0646\\u0639: \",product.manufacturer]})]}),userRole==='customer'&&/*#__PURE__*/_jsx(motion.button,{onClick:()=>addToCart(product),className:\"w-full mt-4 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0625\\u0644\\u0649 \\u0627\\u0644\\u0633\\u0644\\u0629\"})]})]},product._id);})})]}),/*#__PURE__*/_jsx(AnimatePresence,{children:showAddedToCart&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed top-6 right-6 bg-red-600 text-white px-5 py-3 rounded-full shadow-xl flex items-center gap-2 z-50\",variants:toastVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",children:/*#__PURE__*/_jsx(\"span\",{children:\"\\u062A\\u0645\\u062A \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0629\"})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:showCartModal&&userRole==='customer'&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",onClick:()=>setShowCartModal(false),children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-lg\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\",children:\"\\u0627\\u0644\\u0633\\u0644\\u0629\"}),cart.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-slate-400\",children:\"\\u0627\\u0644\\u0633\\u0644\\u0629 \\u0641\\u0627\\u0631\\u063A\\u0629\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4 max-h-96 overflow-y-auto\",children:cart.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between gap-4 p-3 bg-slate-800/50 rounded-xl\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(item.selectedImage),alt:\"\",className:\"w-16 h-16 object-cover rounded-lg\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right flex-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:item.product.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-slate-400\",children:[\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0643\\u0631\\u062A\\u0648\\u0646\\u0629: \",item.product.price,\" \\u062C\\u0646\\u064A\\u0647\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",value:item.quantity,onChange:e=>updateCartQuantity(item.product._id,item.selectedImage,parseInt(e.target.value)),className:\"w-16 p-2 bg-slate-700 rounded text-center\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFromCart(item.product._id,item.selectedImage),className:\"text-red-400 hover:text-red-300\",children:\"\\xD7\"})]})]},\"\".concat(item.product._id,\"-\").concat(item.selectedImage)))}),cart.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowCartModal(false);setShowOrderForm(true);},className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold\",children:\"\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCartModal(false),className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold\",children:\"\\u0625\\u063A\\u0644\\u0627\\u0642\"})]})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:showOrderForm&&userRole==='customer'&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",onClick:()=>setShowOrderForm(false),children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-md\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\",children:\"\\u0625\\u062F\\u062E\\u0627\\u0644 \\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\",value:orderForm.address,onChange:e=>setOrderForm({address:e.target.value}),className:\"w-full p-4 mb-6 bg-slate-800/60 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleOrderSubmit,disabled:isSubmitting,className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold disabled:opacity-70\",children:isSubmitting?'جاري...':'إرسال'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowOrderForm(false),className:\"flex-1 py-3 rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold\",children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedMedia&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/90 flex items-center justify-center z-50\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"hidden\",onClick:closeMedia,children:/*#__PURE__*/_jsxs(motion.div,{className:\"relative max-w-4xl max-h-screen p-4\",onClick:e=>e.stopPropagation(),children:[selectedMedia.type==='image'?/*#__PURE__*/_jsx(\"img\",{src:selectedMedia.url,alt:\"\",className:\"max-w-full max-h-screen rounded-2xl shadow-2xl\"}):/*#__PURE__*/_jsx(\"video\",{src:selectedMedia.url,controls:true,autoPlay:true,className:\"max-w-full max-h-screen rounded-2xl shadow-2xl\"}),/*#__PURE__*/_jsx(\"button\",{onClick:closeMedia,className:\"absolute top-4 right-4 bg-red-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg hover:bg-red-700\",children:\"\\xD7\"})]})})}),/*#__PURE__*/_jsx(AnimatePresence,{children:selectedOrderForMessages&&isChatManuallyOpened&&!selectedOrderForMessages.isGrouped&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\",variants:modalVariants,initial:\"hidden\",animate:\"visible\",exit:\"exit\",children:/*#__PURE__*/_jsxs(motion.div,{className:\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-red-600\",children:[\"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644 \\u0644\\u0644\\u0637\\u0644\\u0628 #\",selectedOrderForMessages.orderNumber]}),/*#__PURE__*/_jsx(\"div\",{ref:chatContainerRef,className:\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\",children:selectedOrderForMessages.messages&&selectedOrderForMessages.messages.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:selectedOrderForMessages.messages.map((msg,index)=>{var _selectedOrderForMess,_selectedOrderForMess2,_selectedOrderForMess3;const isMyMessage=msg.from===userRole;const senderName=msg.from==='vendor'?(_selectedOrderForMess=selectedOrderForMessages.product)===null||_selectedOrderForMess===void 0?void 0:(_selectedOrderForMess2=_selectedOrderForMess.vendor)===null||_selectedOrderForMess2===void 0?void 0:_selectedOrderForMess2.name:((_selectedOrderForMess3=selectedOrderForMessages.user)===null||_selectedOrderForMess3===void 0?void 0:_selectedOrderForMess3.name)||'غير معروف';return/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(isMyMessage?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md \".concat(isMyMessage?'bg-gradient-to-r from-red-600 to-red-800 text-white':'bg-gray-700 text-white'),children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold text-sm opacity-90\",children:[msg.from==='vendor'?'التاجر':'العميل',\": \",senderName]}),msg.text&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-lg\",children:msg.text}),msg.image&&/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(process.env.REACT_APP_API_URL,\"/Uploads/\").concat(msg.image),alt:\"\\u0635\\u0648\\u0631\\u0629 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\",className:\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\",onClick:e=>{e.stopPropagation();openMedia(msg.image,'image');}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-3 text-xs opacity-70\",children:[/*#__PURE__*/_jsx(\"p\",{children:new Date(msg.timestamp).toLocaleString('ar-EG')}),isMyMessage&&/*#__PURE__*/_jsx(\"span\",{children:msg.isRead?'✓✓':msg.isDelivered?'✓':'✓'})]})]})},msg._id||index);})}):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-400 text-lg\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0631\\u0633\\u0627\\u0626\\u0644 \\u0628\\u0639\\u062F.\"})}),(userRole==='vendor'||userRole==='customer')&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"\\u0627\\u0643\\u062A\\u0628 \\u0631\\u0633\\u0627\\u0644\\u062A\\u0643 \\u0647\\u0646\\u0627...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),className:\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\",rows:\"4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:e=>setNewImage(e.target.files[0]||null),className:\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\"}),newImagePreview&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:newImagePreview,alt:\"\\u0645\\u0639\\u0627\\u064A\\u0646\\u0629\",className:\"w-24 h-24 object-cover rounded-xl shadow-lg\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setNewImage(null);setNewImagePreview(null);},className:\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\",children:\"\\xD7\"})]})]}),/*#__PURE__*/_jsx(motion.button,{type:\"submit\",className:\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u0631\\u0633\\u0627\\u0644 \\u0627\\u0644\\u0631\\u0633\\u0627\\u0644\\u0629\"})]}),/*#__PURE__*/_jsx(motion.button,{onClick:closeMessages,className:\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\",variants:buttonVariants,whileHover:\"hover\",whileTap:\"tap\",children:\"\\u0625\\u063A\\u0644\\u0627\\u0642\"})]})})}),(userRole==='customer'||userRole==='vendor')&&totalUnread>0&&showFloatingChatButton&&/*#__PURE__*/_jsx(motion.div,{className:\"fixed bottom-6 right-6 z-50\",initial:{scale:0},animate:{scale:1},transition:{type:\"spring\",stiffness:300},children:/*#__PURE__*/_jsxs(\"button\",{onClick:openMessagesFromFloating,className:\"relative w-16 h-16 bg-gradient-to-r from-red-600 to-red-700 rounded-full shadow-2xl flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-8 w-8 text-red-400\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-7 h-7 flex items-center justify-center animate-pulse\",children:totalUnread>99?'99+':totalUnread})]})})]});};export default VendorProducts;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","motion","AnimatePresence","useParams","Link","useNavigate","axios","io","jsx","_jsx","jsxs","_jsxs","VendorProducts","vendorId","products","setProducts","filteredProducts","setFilteredProducts","filterType","setFilterType","priceRange","setPriceRange","min","max","vendorName","setVendorName","cart","setCart","showCartModal","setShowCartModal","showOrderForm","setShowOrderForm","orderForm","setOrderForm","address","selectedMedia","setSelectedMedia","currentMediaIndex","setCurrentMediaIndex","currentMediaType","setCurrentMediaType","showAddedToCart","setShowAddedToCart","error","setError","previousOrders","setPreviousOrders","isSubmitting","setIsSubmitting","intervalRefs","navigate","orders","setOrders","selectedOrderForMessages","setSelectedOrderForMessages","newMessage","setNewMessage","newImage","setNewImage","newImagePreview","setNewImagePreview","isChatManuallyOpened","setIsChatManuallyOpened","showFloatingChatButton","setShowFloatingChatButton","socketRef","currentOrderIdRef","chatContainerRef","isFirstOpenRef","reader","FileReader","onloadend","result","readAsDataURL","scrollToBottom","current","scrollTop","scrollHeight","fetchProducts","token","localStorage","getItem","get","concat","process","env","REACT_APP_API_URL","headers","Authorization","then","res","_sortedProducts$","_sortedProducts$$vend","approvedProducts","data","filter","p","approved","sortedProducts","sort","a","b","Date","updatedAt","vendor","name","initialIndexes","initialTypes","forEach","_id","hasVideos","videos","length","catch","err","_err$response","response","status","clear","role","userId","includes","savedCart","JSON","parse","payload","atob","split","autoConnect","socket","connect","emit","id","on","console","log","updatedProduct","prev","exists","some","newList","map","filtered","type","parseFloat","Infinity","pairPrice","price","quantityPerCarton","_ref","connected","disconnect","e","fetchUnreadOrders","_err$response2","userRole","getUserRole","handleNewMessage","message","orderId","from","o","_objectSpread","unreadCount","_prev$messages","messages","m","setTimeout","handleMessagesUpdated","msg","isRead","handleUnreadUpdate","_ref2","off","post","updatedOrder","order","handleSendMessage","preventDefault","stopPropagation","trim","formData","FormData","append","_err$response3","_err$response3$data","openMessages","isGrouped","alert","originalOrder","find","closeMessages","product","images","clearInterval","setInterval","next","Object","values","setItem","stringify","addToCart","_product$videos","currentType","videosLength","imgIndex","selectedImage","existing","i","quantity","updateCartQuantity","productId","qty","removeFromCart","handleOrderSubmit","confirmSubmit","window","confirm","promises","item","user","Promise","all","_err$response4","_err$response4$data","_err$response5","finally","openMedia","media","url","closeMedia","handlePrevMedia","_p$videos","_p$images","total","t","_p$videos2","handleNextMedia","_p$videos3","_p$images2","_p$videos4","selectMediaIndex","index","_products$find","_products$find$videos","getCurrentMedia","idx","file","cardVariants","hidden","opacity","y","scale","visible","transition","duration","ease","hover","boxShadow","buttonVariants","tap","modalVariants","toastVariants","x","totalUnread","reduce","acc","openMessagesFromFloating","orderWithUnread","className","children","div","initial","animate","select","value","onChange","target","whileHover","placeholder","button","onClick","variants","whileTap","xmlns","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","allMedia","currentIdx","whileInView","viewport","once","src","poster","undefined","muted","alt","isVideo","thumbnailUrl","toFixed","manufacturer","exit","parseInt","disabled","controls","autoPlay","orderNumber","ref","_selectedOrderForMess","_selectedOrderForMess2","_selectedOrderForMess3","isMyMessage","senderName","text","image","timestamp","toLocaleString","isDelivered","onSubmit","rows","accept","files","stiffness"],"sources":["/root/shose/app-shose/frontend/src/pages/VendorProducts.js"],"sourcesContent":["// frontend/src/pages/VendorProducts.js\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useParams, Link, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { io } from 'socket.io-client';\n\nconst VendorProducts = () => {\n  const { vendorId } = useParams();\n  const [products, setProducts] = useState([]);\n  const [filteredProducts, setFilteredProducts] = useState([]);\n  const [filterType, setFilterType] = useState('');\n  const [priceRange, setPriceRange] = useState({ min: '', max: '' });\n  const [vendorName, setVendorName] = useState('');\n  const [cart, setCart] = useState([]);\n  const [showCartModal, setShowCartModal] = useState(false);\n  const [showOrderForm, setShowOrderForm] = useState(false);\n  const [orderForm, setOrderForm] = useState({ address: '' });\n  const [selectedMedia, setSelectedMedia] = useState(null);\n  const [currentMediaIndex, setCurrentMediaIndex] = useState({});\n  const [currentMediaType, setCurrentMediaType] = useState({});\n  const [showAddedToCart, setShowAddedToCart] = useState(false);\n  const [error, setError] = useState('');\n  const [previousOrders, setPreviousOrders] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const intervalRefs = useRef({});\n  const navigate = useNavigate();\n\n  // === إضافات الشات (مطابقة Home.js) ===\n  const [orders, setOrders] = useState([]);\n  const [selectedOrderForMessages, setSelectedOrderForMessages] = useState(null);\n  const [newMessage, setNewMessage] = useState('');\n  const [newImage, setNewImage] = useState(null);\n  const [newImagePreview, setNewImagePreview] = useState(null);\n  const [isChatManuallyOpened, setIsChatManuallyOpened] = useState(false);\n  const [showFloatingChatButton, setShowFloatingChatButton] = useState(true);\n  const socketRef = useRef(null);\n  const currentOrderIdRef = useRef(null);\n  const chatContainerRef = useRef(null);\n  const isFirstOpenRef = useRef(true);\n\n  // Image preview effect\n  useEffect(() => {\n    if (newImage) {\n      const reader = new FileReader();\n      reader.onloadend = () => setNewImagePreview(reader.result);\n      reader.readAsDataURL(newImage);\n    } else {\n      setNewImagePreview(null);\n    }\n  }, [newImage]);\n\n  // Scroll to bottom\n  const scrollToBottom = useCallback(() => {\n    if (chatContainerRef.current) {\n      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n    }\n  }, []);\n\n  // Reset first open flag when chat closes\n  useEffect(() => {\n    if (!isChatManuallyOpened) isFirstOpenRef.current = true;\n  }, [isChatManuallyOpened]);\n\n  // === جلب المنتجات ===\n  const fetchProducts = useCallback(() => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    axios\n      .get(`${process.env.REACT_APP_API_URL}/api/products/vendor/${vendorId}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(res => {\n        const approvedProducts = res.data.filter(p => p.approved);\n        const sortedProducts = [...approvedProducts].sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\n        setProducts(sortedProducts);\n        setFilteredProducts(sortedProducts);\n        setVendorName(sortedProducts[0]?.vendor?.name || 'تاجر غير معروف');\n\n        const initialIndexes = {};\n        const initialTypes = {};\n        sortedProducts.forEach(p => {\n          initialIndexes[p._id] = 0;\n          const hasVideos = p.videos && p.videos.length > 0;\n          initialTypes[p._id] = hasVideos ? 'video' : 'image';\n        });\n        setCurrentMediaIndex(initialIndexes);\n        setCurrentMediaType(initialTypes);\n        setError('');\n      })\n      .catch(err => {\n        if (err.response?.status === 401) {\n          localStorage.clear();\n          navigate('/login');\n        }\n      });\n  }, [vendorId, navigate]);\n\n  // === جلب المنتجات + السلة + الطلبات السابقة ===\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    const role = localStorage.getItem('role');\n    const userId = localStorage.getItem('userId');\n    if (!token || !['admin', 'vendor', 'customer'].includes(role)) {\n      setError('غير مصرح: يرجى تسجيل الدخول');\n      navigate('/login');\n      return;\n    }\n    fetchProducts();\n    if (role === 'customer') {\n      const savedCart = localStorage.getItem('cart');\n      if (savedCart) setCart(JSON.parse(savedCart));\n    }\n    if (role === 'customer' && userId) {\n      axios\n        .get(`${process.env.REACT_APP_API_URL}/api/orders/user/${userId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        })\n        .then(res => setPreviousOrders(res.data))\n        .catch(() => {});\n    }\n  }, [navigate, fetchProducts]);\n\n  // === Socket.IO Authentication & Real-time Updates ===\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      socketRef.current = io(process.env.REACT_APP_API_URL, { autoConnect: false });\n      const socket = socketRef.current;\n      socket.connect();\n      socket.emit('authenticate', { userId: payload.id, role: payload.role });\n      socket.on('connect', () => {\n        console.log('Socket connected in VendorProducts');\n        fetchProducts();\n        if (currentOrderIdRef.current) {\n          socket.emit('joinOrder', currentOrderIdRef.current);\n        }\n      });\n      socket.on('productUpdated', (updatedProduct) => {\n        if (updatedProduct.vendor._id !== vendorId && updatedProduct.vendor !== vendorId) return;\n        setProducts(prev => {\n          const exists = prev.some(p => p._id === updatedProduct._id);\n          const newList = exists\n            ? prev.map(p => (p._id === updatedProduct._id ? updatedProduct : p))\n            : [updatedProduct, ...prev];\n          return newList.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\n        });\n        setFilteredProducts(prev => {\n          const exists = prev.some(p => p._id === updatedProduct._id);\n          const newList = exists\n            ? prev.map(p => (p._id === updatedProduct._id ? updatedProduct : p))\n            : [updatedProduct, ...prev];\n          let filtered = newList.filter(p => p.approved && (p.vendor._id === vendorId || p.vendor === vendorId));\n          if (filterType) filtered = filtered.filter(p => p.type === filterType);\n          if (priceRange.min || priceRange.max) {\n            const min = parseFloat(priceRange.min) || 0;\n            const max = parseFloat(priceRange.max) || Infinity;\n            filtered = filtered.filter(p => {\n              const pairPrice = p.price / p.quantityPerCarton;\n              return pairPrice >= min && pairPrice <= max;\n            });\n          }\n          return filtered.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\n        });\n      });\n      socket.on('productDeleted', ({ _id }) => {\n        setProducts(prev => prev.filter(p => p._id !== _id));\n        setFilteredProducts(prev => prev.filter(p => p._id !== _id));\n      });\n      return () => {\n        if (socket.connected) socket.disconnect();\n      };\n    } catch (e) {\n      localStorage.clear();\n      navigate('/login');\n    }\n  }, [navigate, vendorId, fetchProducts, filterType, priceRange]);\n\n  // === جلب الطلبات التي بها رسائل غير مقروءة ===\n  const fetchUnreadOrders = useCallback(() => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    axios\n      .get(`${process.env.REACT_APP_API_URL}/api/orders?unreadOnly=true`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n      .then(res => {\n        setOrders(res.data.orders || []);\n      })\n      .catch(err => {\n        if (err.response?.status === 401) {\n          localStorage.clear();\n          navigate('/login');\n        }\n      });\n  }, [navigate]);\n\n  useEffect(() => {\n    fetchUnreadOrders();\n  }, [fetchUnreadOrders]);\n\n  // === Global Socket Listeners for Messages ===\n  useEffect(() => {\n    const socket = socketRef.current;\n    if (!socket) return;\n    const userRole = getUserRole();\n    const handleNewMessage = (message) => {\n      const orderId = message.orderId;\n      if (message.from !== userRole) {\n        setOrders(prev => prev.map(o =>\n          o._id === orderId ? { ...o, unreadCount: (o.unreadCount || 0) + 1 } : o\n        ));\n      }\n      if (isChatManuallyOpened && selectedOrderForMessages?._id === orderId) {\n        setSelectedOrderForMessages(prev => {\n          const exists = prev.messages?.some(m => m._id === message._id);\n          if (exists) return prev;\n          return { ...prev, messages: [...(prev.messages || []), message] };\n        });\n        setTimeout(scrollToBottom, 100);\n      }\n      if (!isChatManuallyOpened && message.from !== userRole) {\n        setShowFloatingChatButton(true);\n      }\n    };\n    const handleMessagesUpdated = (data) => {\n      const { orderId, messages } = data;\n      const unreadCount = messages.filter(msg => !msg.isRead && msg.from !== userRole).length;\n      setOrders(prev => prev.map(o => (o._id === orderId ? { ...o, unreadCount, messages } : o)));\n      if (isChatManuallyOpened && selectedOrderForMessages?._id === orderId) {\n        setSelectedOrderForMessages(prev => ({ ...prev, messages: messages || [], unreadCount }));\n        setTimeout(scrollToBottom, 100);\n      }\n    };\n    const handleUnreadUpdate = ({ orderId, unreadCount }) => {\n      setOrders(prev => prev.map(o => (o._id === orderId ? { ...o, unreadCount } : o)));\n      if (selectedOrderForMessages?._id === orderId) {\n        setSelectedOrderForMessages(prev => ({ ...prev, unreadCount }));\n      }\n      if (unreadCount > 0 && !isChatManuallyOpened) {\n        setShowFloatingChatButton(true);\n      }\n    };\n    socket.on('newMessage', handleNewMessage);\n    socket.on('messagesUpdated', handleMessagesUpdated);\n    socket.on('unreadUpdate', handleUnreadUpdate);\n    return () => {\n      socket.off('newMessage', handleNewMessage);\n      socket.off('messagesUpdated', handleMessagesUpdated);\n      socket.off('unreadUpdate', handleUnreadUpdate);\n    };\n  }, [isChatManuallyOpened, selectedOrderForMessages, scrollToBottom]);\n\n  // === Chat-specific Socket Handling ===\n  useEffect(() => {\n    if (!isChatManuallyOpened || !selectedOrderForMessages || !socketRef.current) {\n      if (currentOrderIdRef.current && socketRef.current) {\n        socketRef.current.emit('leaveOrder', currentOrderIdRef.current);\n        currentOrderIdRef.current = null;\n      }\n      return;\n    }\n    const orderId = selectedOrderForMessages._id;\n    currentOrderIdRef.current = orderId;\n    socketRef.current.emit('joinOrder', orderId);\n    const token = localStorage.getItem('token');\n    axios\n      .post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${orderId}/markRead`,\n        {},\n        { headers: { Authorization: `Bearer ${token}` } }\n      )\n      .then(res => {\n        const updatedOrder = res.data.order;\n        setOrders(prev => prev.map(o => (o._id === orderId ? updatedOrder : o)));\n        setSelectedOrderForMessages({\n          ...updatedOrder,\n          messages: updatedOrder.messages || [],\n          unreadCount: 0,\n        });\n      })\n      .catch(console.error);\n    if (isFirstOpenRef.current) {\n      setTimeout(scrollToBottom, 100);\n      isFirstOpenRef.current = false;\n    }\n    return () => {\n      socketRef.current.emit('leaveOrder', orderId);\n      currentOrderIdRef.current = null;\n    };\n  }, [isChatManuallyOpened, selectedOrderForMessages, scrollToBottom]);\n\n  // === Send Message ===\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const token = localStorage.getItem('token');\n    if (!token || (!newMessage.trim() && !newImage)) return;\n    const formData = new FormData();\n    if (newMessage.trim()) formData.append('text', newMessage.trim());\n    if (newImage) formData.append('image', newImage);\n    try {\n      const res = await axios.post(\n        `${process.env.REACT_APP_API_URL}/api/orders/${selectedOrderForMessages._id}/message`,\n        formData,\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data',\n          },\n        }\n      );\n      setSelectedOrderForMessages(prev => ({\n        ...prev,\n        messages: res.data.order.messages || [],\n      }));\n      setNewMessage('');\n      setNewImage(null);\n      setNewImagePreview(null);\n      setTimeout(scrollToBottom, 100);\n    } catch (err) {\n      setError(err.response?.data?.message || 'خطأ في إرسال الرسالة');\n    }\n  };\n\n  // === Open / Close Messages ===\n  const openMessages = (order) => {\n    if (order.isGrouped) {\n      alert('الشات متاح فقط للطلبات الفردية');\n      return;\n    }\n    const originalOrder = orders.find(o => o._id === order._id);\n    if (!originalOrder) return;\n    setSelectedOrderForMessages({\n      ...originalOrder,\n      messages: originalOrder.messages || [],\n      unreadCount: originalOrder.unreadCount || 0,\n    });\n    setShowFloatingChatButton(false);\n    setIsChatManuallyOpened(true);\n    isFirstOpenRef.current = true;\n  };\n  const closeMessages = () => {\n    setSelectedOrderForMessages(null);\n    setNewMessage('');\n    setNewImage(null);\n    setNewImagePreview(null);\n    setShowFloatingChatButton(true);\n    setIsChatManuallyOpened(false);\n  };\n\n  // === User Role ===\n  const getUserRole = () => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        return payload.role || 'user';\n      } catch (e) {\n        localStorage.clear();\n        navigate('/login');\n        return 'user';\n      }\n    }\n    return 'user';\n  };\n  const userRole = getUserRole();\n\n  // === تصفية المنتجات ===\n  useEffect(() => {\n    let filtered = products.filter(p => p.vendor._id === vendorId || p.vendor === vendorId);\n    if (filterType) filtered = filtered.filter(p => p.type === filterType);\n    if (priceRange.min || priceRange.max) {\n      const min = parseFloat(priceRange.min) || 0;\n      const max = parseFloat(priceRange.max) || Infinity;\n      filtered = filtered.filter(p => {\n        const pairPrice = p.price / p.quantityPerCarton;\n        return pairPrice >= min && pairPrice <= max;\n      });\n    }\n    setFilteredProducts(filtered.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)));\n  }, [filterType, priceRange, products, vendorId]);\n\n  // === تدوير الصور تلقائيًا (للصور فقط) ===\n  useEffect(() => {\n    products.forEach(product => {\n      const images = product.images || [];\n      const videos = product.videos || [];\n      if (images.length > 1 && videos.length === 0) {\n        clearInterval(intervalRefs.current[product._id]);\n        intervalRefs.current[product._id] = setInterval(() => {\n          setCurrentMediaIndex(prev => {\n            const current = prev[product._id] || 0;\n            const next = (current + 1) % images.length;\n            return { ...prev, [product._id]: next };\n          });\n        }, 3000);\n      }\n    });\n    return () => Object.values(intervalRefs.current).forEach(clearInterval);\n  }, [products]);\n\n  // === حفظ السلة ===\n  useEffect(() => {\n    if (localStorage.getItem('role') === 'customer') {\n      localStorage.setItem('cart', JSON.stringify(cart));\n    }\n  }, [cart]);\n\n  // === إضافة إلى السلة ===\n  const addToCart = (product) => {\n    const currentType = currentMediaType[product._id] || 'image';\n    if (currentType === 'video') {\n      alert('يرجى اختيار صورة لإضافتها إلى السلة');\n      return;\n    }\n    const videosLength = product.videos?.length || 0;\n    const imgIndex = (currentMediaIndex[product._id] || 0) - videosLength;\n    const selectedImage = product.images[imgIndex] || 'placeholder-image.jpg';\n    setCart(prev => {\n      const existing = prev.find(i => i.product._id === product._id && i.selectedImage === selectedImage);\n      if (existing) {\n        return prev.map(i =>\n          i.product._id === product._id && i.selectedImage === selectedImage\n            ? { ...i, quantity: i.quantity + 1 }\n            : i\n        );\n      }\n      return [...prev, { product, quantity: 1, selectedImage }];\n    });\n    setShowAddedToCart(true);\n    setTimeout(() => setShowAddedToCart(false), 2000);\n  };\n\n  const updateCartQuantity = (productId, selectedImage, qty) => {\n    if (qty < 1) return;\n    setCart(prev => prev.map(i =>\n      i.product._id === productId && i.selectedImage === selectedImage\n        ? { ...i, quantity: qty }\n        : i\n    ));\n  };\n\n  const removeFromCart = (productId, selectedImage) => {\n    setCart(prev => prev.filter(i => !(i.product._id === productId && i.selectedImage === selectedImage)));\n  };\n\n  // === تقديم الطلب ===\n  const handleOrderSubmit = () => {\n    if (isSubmitting || !orderForm.address) return;\n    const token = localStorage.getItem('token');\n    const userId = localStorage.getItem('userId');\n    if (!token || !userId) return navigate('/login');\n    let confirmSubmit = true;\n    if (previousOrders.length > 0) {\n      confirmSubmit = window.confirm('أنت طلبت الطلب مرة، هل تريد تأكيد طلبه مرة أخرى؟');\n    }\n    if (!confirmSubmit) return;\n    setIsSubmitting(true);\n    const promises = cart.map(item =>\n      axios.post(\n        `${process.env.REACT_APP_API_URL}/api/orders`,\n        {\n          product: item.product._id,\n          vendor: item.product.vendor._id || item.product.vendor,\n          quantity: item.quantity,\n          user: userId,\n          address: orderForm.address,\n          selectedImage: item.selectedImage\n        },\n        { headers: { Authorization: `Bearer ${token}` } }\n      )\n    );\n    Promise.all(promises)\n      .then(() => {\n        alert('تم إنشاء الطلبات بنجاح!');\n        setCart([]);\n        setShowOrderForm(false);\n        setOrderForm({ address: '' });\n        axios.get(`${process.env.REACT_APP_API_URL}/api/orders/user/${userId}`, {\n          headers: { Authorization: `Bearer ${token}` }\n        }).then(res => setPreviousOrders(res.data));\n      })\n      .catch(err => {\n        setError(err.response?.data?.message || 'خطأ في تقديم الطلب');\n        if (err.response?.status === 401) {\n          localStorage.clear();\n          navigate('/login');\n        }\n      })\n      .finally(() => setIsSubmitting(false));\n  };\n\n  // === Media Viewer ===\n  const openMedia = (media, type) => setSelectedMedia({ url: `${process.env.REACT_APP_API_URL}/Uploads/${media}`, type });\n  const closeMedia = () => setSelectedMedia(null);\n\n  const handlePrevMedia = (id, p) => {\n    const total = (p.videos?.length || 0) + (p.images?.length || 0);\n    setCurrentMediaIndex(prev => {\n      const next = (prev[id] - 1 + total) % total;\n      setCurrentMediaType(t => ({ ...t, [id]: next < (p.videos?.length || 0) ? 'video' : 'image' }));\n      return { ...prev, [id]: next };\n    });\n    clearInterval(intervalRefs.current[id]);\n  };\n\n  const handleNextMedia = (id, p) => {\n    const total = (p.videos?.length || 0) + (p.images?.length || 0);\n    setCurrentMediaIndex(prev => {\n      const next = (prev[id] + 1) % total;\n      setCurrentMediaType(t => ({ ...t, [id]: next < (p.videos?.length || 0) ? 'video' : 'image' }));\n      return { ...prev, [id]: next };\n    });\n    clearInterval(intervalRefs.current[id]);\n  };\n\n  const selectMediaIndex = (productId, index) => {\n    setCurrentMediaIndex(prev => ({ ...prev, [productId]: index }));\n    setCurrentMediaType(prev => ({\n      ...prev,\n      [productId]: index < (products.find(p => p._id === productId)?.videos?.length || 0) ? 'video' : 'image'\n    }));\n    clearInterval(intervalRefs.current[productId]);\n  };\n\n  const getCurrentMedia = (product) => {\n    const videos = product.videos || [];\n    const images = product.images || [];\n    const idx = currentMediaIndex[product._id] || 0;\n    if (idx < videos.length) {\n      return { type: 'video', file: videos[idx] };\n    } else {\n      return { type: 'image', file: images[idx - videos.length] };\n    }\n  };\n\n  // === Animation Variants ===\n  const cardVariants = {\n    hidden: { opacity: 0, y: 30, scale: 0.95 },\n    visible: { opacity: 1, y: 0, scale: 1, transition: { duration: 0.7, ease: [0.22, 1, 0.36, 1] } },\n    hover: { scale: 1.03, boxShadow: '0 12px 24px rgba(0, 0, 0, 0.2)', transition: { duration: 0.2 } }\n  };\n  const buttonVariants = { hover: { scale: 1.05, boxShadow: '0 8px 16px rgba(239, 68, 68, 0.3)' }, tap: { scale: 0.95 } };\n  const modalVariants = { hidden: { opacity: 0, scale: 0.85 }, visible: { opacity: 1, scale: 1 } };\n  const toastVariants = { hidden: { opacity: 0, x: 50 }, visible: { opacity: 1, x: 0 } };\n\n  // === Floating Chat Button ===\n  const totalUnread = orders.reduce((acc, o) => acc + (o.unreadCount || 0), 0);\n  const openMessagesFromFloating = () => {\n    const orderWithUnread = orders.find(o => !o.isGrouped && o.unreadCount > 0);\n    if (orderWithUnread) openMessages(orderWithUnread);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-[#18191a] text-white p-4 relative overflow-hidden\">\n      {/* خلفية */}\n      <div className=\"absolute inset-0 opacity-10\">\n        <div className=\"absolute top-0 left-0 w-96 h-96 bg-red-900 rounded-full blur-3xl animate-pulse\" />\n        <div className=\"absolute bottom-0 right-0 w-80 h-80 bg-red-800 rounded-full blur-3xl animate-pulse delay-700\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-7xl mx-auto\">\n        {/* العنوان */}\n        <motion.div className=\"flex flex-col items-center mb-8\" initial={{ opacity: 0, y: -30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>\n          <h1 className=\"text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mt-3\">\n            منتجات التاجر: {vendorName}\n          </h1>\n          <p className=\"text-red-300 text-lg mt-1\">المنتجات المتاحة</p>\n        </motion.div>\n\n        {/* الفلتر + السلة */}\n        <div className=\"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4\">\n          <motion.select value={filterType} onChange={e => setFilterType(e.target.value)} className=\"p-3 rounded-xl bg-slate-800/60 backdrop-blur-md border border-slate-600 text-white focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\" whileHover={{ scale: 1.03 }}>\n            <option value=\"\">الكل</option>\n            <option value=\"رجالي\">رجالي</option>\n            <option value=\"حريمي\">حريمي</option>\n            <option value=\"أطفال\">أطفال</option>\n          </motion.select>\n          <div className=\"flex items-center gap-2\">\n            <input type=\"number\" placeholder=\"من (جوز)\" value={priceRange.min} onChange={e => setPriceRange(prev => ({ ...prev, min: e.target.value }))} className=\"p-3 w-24 rounded-xl bg-slate-800/60 border border-slate-600 text-white placeholder:text-slate-400 focus:outline-none focus:border-red-500\" />\n            <span className=\"text-slate-400\">إلى</span>\n            <input type=\"number\" placeholder=\"إلى (جوز)\" value={priceRange.max} onChange={e => setPriceRange(prev => ({ ...prev, max: e.target.value }))} className=\"p-3 w-24 rounded-xl bg-slate-800/60 border border-slate-600 text-white placeholder:text-slate-400 focus:outline-none focus:border-red-500\" />\n          </div>\n          {userRole === 'customer' && (\n            <motion.button onClick={() => setShowCartModal(true)} className=\"relative px-4 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 shadow-lg hover:from-red-700 hover:to-red-800 flex items-center gap-2\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\" />\n              </svg>\n              {cart.reduce((a, i) => a + i.quantity, 0) > 0 && (\n                <span className=\"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center\">\n                  {cart.reduce((a, i) => a + i.quantity, 0)}\n                </span>\n              )}\n            </motion.button>\n          )}\n        </div>\n\n        {/* المنتجات */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n          {filteredProducts.length === 0 ? (\n            <p className=\"col-span-full text-center text-slate-400 text-xl\">لا توجد منتجات لهذا التاجر...</p>\n          ) : (\n            filteredProducts.map(product => {\n              const videos = product.videos || [];\n              const images = product.images || [];\n              const allMedia = [...videos, ...images];\n              const currentIdx = currentMediaIndex[product._id] || 0;\n              const current = getCurrentMedia(product);\n\n              return (\n                <motion.div\n                  key={product._id}\n                  className=\"bg-slate-900/60 backdrop-blur-xl rounded-2xl shadow-2xl border border-slate-700/50 overflow-hidden\"\n                  variants={cardVariants}\n                  initial=\"hidden\"\n                  whileInView=\"visible\"\n                  viewport={{ once: true }}\n                  whileHover=\"hover\"\n                >\n                  {/* الصورة أو الفيديو الرئيسي */}\n                  <div className=\"relative aspect-square bg-slate-800 cursor-pointer\" onClick={() => openMedia(current.file, current.type)}>\n                    {current.type === 'video' ? (\n                      <video\n                        src={`${process.env.REACT_APP_API_URL}/Uploads/${current.file}`}\n                        className=\"w-full h-full object-contain\"\n                        poster={images[0] ? `${process.env.REACT_APP_API_URL}/Uploads/${images[0]}` : undefined}\n                        muted\n                      />\n                    ) : (\n                      <img\n                        src={`${process.env.REACT_APP_API_URL}/Uploads/${current.file}`}\n                        alt={product.name}\n                        className=\"w-full h-full object-contain\"\n                      />\n                    )}\n\n                    {/* أزرار التنقل */}\n                    {allMedia.length > 1 && (\n                      <div className=\"absolute bottom-3 left-1/2 transform -translate-x-1/2 flex gap-3\">\n                        <button onClick={(e) => { e.stopPropagation(); handlePrevMedia(product._id, product); }} className=\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\">\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" /></svg>\n                        </button>\n                        <button onClick={(e) => { e.stopPropagation(); handleNextMedia(product._id, product); }} className=\"bg-black/50 text-white p-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition\">\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" /></svg>\n                        </button>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* صور مصغرة تحت الصورة */}\n                  {allMedia.length > 1 && (\n                    <div className=\"p-3 bg-slate-800/50\">\n                      <div className=\"flex justify-center gap-2 flex-wrap\">\n                        {allMedia.map((media, idx) => {\n                          const isVideo = idx < videos.length;\n                          const thumbnailUrl = isVideo \n                            ? (images[0] ? `${process.env.REACT_APP_API_URL}/Uploads/${images[0]}` : null)\n                            : `${process.env.REACT_APP_API_URL}/Uploads/${media}`;\n\n                          return (\n                            <button\n                              key={idx}\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                selectMediaIndex(product._id, idx);\n                              }}\n                              className={`relative w-16 h-16 rounded-lg overflow-hidden border-2 transition-all ${\n                                currentIdx === idx \n                                  ? 'border-red-500 shadow-lg shadow-red-500/50 scale-110' \n                                  : 'border-slate-600 opacity-75 hover:opacity-100'\n                              }`}\n                            >\n                              {thumbnailUrl ? (\n                                <img src={thumbnailUrl} alt=\"\" className=\"w-full h-full object-cover\" />\n                              ) : (\n                                <div className=\"w-full h-full bg-slate-700 flex items-center justify-center\">\n                                  <svg className=\"w-8 h-8 text-slate-400\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path d=\"M8 5v14l11-7L8 5z\"/>\n                                  </svg>\n                                </div>\n                              )}\n                              {isVideo && (\n                                <div className=\"absolute inset-0 bg-black/40 flex items-center justify-center\">\n                                  <svg className=\"w-10 h-10 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path d=\"M8 5v14l11-7L8 5z\"/>\n                                  </svg>\n                                </div>\n                              )}\n                            </button>\n                          );\n                        })}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* تفاصيل المنتج */}\n                  <div className=\"p-5 space-y-2 text-right\">\n                    <h2 className=\"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600\">{product.name}</h2>\n                    <div className=\"text-sm text-slate-300 space-y-1\">\n                      <p>النوع: {product.type}</p>\n                      <p>سعر الكرتونة: {product.price} جنيه</p>\n                      <p>سعر الجوز: {(product.price / product.quantityPerCarton).toFixed(2)} جنيه</p>\n                      <p>الكرتونة: {product.quantityPerCarton} جوز</p>\n                      <p>المصنع: {product.manufacturer}</p>\n                    </div>\n                    {userRole === 'customer' && (\n                      <motion.button onClick={() => addToCart(product)} className=\"w-full mt-4 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">\n                        إضافة إلى السلة\n                      </motion.button>\n                    )}\n                  </div>\n                </motion.div>\n              );\n            })\n          )}\n        </div>\n      </div>\n\n      {/* Toast */}\n      <AnimatePresence>\n        {showAddedToCart && (\n          <motion.div className=\"fixed top-6 right-6 bg-red-600 text-white px-5 py-3 rounded-full shadow-xl flex items-center gap-2 z-50\" variants={toastVariants} initial=\"hidden\" animate=\"visible\" exit=\"hidden\">\n            <span>تمت الإضافة</span>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* باقي المودالات (سلة، طلب، ميديا، شات، floating button) */}\n      {/* نفس الكود الموجود في Home.js بالضبط */}\n\n      {/* Cart Modal */}\n      <AnimatePresence>\n        {showCartModal && userRole === 'customer' && (\n          <motion.div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"hidden\" onClick={() => setShowCartModal(false)}>\n            <motion.div className=\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-lg\" onClick={e => e.stopPropagation()}>\n              <h2 className=\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\">السلة</h2>\n              {cart.length === 0 ? <p className=\"text-center text-slate-400\">السلة فارغة</p> : (\n                <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                  {cart.map(item => (\n                    <div key={`${item.product._id}-${item.selectedImage}`} className=\"flex items-center justify-between gap-4 p-3 bg-slate-800/50 rounded-xl\">\n                      <img src={`${process.env.REACT_APP_API_URL}/Uploads/${item.selectedImage}`} alt=\"\" className=\"w-16 h-16 object-cover rounded-lg\" />\n                      <div className=\"text-right flex-1\">\n                        <p className=\"font-semibold\">{item.product.name}</p>\n                        <p className=\"text-sm text-slate-400\">سعر الكرتونة: {item.product.price} جنيه</p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <input type=\"number\" min=\"1\" value={item.quantity} onChange={e => updateCartQuantity(item.product._id, item.selectedImage, parseInt(e.target.value))} className=\"w-16 p-2 bg-slate-700 rounded text-center\" />\n                        <button onClick={() => removeFromCart(item.product._id, item.selectedImage)} className=\"text-red-400 hover:text-red-300\">×</button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n              {cart.length > 0 && (\n                <div className=\"flex gap-3 mt-6\">\n                  <button onClick={() => { setShowCartModal(false); setShowOrderForm(true); }} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold\">طلب</button>\n                  <button onClick={() => setShowCartModal(false)} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold\">إغلاق</button>\n                </div>\n              )}\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Order Modal */}\n      <AnimatePresence>\n        {showOrderForm && userRole === 'customer' && (\n          <motion.div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"hidden\" onClick={() => setShowOrderForm(false)}>\n            <motion.div className=\"bg-slate-900/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-md\" onClick={e => e.stopPropagation()}>\n              <h2 className=\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600 mb-6 text-right\">إدخال العنوان</h2>\n              <input type=\"text\" placeholder=\"العنوان\" value={orderForm.address} onChange={e => setOrderForm({ address: e.target.value })} className=\"w-full p-4 mb-6 bg-slate-800/60 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-500/30\" />\n              <div className=\"flex gap-3\">\n                <button onClick={handleOrderSubmit} disabled={isSubmitting} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-700 text-white font-bold disabled:opacity-70\">\n                  {isSubmitting ? 'جاري...' : 'إرسال'}\n                </button>\n                <button onClick={() => setShowOrderForm(false)} className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold\">إلغاء</button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Media Modal */}\n      <AnimatePresence>\n        {selectedMedia && (\n          <motion.div className=\"fixed inset-0 bg-black/90 flex items-center justify-center z-50\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"hidden\" onClick={closeMedia}>\n            <motion.div className=\"relative max-w-4xl max-h-screen p-4\" onClick={e => e.stopPropagation()}>\n              {selectedMedia.type === 'image' ? (\n                <img src={selectedMedia.url} alt=\"\" className=\"max-w-full max-h-screen rounded-2xl shadow-2xl\" />\n              ) : (\n                <video src={selectedMedia.url} controls autoPlay className=\"max-w-full max-h-screen rounded-2xl shadow-2xl\" />\n              )}\n              <button onClick={closeMedia} className=\"absolute top-4 right-4 bg-red-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg hover:bg-red-700\">×</button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Messages Modal */}\n      <AnimatePresence>\n        {selectedOrderForMessages && isChatManuallyOpened && !selectedOrderForMessages.isGrouped && (\n          <motion.div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\" variants={modalVariants} initial=\"hidden\" animate=\"visible\" exit=\"exit\">\n            <motion.div className=\"bg-[#242526] p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-2xl max-h-[90vh] flex flex-col\" onClick={e => e.stopPropagation()}>\n              <h2 className=\"text-3xl font-bold mb-6 text-right bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-red-600\">\n                الرسائل للطلب #{selectedOrderForMessages.orderNumber}\n              </h2>\n              <div ref={chatContainerRef} className=\"flex-1 overflow-y-auto mb-6 bg-[#3a3b3c] p-4 rounded-2xl shadow-inner\">\n                {selectedOrderForMessages.messages && selectedOrderForMessages.messages.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {selectedOrderForMessages.messages.map((msg, index) => {\n                      const isMyMessage = msg.from === userRole;\n                      const senderName = msg.from === 'vendor' ? selectedOrderForMessages.product?.vendor?.name : selectedOrderForMessages.user?.name || 'غير معروف';\n                      return (\n                        <div key={msg._id || index} className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}>\n                          <div className={`max-w-xs sm:max-w-sm p-4 rounded-2xl shadow-md ${isMyMessage ? 'bg-gradient-to-r from-red-600 to-red-800 text-white' : 'bg-gray-700 text-white'}`}>\n                            <p className=\"font-bold text-sm opacity-90\">{msg.from === 'vendor' ? 'التاجر' : 'العميل'}: {senderName}</p>\n                            {msg.text && <p className=\"mt-2 text-lg\">{msg.text}</p>}\n                            {msg.image && (\n                              <img src={`${process.env.REACT_APP_API_URL}/Uploads/${msg.image}`} alt=\"صورة الرسالة\" className=\"mt-3 w-full max-w-48 object-cover rounded-xl cursor-pointer shadow-lg hover:shadow-xl transition\" onClick={(e) => { e.stopPropagation(); openMedia(msg.image, 'image'); }} />\n                            )}\n                            <div className=\"flex items-center justify-between mt-3 text-xs opacity-70\">\n                              <p>{new Date(msg.timestamp).toLocaleString('ar-EG')}</p>\n                              {isMyMessage && <span>{msg.isRead ? '✓✓' : msg.isDelivered ? '✓' : '✓'}</span>}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-gray-400 text-lg\">لا توجد رسائل بعد.</p>\n                )}\n              </div>\n              {(userRole === 'vendor' || userRole === 'customer') && (\n                <form onSubmit={handleSendMessage} className=\"space-y-4\">\n                  <textarea placeholder=\"اكتب رسالتك هنا...\" value={newMessage} onChange={(e) => setNewMessage(e.target.value)} className=\"w-full p-4 rounded-xl bg-[#3a3b3c] text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 text-right resize-none\" rows=\"4\" />\n                  <div className=\"flex items-center gap-4\">\n                    <input type=\"file\" accept=\"image/*\" onChange={(e) => setNewImage(e.target.files[0] || null)} className=\"text-sm text-gray-300 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-red-600 file:text-white hover:file:bg-red-700\" />\n                    {newImagePreview && (\n                      <div className=\"relative\">\n                        <img src={newImagePreview} alt=\"معاينة\" className=\"w-24 h-24 object-cover rounded-xl shadow-lg\" />\n                        <button type=\"button\" onClick={() => { setNewImage(null); setNewImagePreview(null); }} className=\"absolute top-0 right-0 bg-red-800 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl\">×</button>\n                      </div>\n                    )}\n                  </div>\n                  <motion.button type=\"submit\" className=\"w-full py-4 rounded-xl text-white font-bold bg-gradient-to-r from-red-600 to-red-800 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">إرسال الرسالة</motion.button>\n                </form>\n              )}\n              <motion.button onClick={closeMessages} className=\"w-full mt-4 py-4 rounded-xl text-white font-bold bg-gradient-to-r from-gray-700 to-gray-900 shadow-xl text-lg\" variants={buttonVariants} whileHover=\"hover\" whileTap=\"tap\">إغلاق</motion.button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Floating Chat Button */}\n      {(userRole === 'customer' || userRole === 'vendor') && totalUnread > 0 && showFloatingChatButton && (\n        <motion.div className=\"fixed bottom-6 right-6 z-50\" initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: \"spring\", stiffness: 300 }}>\n          <button onClick={openMessagesFromFloating} className=\"relative w-16 h-16 bg-gradient-to-r from-red-600 to-red-700 rounded-full shadow-2xl flex items-center justify-center\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8 text-red-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\n            </svg>\n            <span className=\"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-7 h-7 flex items-center justify-center animate-pulse\">\n              {totalUnread > 99 ? '99+' : totalUnread}\n            </span>\n          </button>\n        </motion.div>\n      )}\n    </div>\n  );\n};\n\nexport default VendorProducts;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}